<h1 align="center"> Windows Services </h1>



## Scope







## Table of Contents






---




# Introduction to Windows Services

## What are Windows Services?
**Windows Services** are long-running executable applications that run in the background on Windows systems, typically without user interaction. They are managed by the Service Control Manager (SCM) and can start automatically at boot or be started manually.


### Basic concept
````
Windows Services = Background programs that run without user interaction
                  Start automatically with Windows
                  Run with specific permissions (often as SYSTEM)
````

### They are managed with the **Services Control Manager Panel**:
On windows first press `Ctrl + S` -> Type `Services`:
<img width="783" height="683" alt="image" src="https://github.com/user-attachments/assets/33618d19-0b1f-4a50-9db3-6fa61f2c51d1" />

<img width="1915" height="889" alt="image" src="https://github.com/user-attachments/assets/350dca67-105c-45db-a1f1-66c23f85cbc1" />

There exists different `Type` of services:
- Local Services
- Network Services
- System Services
- third party application services.



### Common Use Cases
- System Maintenance: Managing updates, backups, and diagnostics.
- Security: Antivirus engines, firewalls, and credential managers.
- Networking: DHCP, DNS, and remote access services.
- Application Support: Database engines (e.g., SQL Server), web servers (e.g., IIS), and monitoring tools.


## Why Are Windows Services Important for Privilege Escalation?
Attackers exploit misconfigurations in Windows Services to gain higher privileges (often SYSTEM) by:
- Modifying service configurations (if permissions allow).
- Replacing service binaries with malicious ones.
- Creating new services that execute arbitrary code.
- Abusing weak service permissions (e.g., SERVICE_ALL_ACCESS, SERVICE_CHANGE_CONFIG).

> If a service runs as SYSTEM and we can modify its binary or command line, we can get a shell with SYSTEM privileges - the highest level on Windows.



---






# Windows Services Methodology
In this after i get target `meterpreter`, first i need to get victim shell: 

<img width="1038" height="474" alt="image" src="https://github.com/user-attachments/assets/feb8b573-5350-43ed-b4c7-8176b7426f01" />

<img width="1020" height="389" alt="image" src="https://github.com/user-attachments/assets/c7369b04-4fdf-4d63-8977-8c005120916a" />

- After in this we wait target execute our file payload.
<img width="1899" height="657" alt="image" src="https://github.com/user-attachments/assets/fcb7b473-2895-4fae-a719-07ea54660efc" />

- Now we got success to get target shell.

---

In this we we not yet to get taget shell go to this:
[Target Shell by msfconsole](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/02.%20Initial%20Access%20(Shells).md)

---




## 1. View and Managing Services

### 1. USING COMMAND PROMPT (CMD)

#### List all service
##### List all services with details
````
sc query
````
<img width="924" height="800" alt="image" src="https://github.com/user-attachments/assets/f91cf59f-1ab8-4346-aecc-00ca70fb45d4" />

- Lists all Windows services and their current status.

````
sc queryex
````
<img width="801" height="777" alt="image" src="https://github.com/user-attachments/assets/e7eb9069-3345-4d3f-9414-26ab72c4c08c" />

- Shows detailed information about a specific Windows service


````
sc queryex Appinfo
````
<img width="783" height="276" alt="image" src="https://github.com/user-attachments/assets/67691b6e-5f82-4114-b1d6-353cef8158ce" />

- `Appinfo`: is Service name.



##### List all service running 
````
sc query state=all
````
<img width="801" height="792" alt="image" src="https://github.com/user-attachments/assets/995c4459-2fca-446c-8e03-1174d4a43b71" />



##### List specific service
````
sc query "WpnUserService_625cf"
````
<img width="794" height="242" alt="image" src="https://github.com/user-attachments/assets/76f3dc8f-c5ab-41fa-97bc-63eaa46a55d5" />


##### Query service details
````
sc qc "WwanSvc"
````
<img width="995" height="335" alt="image" src="https://github.com/user-attachments/assets/52d99495-b474-45a1-a58e-3aa646920ce0" />

- Now we see the specific name service.



#### Service Control Commands
##### Start a service
````
sc start "AJRouter"
````
<img width="828" height="296" alt="image" src="https://github.com/user-attachments/assets/ed36e4a0-fc7d-4db1-b159-29d866dbf5c1" />

- Now we was start the service, after we use this command again:
<img width="572" height="150" alt="image" src="https://github.com/user-attachments/assets/292ac0ac-a54d-46c7-bc48-1c378fe74ee7" />

- Now we see `An instance of the service is already running.`


##### Stop a service  
````
sc stop "AJRouter"
````
<img width="815" height="390" alt="image" src="https://github.com/user-attachments/assets/ff10518b-36e9-4dbf-a1b1-ec891d0195fe" />

- Now we was stop this service.


##### Delete a service
````
sc delete "service_name"
````
- `sc delete`: is used to unregister and remove a service completely from Windows. But in this i don't want to delete any service.



##### Get service configuration
````
sc qc "spooler"
````
<img width="692" height="317" alt="image" src="https://github.com/user-attachments/assets/739f0b0f-e15a-48d2-9c82-1c6994baa190" />


Our output shows the Print Spooler service runs automatically at boot, depends on RPC/HTTP, and executes as LocalSystem with high privileges — making it both essential for printing and a common target in privilege escalation labs.

---



### 2. Using PowerShell
- In this after we got the victim `meterpreter`, after i want to get victim `Powershell`:
````
load powershell
powershell_shell
````
<img width="451" height="148" alt="image" src="https://github.com/user-attachments/assets/c3715360-d6ad-4e1e-9722-fccf6201f536" />

- Now we got the victim `Powershell`.



#### PowerShell Service Commands

##### List all services
````
Get-Service
````
<img width="735" height="803" alt="image" src="https://github.com/user-attachments/assets/38ccd5b1-a13f-4ac9-9c06-224a1fb72754" />

- `Get-Service`: is the **PowerShell equivalen**t of `sc query`, used for **enumerating and controlling services** in a more scriptable way.



##### List running services
````
Get-Service | Where-Object {$_.Status -eq "Running"}
````
<img width="720" height="817" alt="image" src="https://github.com/user-attachments/assets/ce061a9a-cc45-4de1-a4d8-e7fad46ec70e" />

- This show all services that `running`.
- `Get-Service | Where-Object {$_.Status -eq "Running"}` is use for lists all Windows services that are currently running. It gets all services with Get-Service and filters them to show only those whose status is `Running`, This helps quickly see which services are active on your system.



##### List stopped services  
````
Get-Service | Where-Object {$_.Status -eq "Stopped"}
````
<img width="707" height="784" alt="image" src="https://github.com/user-attachments/assets/19a3281f-977b-4b75-a372-46c23a41835b" />

- It shows all Windows services that are currently `stopped`.
- `Get-Service`: Lists all services on the system.
- `| (pipe)`: sends that list to the next command.
- `Where-Object {$_.Status -eq "Stopped"}`: filters the list, keeping only services whose Status equals "Stopped".





##### Get specific service
````
Get-Service -Name "spooler"
````
<img width="486" height="147" alt="image" src="https://github.com/user-attachments/assets/5319a4f6-4a8b-436d-9df5-b9b5ddf422d5" />

- Now we see `Spooler` is running.
- `Get-Service`: retrieves information about Windows services.
- `-Name "spooler"`: limits the result to the service named Spooler (the Print Spooler, which manages print jobs).
-  It shows the status and details of the Print Spooler service (e.g., `whether it’s Running`, `Stopped`, `its display name`, etc.).



##### Start service
````
Start-Service -Name "spooler"
````
<img width="410" height="61" alt="image" src="https://github.com/user-attachments/assets/bc3a4c25-f504-4241-bddf-8176bbb4badd" />

- Now it start the service `spooler`.
- If we want to check this status just use this command `Get-Service -Name "spooler"`:
<img width="538" height="158" alt="image" src="https://github.com/user-attachments/assets/baf228f7-edb2-42dd-ada2-0ce8cdc8a615" />

- Now we see this service `spooler` is running.




##### Stop service
````
Stop-Service -Name "spooler"
````
<img width="386" height="61" alt="image" src="https://github.com/user-attachments/assets/ead6da39-4d99-4cb6-82eb-3275554a3c76" />

- If we want to check this status just use this command `Get-Service -Name "spooler"`:
<img width="472" height="311" alt="image" src="https://github.com/user-attachments/assets/c92f4a61-9a61-40d2-bfa5-e41565ede0e3" />


##### Restart service
````
Restart-Service -Name "spooler"
````
<img width="466" height="162" alt="image" src="https://github.com/user-attachments/assets/6ff858b5-2084-40e1-ba80-97ddea956992" />

Now we see this service is restart to `running` 

##### Get service details with WMI
````
Get-WmiObject Win32_Service | Where-Object {$_.Name -eq "spooler"}
````
<img width="772" height="229" alt="image" src="https://github.com/user-attachments/assets/643fd6a7-9d8f-41dd-b4d6-17ec3cf8e388" />


- Our Print Spooler service is running fine, auto-starts with Windows, and has no errors.
- `ExitCode : 0` → No errors when starting the service.
- `Name : Spooler` → Internal service name.
- `ProcessId : 4448` → The PID of the running spooler process.
- `StartMode : Auto` → It’s set to start automatically with Windows.
- `State : Running` → The service is currently active.
- `Status : OK` → Health check shows it’s functioning properly.


- If we want to see just the state without all the extra properties, we can run:
````
(Get-WmiObject Win32_Service -Filter "Name='spooler'").State
````
<img width="762" height="117" alt="image" src="https://github.com/user-attachments/assets/f0c7fd3f-8099-4254-927e-b9de87842fec" />



#### Get service Details
##### Get service with full details
````
Get-CimInstance Win32_Service -Filter "Name='spooler'" | Select-Object *
````


##### Or using Get-Service with format
````
Get-Service -Name "spooler" | Format-List *
````

















