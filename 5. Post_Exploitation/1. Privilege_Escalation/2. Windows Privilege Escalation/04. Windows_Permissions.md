<h1> Windows Permissions </h1>







# Introduction to Windows Permisions

## What is Windows Permisions?
Windows permissions control:
- **Who** can access a resource
- **What** actions they can perform
- **On which object** (file, folder, registry, service, process)
> Think of permissions as rules that protect Windows resources.


## Windows permissions apply to many objects:
| Object Type     | Example                  |
| --------------- | ------------------------ |
| Files           | `C:\Users\user\file.txt` |
| Folders         | `C:\Program Files\`      |
| Registry Keys   | `HKLM\Software`          |
| Services        | Windows Update           |
| Processes       | `lsass.exe`              |
| Scheduled Tasks | Backup task              |


## Users, Groups, and Security Principals
Permissions are assigned to Security Principals:
- Users:
  - Administrator
  - User1

- Groups (VERY IMPORTANT)
  - Administrators
  - Users
  - Authenticated Users
  - SYSTEM
  - Everyone



## Permission Types (What Actions Are Allowed)

### File & Folder Permissions
| Permission   | Meaning            |
| ------------ | ------------------ |
| Read         | View file contents |
| Write        | Modify file        |
| Execute      | Run file           |
| Modify       | Read + Write       |
| Full Control | All permissions    |


### Registry Permissions
| Permission    | Meaning            |
| ------------- | ------------------ |
| Query Value   | Read registry data |
| Set Value     | Change data        |
| Create Subkey | Add new keys       |
| Full Control  | All actions        |


### Service Permissions
Services also have permissions:
- Start
- Stop
- Change config
- Delete



## NTFS Permissions (Core Concept)
Windows uses NTFS to enforce permissions.

- Each object has:
  - Owner
  - Access Control List (ACL)

- ACL contains:
  - `DACL`: Who is allowed/denied
  - `SACL`: What actions are audite


## Access Control Entries (ACE)
An ACL is made of ACEs:
| ACE Type | Meaning       |
| -------- | ------------- |
| Allow    | Permit action |
| Deny     | Block action  |




## Authentication, Authorization and Session Management
- **Authentication** → Who you are
Verifies user identity (login with password, OTP, biometrics).

- **Authorization** → What you can do
Controls permissions and access (admin vs user).

- **Session Management** → How are information regarding the identity of the user stored and processedwhile a user is having an authentication sessions. How the system remembers you
Keeps you logged in using sessions/cookies.

- Order: `Authentication → Session Management → Authorization`
| Concept            | Question                | Example       |
| ------------------ | ----------------------- | ------------- |
| Authentication     | Who are you?            | Login         |
| Authorization      | What can you do?        | Admin vs User |
| Session Management | How are you remembered? | Cookies       |




## Security Principals and Security Identifier (SID)
**Security principals** can represent any entity that can be authenticated by the operating system.

### Security Principals
- A security principal is any entity that can be authenticated by Windows.
- This includes:
  - User accounts (e.g., user, Administrator)
  - Computer accounts (e.g., domain-joined machines)
  - Processes or threads (e.g., services running under specific identities


A **security identifier** is used to uniquely identify a security principal or security group.
SID → Security Identifier

Security Principals
- A SID is a unique string that identifies a security principal.
- It looks like this: `S-1-5-21-3623811015-3361044348-30300820-1013`
- Windows uses SIDs internally to manage permissions, not usernames.
- Even if you rename a user, their SID stays the same — that’s how Windows knows it’s the same entity.



- Examples of security principals:
  - user account
  - computer account
  - thread or process
The SID cannot be changed and is generated upon the user or group's creation.


> SID: Are used by Windows to identify security principles for access control management (authorization controls).



## SID Structure
A SID is a unique identifier used by Windows to represent a security principal (user, group, computer, etc.). It’s made up of several parts:
````
S-R-X-Y1-Y2-...-Yn
````
| Segment        | Meaning                                                                                        |
| -------------- | ---------------------------------------------------------------------------------------------- |
| **S**          | Indicates this is a Security Identifier (SID) string. Always starts with `S`.                  |
| **R**          | Revision number of the SID format. Usually `1`.                                                |
| **X**          | Identifier Authority — specifies who issued the SID (e.g., NT Authority, domain controller).   |
| **Y1 to Yn-1** | Subauthorities — identify the domain or local computer that created the account.               |
| **Yn**         | Relative Identifier (RID) — uniquely identifies the specific user or group within that domain. |



### Enumeration SIDs
Obtain the SID for the current logged-in user:
````
whoami /user
````
<img width="578" height="152" alt="image" src="https://github.com/user-attachments/assets/d286d416-60f4-452a-8828-b07e55d5c09b" />

- `S`: Indicates this is a SID string
- `1`: Revision number
- `5`: Identifier authority (NT Authority)
- `21-1598086677-3833633028-2215134970`: Domain Identifier (unique to your machine/domain)
- `1001`: Relative Identifier (RID) → identifies the specific user account (k4n0ng



- We can Enumerate SIDs with the `wmic` command:
````
wmic useraccount get domain, name, sid
````
<img width="733" height="154" alt="image" src="https://github.com/user-attachments/assets/76ef4066-794f-4092-bd68-f7eb96c89878" />

- **Domain Identifier**: `S-1-5-21-1598086677-3833633028-2215134970`
  - This part is common across all accounts on your machine. It uniquely identifies your computer/domain.
- Relative Identifier (RID): The last number in each SID, unique per account:
  - `500`: Built‑in **Administrator**
  - `501`: Built‑in **Guest**
  - `503`: **DefaultAccount** (system account)
  - `504`: **WDAGUtilityAccount** (Windows Defender Application Guard)
  - `1001`: Our custom user account **k4n0ng**


- we can view this website: https://learn.microsoft.com/en-us/windows/win32/api/winnt/ne-winnt-well_known_sid_type


---









# Windows Permissions Methodology
First in this if we got `meterpreter` -> get one more `shell`:
````
shell
````
<img width="504" height="189" alt="image" src="https://github.com/user-attachments/assets/06416f71-efa6-4ba7-b59e-de0e9ad5c74a" />

- Now we got targe `Shell`.

---

## 1. Understanding Windows Users & Groups

### Built-in Local Groups:
| Group Name                          | Description                                                                       |
| ----------------------------------- | --------------------------------------------------------------------------------- |
| **Administrators**                  | Full system control; can install software, change settings, and manage all users. |
| **Users**                           | Standard users with limited permissions for daily tasks.                          |
| **Guests**                          | Very limited access; typically disabled by default.                               |
| **Backup Operators**                | Can back up and restore files regardless of file permissions.                     |
| **Power Users**                     | Legacy group from older Windows versions; mostly deprecated.                      |
| **Network Configuration Operators** | Can manage network settings (IP, adapters) without full admin rights.             |
| **Remote Desktop Users**            | Allowed to log in remotely using Remote Desktop (RDP).                            |



### Built-in System Accounts:
| Account             | Description                                                                                     |
| ------------------- | ----------------------------------------------------------------------------------------------- |
| **SYSTEM**          | Has the highest privileges on the local system; used by core Windows services.                  |
| **Local Service**   | Runs services with very limited local privileges and uses anonymous credentials on the network. |
| **Network Service** | Runs services with limited local privileges but uses the computer’s credentials on the network. |


### Check our Current User & Groups:
````
whoami
````
<img width="273" height="82" alt="image" src="https://github.com/user-attachments/assets/33ca74b0-d699-4fa6-8fc9-8cff715b75f6" />


````
whoami /groups
````
<img width="1427" height="412" alt="image" src="https://github.com/user-attachments/assets/ac7f17b8-e601-4e35-bc23-4a319f8a1bda" />

- Displays all `groups` that the current user belongs to.
- Shows `SIDs`, `attributes`, and `privileges` associated with those groups.



````
whoami /priv
````
<img width="1110" height="627" alt="image" src="https://github.com/user-attachments/assets/b089710e-b3af-46c6-87c3-7aa4961352ac" />


````
net user
````
<img width="750" height="198" alt="image" src="https://github.com/user-attachments/assets/23de6a8b-2584-4e99-b13f-71a47d847591" />

````
net localgroup
````
<img width="738" height="520" alt="image" src="https://github.com/user-attachments/assets/54a51b65-6484-4b81-8014-3dec217aec51" />

````
net user k4n0ng
````
<img width="528" height="537" alt="image" src="https://github.com/user-attachments/assets/c08a3366-68b2-4cdd-a15f-f4bb6cdc4b98" />


---




## 2. Windows Permission Types

### Basic Permissions:
| Permission | Meaning        |
| ---------- | -------------- |
| **F**      | Full Control   |
| **M**      | Modify         |
| **RX**     | Read & Execute |
| **R**      | Read           |
| **W**      | Write          |



### Advanced Permissions (NTFS):
````
icacls C:\Users\k4n0ng
````
<img width="579" height="148" alt="image" src="https://github.com/user-attachments/assets/f24a2f2f-5f71-4985-b5f5-ba150684218b" />

- Shows the ACL (Access Control List) for that folder.
- Explain about it:
#### Standard Permissions
##### Read / Execute Permissions
| Permission                         | Description                                                                          |
| ---------------------------------- | ------------------------------------------------------------------------------------ |
| **Traverse Folder / Execute File** | Traverse folders to reach files even without list permission; execute program files. |
| **List Folder / Read Data**        | View folder contents; open and read file data.                                       |
| **Read Attributes**                | View basic file attributes (read-only, hidden, etc.).                                |
| **Read Extended Attributes**       | View custom attributes defined by applications.                                      |

##### Write Permissions
| Permission                       | Description                                                                    |
| -------------------------------- | ------------------------------------------------------------------------------ |
| **Create Files / Write Data**    | Create new files; write data to existing files.                                |
| **Create Folders / Append Data** | Create subfolders; append data to a file without overwriting existing content. |
| **Write Attributes**             | Modify basic file attributes (hidden, read-only, etc.).                        |
| **Write Extended Attributes**    | Modify custom application-defined attributes.                                  |

##### Delete Permissions
| Permission                      | Description                                                 |
| ------------------------------- | ----------------------------------------------------------- |
| **Delete Subfolders and Files** | Delete items inside a folder even if you are not the owner. |
| **Delete**                      | Delete the file or folder itself.                           |


##### Advanced Control Permissions
| Permission             | Description                                                 |
| ---------------------- | ----------------------------------------------------------- |
| **Read Permissions**   | View the Access Control List (ACL).                         |
| **Change Permissions** | Modify permissions (grant or revoke access).                |
| **Take Ownership**     | Take ownership of the object, overriding the current owner. |



### Special Privileges (User Rights):
| Privilege Name                    | Description                                                             |
| --------------------------------- | ----------------------------------------------------------------------- |
| **SeBackupPrivilege**             | Allows backing up files and directories, bypassing file permissions.    |
| **SeRestorePrivilege**            | Allows restoring files and directories, bypassing file permissions.     |
| **SeDebugPrivilege**              | Allows debugging and accessing any process, including system processes. |
| **SeImpersonatePrivilege**        | Allows impersonating another user after successful authentication.      |
| **SeAssignPrimaryTokenPrivilege** | Allows replacing a process-level security token.                        |
| **SeLoadDriverPrivilege**         | Allows loading and unloading device drivers.                            |
| **SeTakeOwnershipPrivilege**      | Allows taking ownership of files, folders, and other objects.           |
| **SeTcbPrivilege**                | Allows acting as part of the operating system (Trusted Computing Base). |


---



## 3. Checking Your Current Permissions

### Check User Privileges:
````
whoami /priv
````
<img width="1110" height="627" alt="image" src="https://github.com/user-attachments/assets/b089710e-b3af-46c6-87c3-7aa4961352ac" />


### Check File/Folder Permissions:
````
icacls "C:\Users\k4n0ng"
````
<img width="549" height="162" alt="image" src="https://github.com/user-attachments/assets/1c552025-16d8-4c38-8ac2-00f002d13db1" />

- Recursive:
````
icacls "C:\Users\k4n0ng\Helo" /T
````
<img width="667" height="561" alt="image" src="https://github.com/user-attachments/assets/69c71a19-5401-425e-8c0e-1a3685f56e5a" />


### Check Service Permissions:
````
sc.exe qc wuauserv
````
<img width="737" height="295" alt="image" src="https://github.com/user-attachments/assets/fc94aa18-a8b6-4133-b329-ba827e6f331d" />

- After run this command:
````
Get-Acl -Path "HKLM:\SYSTEM\CurrentControlSet\Services\wuauserv" | Format-List
````
<img width="880" height="123" alt="image" src="https://github.com/user-attachments/assets/7b23a3a4-b342-4a46-a25a-8b2b000d7021" />

- But in this it not recognized, cause we run on `CMD`. To fix it we need to run this command on `Powershell`:

<img width="1560" height="218" alt="image" src="https://github.com/user-attachments/assets/2c8d1ec5-1cc7-45a1-85ab-96ea775d6d1e" />

- **Owner**: SYSTEM
- **Admins & SYSTEM**: FullControl
- **Users & App Packages**: Read-only
- **Risk**: Secure - no write access for low-privilege users.



### Check Registry Permissions:
````
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
````
<img width="757" height="120" alt="image" src="https://github.com/user-attachments/assets/d288aa23-7296-43f2-b442-46ffb7fa3a2c" />

- Our reg query command ran successfully — but it didn’t show any output because there are no values currently set under:
````
HKLM\Software\Microsoft\Windows\CurrentVersion\Run
````
That key is where Windows stores startup programs (apps that auto-launch when the system boots). If it’s empty, it simply means no applications are registered there right now.


- Next command but run as PowerShell:
````
Get-Acl -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run" | Format-List
````
<img width="1798" height="302" alt="image" src="https://github.com/user-attachments/assets/36ffda3f-288e-46d3-9130-3df9c45e488d" />

- **Owner / Group**: SYSTEM
- **Admins & SYSTEM**: FullControl (expected)
- **Users & App Packages**: Read-only (safe)
- **Extra entries** (numeric flags like `-2147483648`, `268435456`): These are internal registry rights constants — they don’t represent dangerous write access for normal users.


---



## 4. Common Permission Vulnerabilities

### Weak File/Folder Permissions
- World-writable directories (Everyone:(F))
- Weak permissions on executables (Users:(M))
- Weak permissions on configuration files


### Weak Service Permissions
- Services running as SYSTEM with weak binary permissions
- Unquoted service paths with spaces
- Service allowing non-admin to modify configuration

### Weak Registry Permissions
- Registry keys with Everyone:(F)
- Auto-run keys writable by non-admins
- PATH directory modifiable by users


### Scheduled Tasks with Weak Permissions
- Tasks running as high privilege with weak executable permissions
- Tasks writable by non-admin users


---




## 5. Access Token
Upon user authentication, Windows generates an access token and assigns it to the user.
This token contains data that determines the security context of the user and is later used for performing authorization checks.


### Information Contained in an Access Token:
| **Category**                      | **Description**                                                                                                                     |
| --------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| **User SID**                      | Security Identifier (SID) for the user’s account.                                                                                   |
| **Group SIDs**                    | SIDs for all groups the user is a member of.                                                                                        |
| **Logon SID**                     | Identifies the current logon session.                                                                                               |
| **Privileges**                    | List of privileges held by the user or their groups (e.g., `SeDebugPrivilege`).                                                     |
| **Owner SID**                     | SID of the owner of the token (typically the user).                                                                                 |
| **Primary Group SID**             | SID of the user’s primary group.                                                                                                    |
| **Default DACL**                  | Default Discretionary Access Control List applied when the user creates a new securable object.                                     |
| **Token Source**                  | Indicates where the token originated (e.g., local logon, network logon).                                                            |
| **Token Type**                    | Specifies whether it’s a **primary token** (for launching processes) or **impersonation token** (for temporary identity switching). |
| **Restricting SIDs** *(Optional)* | Optional list of SIDs that further restrict access beyond normal group membership.                                                  |
| **Impersonation Level**           | Current impersonation level (e.g., Anonymous, Identify, Impersonate, Delegate).                                                     |
| **Other Statistics**              | Additional metadata like token expiration, session ID, etc.                                                                         |



---



## 6. Enumeration




























