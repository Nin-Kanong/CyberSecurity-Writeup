<h1 align="center"> Windows Weak Service Permissions </h1>



---


## Scope:
- **Attacker**: Kali Linux (IP `192.168.127.128`)
- **Victim**: windows 10 (IP `192.168.127.142`)

---


## Table of Contents







---

# Introduction to Windows Weak Service Permissions 

## What is Windows Weak Service Permissions?
**Windows weak service permissions**: refer to misconfigurations in the access control settings of Windows services that allow non-privileged users to modify or manipulate those services. This is a common privilege escalation vector in Windows environments, especially during penetration testing or red team engagements.

### How Windows Services Work
- **Service**: A background app managed by the Service Control Manager (SCM).
- **Runs as**: A specific account (e.g., LocalSystem, LocalService, NetworkService).
- **Protected by**: A permission list (DACL) that says who can start, stop, or change the service.


### What are Service Permissions?
````
Every Windows Service has a Security Descriptor (SD) that controls:
1. Who can START/STOP the service
2. Who can CHANGE its configuration  
3. Who can QUERY its status
4. Who can DELETE the service
````



## What makes permissions “weak”
If low‑privileged users (like “Users” or “Authenticated Users”) are allowed to change important parts of a service, that’s weak. The risky permissions are:
- **SERVICE_CHANGE_CONFIG**: Lets someone change the service’s executable path—dangerous because they can point it to their own program.
- **WRITE_DAC**: Lets someone change the service’s permissions—so they can grant themselves more power.
- **WRITE_OWNER**: Lets someone take ownership—then they can rewrite the permissions however they want.
- **GENERIC_WRITE / GENERIC_ALL**: Broad rights that include the dangerous ones above—effectively full control.


### Why are Weak Service Permissions Dangerous?
If a low-privilege user can modify a service that runs as SYSTEM, they can:
- Change the executable path
- Replace it with malicious code
- Restart the service
- Get SYSTEM privileges!


---


# Setup Environments

## On Windows VM (As Administrator):

### Create Vulnerable Service

- Open `CMD` -> as Administrator (`Right-click` → `Run as administrator`)
- Press `Ctrl + S` -> type `cmd` -> choose `Run as administrator`:
<img width="836" height="691" alt="image" src="https://github.com/user-attachments/assets/5f64ec6b-7d28-4acb-b6a7-acdf51194965" />

#### after I find my folder:
````
cd C:\Users\k4n0ng
````
<img width="521" height="210" alt="image" src="https://github.com/user-attachments/assets/d637b58f-5478-4937-bdaa-a8b06ccc14ec" />


#### Create a folder:
````
mkdir C:\VulnerableService
dir C:\VulnerableService
````
<img width="592" height="515" alt="image" src="https://github.com/user-attachments/assets/302371d6-860a-4bfb-8172-b5ca6df8ec24" />



#### Copy a harmless program as our service
````
copy C:\Windows\System32\notepad.exe C:\VulnerableService\service.exe
dir C:\VulnerableService\service.exe
````
<img width="826" height="272" alt="image" src="https://github.com/user-attachments/assets/6a014bab-6d46-4976-8814-a1a8afe05956" />


#### Create the service & Verify:
````
sc create "TestService" binPath="C:\VulnerableService\service.exe" start=demand obj="LocalSystem"
sc qc TestService
````
<img width="1087" height="347" alt="image" src="https://github.com/user-attachments/assets/b938cd46-1b36-4bf2-8c72-05a0e04d00ba" />

- **SERVICE_NAME: TestService**: The internal name of your service.
- **TYPE: 10 WIN32_OWN_PROCESS**: Runs as its own process (not shared).
- **START_TYPE: 3 DEMAND_START**: Manual start; you need to run sc start TestService to launch it.
- **ERROR_CONTROL: 1 NORMAL**: If the service fails, log the error but continue booting.
- **BINARY_PATH_NAME: C:\VulnerableService\service.exe**: The executable the service will run (your copied Notepad).
- **SERVICE_START_NAME: LocalSystem**: Runs with SYSTEM privileges (highest local privilege).


#### Make it vulnerable - give EVERYONE full control
````
sc sdset TestService "D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCLCSWRPWPDTLOCRRC;;;WD)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)"
````
<img width="1286" height="144" alt="image" src="https://github.com/user-attachments/assets/46aed458-7436-46f0-bef2-75195273da63" />



### Create Low-Privilege User

#### Create test user
````
net user lowuser Password123! /add
````
<img width="486" height="69" alt="image" src="https://github.com/user-attachments/assets/4b6ebc47-dfe5-4609-a179-1e1f591e7aee" />


#### Remove from administrators (if automatically added)
````
net localgroup administrators lowuser /delete
````
<img width="606" height="118" alt="image" src="https://github.com/user-attachments/assets/3edfeb66-f576-44b9-97ac-0c56ecf40a28" />


- This command is valid syntax, but Windows gave me:
````
System error 1377 has occurred.
The specified account name is not a member of the group.
````
- That’s because **lowuser was never in the Administrators group** to begin with, so there was nothing to remove.


### Test the Service Works

#### Start the service
````
sc start TestService
````





#### Check it's running
````
sc query TestService
````


#### Stop it
````
sc stop TestService
````
- In this if we want to stop this.


















- Open `CMD` -> as Administrator (`Right-click` → `Run as administrator`)
- Press `Ctrl + S` -> type `cmd` -> choose `Run as administrator`:
<img width="836" height="691" alt="image" src="https://github.com/user-attachments/assets/5f64ec6b-7d28-4acb-b6a7-acdf51194965" />

````
whoami /groups | findstr /i "S-1-5-32-544"
````
<img width="1429" height="146" alt="image" src="https://github.com/user-attachments/assets/a033aa4f-a790-4b3a-8e85-820b25ae64c3" />



````
mkdir C:\VulnerableService
copy C:\Windows\System32\notepad.exe C:\VulnerableService\service.exe
dir C:\VulnerableService
````
<img width="701" height="313" alt="image" src="https://github.com/user-attachments/assets/bb345b89-fce5-4777-ab77-ed769f395965" />


- Create the service (Test_Service)


````
sc.exe create Test_Service binPath= "C:\VulnerableService\service.exe" start= demand obj= LocalSystem
````
<img width="1625" height="118" alt="image" src="https://github.com/user-attachments/assets/8ab5296d-2e67-48d7-88e7-f023a32abbe1" />
















````
whoami /groups | findstr /i "S-1-5-32-544"
````
<img width="1058" height="165" alt="image" src="https://github.com/user-attachments/assets/60d22c11-cf54-4a5a-a377-1595a4019a5e" />


````
mkdir C:\VulnerableService
dir C:\VulnerableService
````
<img width="595" height="316" alt="image" src="https://github.com/user-attachments/assets/67e19066-dad0-4a9b-bfc6-3f9d4ebf802b" />


````
copy C:\Windows\System32\notepad.exe C:\VulnerableService\service.exe
````
<img width="998" height="321" alt="image" src="https://github.com/user-attachments/assets/67d21be5-1382-4162-a9f4-ea2ee0125c39" />



````
sc.exe create TestService binPath= "C:\VulnerableService\service.exe" start= demand obj= LocalSystem
sc.exe qc TestService
````
<img width="1357" height="418" alt="image" src="https://github.com/user-attachments/assets/99e9899c-3a39-4623-b994-20c764745990" />


````
sc sdset TestService "D:(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCLCSWRPWPDTLOCRRC;;;WD)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)"
````
<img width="1625" height="118" alt="image" src="https://github.com/user-attachments/assets/03c258e7-fe0a-4029-a88d-323619f1f80b" />


````
net user k4 Password /add
````
<img width="1591" height="165" alt="image" src="https://github.com/user-attachments/assets/d7f606a3-35e7-48dc-8ac4-ea9e5a8a357e" />



.\accesschk64.exe /accepteula -uwcqv C:\VulnerableService
---


# Windows Weak Service Permissions Methodology 


## 









































