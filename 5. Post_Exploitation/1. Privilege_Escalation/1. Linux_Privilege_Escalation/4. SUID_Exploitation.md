<img width="678" height="101" alt="image" src="https://github.com/user-attachments/assets/155d76a1-b1c0-4709-8854-14650fcd53a5" /><h1 align="center"> SUID Exploitation </h1>







## What is SUID Exploitation?
**SUID Exploitation**: is a classic Linux privilege escalation technique: it leverages misconfigured binaries with the Set User ID (SUID) bit set to gain higher privileges, often root.

## What is SUID?
SUID (Set User ID): is a special permission bit in Unix/Linux systems  that allows a user to execute a file with the permissions of the file’s owner, rather than the user who is running it.


### Why SUID Can Be Dangerous
- If a binary with SUID root allows arbitrary command execution or is poorly coded, a low‑privileged user can exploit it to run commands as root.
- Attackers look for unexpected or custom SUID binaries beyond the usual system ones.

#### The Problem:
If a SUID binary has vulnerabilities or can be manipulated, attackers can:
1. Execute arbitrary commands as the file owner (usually root)
2. Read protected files
3. Write to system directories
4. Gain persistent access


#### Common Vulnerability Patterns:
1. Shell escape - Binary spawns a shell
2. Command injection - User input not sanitized
3. Path manipulation - Related to PATH hijacking
4. Library hijacking - LD_PRELOAD attacks
5. Symbolic link attacks - Race conditions




### The Power of SUID:
- Normal execution: `user → program → runs as user`
- SUID execution: user → `program → runs as owner (often root)`



# SUID Exploitation Methodology:

- So in this i test with my metasploitable 2. 

- First in this i need to Scan my target that open port `SSH` or not:

````
nmap -sV -T4 192.168.127.0/24
````
<img width="1574" height="395" alt="image" src="https://github.com/user-attachments/assets/72737d20-fa26-495c-bbb0-227d2756ea8e" />

<img width="1122" height="691" alt="image" src="https://github.com/user-attachments/assets/fe430af0-8196-4521-bac5-97ab6d59854e" />

- Now i see my target open port `SSH`.

- So this our target:
<img width="978" height="538" alt="image" src="https://github.com/user-attachments/assets/5b0c8351-a51a-4447-b375-afa40051f2c5" />



- After i need to brute force this SSH service:
````
medusa -h 192.168.127.129 -U /usr/share/wordlists/user.txt -P /usr/share/wordlists/passwd.txt -M ssh -t 5 -f
````
<img width="1547" height="252" alt="image" src="https://github.com/user-attachments/assets/cdb70020-93fb-46cc-ac2a-4de93e0e0bef" />

- Now we got the correct `Username` and `Password`.


- First i need to login to target `SSH` port:
````
ssh msfadmin@192.168.127.129
````
<img width="1724" height="115" alt="image" src="https://github.com/user-attachments/assets/78c01882-f5dd-4022-a2cb-de99f64f4ad7" />

- Now f it show this, it mean we need to explicitly tell your SSH client to allow those older algorithms:
````
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa msfadmin@192.168.127.129
````
<img width="1546" height="621" alt="image" src="https://github.com/user-attachments/assets/59b9074c-f4ce-4367-ba55-5e0de2ebd8f8" />

- Now i got success to login to our target.

- Or if the server only supports DSA:
````
ssh -o HostKeyAlgorithms=+ssh-dss msfadmin@192.168.127.129
````

````
whoami
````
<img width="535" height="62" alt="image" src="https://github.com/user-attachments/assets/d358b3ba-fc9b-41a9-ba9a-7a8490ed4100" />

---


## Visual Identification:
- SUID files have 's' in the owner execute position:
````
ls -lh /usr/bin/passwd
````
<img width="935" height="95" alt="image" src="https://github.com/user-attachments/assets/7c27c598-6867-4b8b-9768-ae5652ffa2b1" />

- `ls`:  list information about files.
- `-l`: long format (shows permissions, owner, group, size, date, filename).
- `-h`: - human‑readable sizes (e.g., `12K` instead of `12288`).
- **This command systems detailed info about the `passwd` binary in `/usr/bin`.**

- We the result:
````
-rwsr-xr-x 1 root root 29K 2008-04-02 21:08 /usr/bin/passwd
````
- `-rwsr-xr-x`:
  - `-`: it’s a regular file.
  - `rws`: owner (root) has read, write, and execute permissions. The s here is the SUID bit.
  - `r-x`: group has read and execute.
  - `r-x`: others have read and execute.
  - Key point: The `s` means when anyone runs this file, it executes with the privileges of the file’s owner (root)
- `1`: number of hard links.
- `root root`: owner is root, group is root.
- `2008-04-02 21:08`: last modification date.
- `/usr/bin/passwd`: The file name.

- Why `/usr/bin/passwd` Has SUID:
  - The `passwd` program lets normal users change their own passwords.
  - Passwords are stored in `/etc/shadow`, which is only writable by root.
  - To allow users to update their password securely, `passwd` runs with root privileges via the SUID bit.
  - This is a legitimate use of SUID — not a misconfiguration



````
ls -lh /etc/shadow
````
<img width="900" height="67" alt="image" src="https://github.com/user-attachments/assets/97e72b61-dc7f-4d78-8a5b-7af136ecfd5b" />

- To set a SUID bit we can use `chmod`.
- In this we cannot do anything on this file, cause it needed `root`.

- We the result:
````
-rw-r----- 1 root shadow 1.3K 2025-09-11 21:30 /etc/shadow
````
- **Owner**: `root`
- **Group**: `shadow`
- **Permission**:
  - `rw-`: for ownerr -> `root` can read and write
  - `r--`: for group -> members of the `shadowy` group can read.
  - `---`: for others -> no access.
- Purpose of `/etc/shadow`:
  Stores hashed passwords for all user accounts. It’s one of the most sensitive files on the system
 

#### Check if we can read **/etc/shadow**:
````
cat /etc/shadow
````
<img width="678" height="101" alt="image" src="https://github.com/user-attachments/assets/1dc6d989-c634-4b43-ae17-3ef0f79db6d5" />

- If we get permission denied -> normal behavior.
- If we can read it -> **Misconfiguration** or we are already in a privileged group.


---


## Understanding SUID Permissions

### Permission Representation:
````
Regular file: -rwxr-xr-x
SUID file:    -rwsr-xr-x
              ^
              |
              's' instead of 'x' = SUID bit set
````
SUID with Numbers:
  - SUID = 4 in the special permissions position
  - Standard permission 755 = 0755
  - SUID permission 4755 = rwsr-xr-x

---




## Why SUID Exists (Legitimate Users):

### Common Legitimate SUID Programs:

#### Password management:
````
/usr/bin/passwd
````
- Needs to write to `/etc/shadow` (root only).

#### System administration
````
/usr/bin/sudo
````
<img width="902" height="61" alt="image" src="https://github.com/user-attachments/assets/8977aba0-a439-4022-815b-caea404e76dd" />




#### Netwroking 
````
/bin/ping
````
````
ls -lh /bin/ping
cat /bin/ping
````
<img width="850" height="93" alt="image" src="https://github.com/user-attachments/assets/1d440e06-ae99-4513-b3a5-aa618b2291c4" />

<img width="1915" height="825" alt="image" src="https://github.com/user-attachments/assets/445de3eb-2465-442a-b1a1-6f3a56a3be11" />



#### File system:
````
/bin/mount
````
````
ls -lha
cat /bin/mount
````
<img width="1894" height="694" alt="image" src="https://github.com/user-attachments/assets/99d21abd-b785-4218-99b4-1833f5709de4" />





## Finding SUID Binaries:

### Basic Enumeration

#### Find all SUID file:
````
find / -type f -perm -4000 2>/dev/null
````


#### Find SUID files owned by root (most dangerous):
````
find / -type f -perm -4000 -user root 2>/dev/null
````



#### Find SUID files with detailed info
````
find / -type f -perm -4000 -exec ls -la {} \; 2>/dev/null
````


#### Find SGID files too
````
find / -type f -perm -2000 2>/dev/null
````


---


### Organized Enumeration Script:
````
#!/bin/bash
echo "========== SUID BINARIES =========="
find / -type f -perm -4000 2>/dev/null | while read file; do
    echo -n "$file: "
    ls -la "$file" | awk '{print $3" "$4" "$1}'
done

echo -e "\n========== POTENTIALLY DANGEROUS =========="
dangerous_suid=("bash" "sh" "cp" "mv" "find" "nano" "vim" "more" "less" "awk" "python" "perl" "ruby")
for cmd in "${dangerous_suid[@]}"; do
    find / -type f -perm -4000 -name "*$cmd*" 2>/dev/null
done
````


---




## Security Issues with SUID:
### What **/etc/shadow** contains:
- **Hashed passwords** for all local user accounts.
- Each line correcsponds to a user and incudes:
  - Username
  - Password Hash
  - Password aging info (Last change, expirattion)


### Security Issues If Misconfigured
1. Readable by unauthorized users
- If a low-privileged user can read `/etc/shadow`, they can:
  - Extract password hashes.
  - Use tools like **John the Ripper** or **Hashcat** to crack them offline.
- This is a critical vulnerability — cracked hashes = full account access.
2. Writable by unauthorized users
- If writable, an attacker could:
  - Replace their own hash with a known one (e.g., hash of `root:toor`).
  - Gain root access without brute force.
- This is **game over** for system integrity.
3. Group membership abuse
- If a user is in the `shadow` group, they can read the file.
- Always audit group memberships with `id` or `groups`.


### Security Issues with SUID
Having a binary that runs as the owner of the file can be problematic when the owner of said file is the root user.
More specifically, we might be able to:
- Read files owned by root
- Read and write files owned by root
- Execute arbitrary code as the root user

- If a low-privileged user can trigger a SUID binary that interacts with files or executes commands, and the binary is owned by root, it opens the door to privilege escalation.

---




## Real User ID, Effective User ID, Saved User ID:
To understand the role of SUID, it is important to understand that we have three different types of user IDs for any process being executed.

- Real User ID: Who you really are, and therefore who owns the process.
- Effective User ID: What the operating system looks at to make authorization decisions, i.e., whether or not you are allowed to do something.
- Saved User ID: Used when a program running with elevated privileges needs to do some unprivileged work temporarily.


An unprivileged process may set its effective user ID to one of only three values:
- The value of the real user ID (`ruid`)
- The value of the saved user ID (`suid`)
- The value of the effective user ID (`euid`)

---


## SUID Binary





















































































