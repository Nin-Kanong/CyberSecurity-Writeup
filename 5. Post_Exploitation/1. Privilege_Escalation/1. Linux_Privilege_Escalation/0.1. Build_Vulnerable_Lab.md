<h1 align="center"> Build Vulnerable LAB SSH  </h1>

<img width="900" height="560" alt="1_U736KQjPEeQA_CMoAlsrmg" src="https://github.com/user-attachments/assets/9cab8fa0-40e5-4ad9-85f5-b45a72f3c815" />



# How to build vulnerable SSH in docker:


- First i create folder, Open `File` -> `Drive C`:
<img width="1100" height="866" alt="image" src="https://github.com/user-attachments/assets/6eef520d-adc6-4edc-9cca-850e2094b14e" />

<img width="1087" height="857" alt="image" src="https://github.com/user-attachments/assets/ea138fc7-f987-4094-ac75-15e7d55ea17d" />

<img width="1088" height="867" alt="image" src="https://github.com/user-attachments/assets/f33ee540-ba9e-487f-ad36-2e3044828e32" />


<img width="1102" height="867" alt="image" src="https://github.com/user-attachments/assets/6af010f0-5681-48bc-9c76-3a7a22145c72" />

<img width="1091" height="790" alt="image" src="https://github.com/user-attachments/assets/49cef09f-7446-4f15-95f1-ed2b4d52cc33" />


- After click on `Windows + S`:
<img width="951" height="911" alt="image" src="https://github.com/user-attachments/assets/76e745c1-448a-4d10-af98-20ca94bfae48" />


- Open Notepad -> Past This:
````
FROM ubuntu:20.04

# Prevent interactive prompts during install
ENV DEBIAN_FRONTEND=noninteractive

# Install tools (including cron & ssh)
RUN apt-get update && \
    apt-get install -y sudo curl wget vim netcat nmap python3 python3-pip git cron openssh-server && \
    pip3 install --upgrade pip && \
    pip3 install psutil && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Add users with password k4n0ng
RUN useradd -m -s /bin/bash lowpriv && \
    echo "lowpriv:k4n0ng" | chpasswd && \
    useradd -m -s /bin/bash adminuser && \
    echo "adminuser:k4n0ng" | chpasswd && \
    useradd -m -s /bin/bash rootlike && \
    echo "rootlike:k4n0ng" | chpasswd

# Give lowpriv sudo rights to /usr/bin/find
RUN echo "lowpriv ALL=(ALL) NOPASSWD: /usr/bin/find" >> /etc/sudoers

# Create SUID binaries
RUN cp /bin/nc /tmp/nc_suid && chmod +s /tmp/nc_suid
RUN cp /usr/bin/python3 /tmp/python_suid && chmod +s /tmp/python_suid

# World-writable directory with secrets
RUN mkdir -p /opt/misconfig && \
    chmod 777 /opt/misconfig && \
    echo "SECRET=TopSecretPassword_k4n0ng" > /opt/misconfig/creds.txt

# Cron job as root
RUN (crontab -l 2>/dev/null; echo "* * * * * /bin/bash -c 'echo \"I am root\" > /tmp/cron_test'") | crontab -

# Install LinPEAS
RUN cd /tmp && \
    wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh && \
    chmod +x linpeas.sh

# Setup SSH
RUN mkdir -p /var/run/sshd && \
    echo "root:k4n0ng" | chpasswd && \
    sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config && \
    sed -i 's/UsePAM yes/UsePAM no/' /etc/ssh/sshd_config

EXPOSE 22

CMD ["/usr/sbin/sshd", "-D"]
````
<img width="998" height="593" alt="image" src="https://github.com/user-attachments/assets/dd1279fe-a601-41d6-b838-74bfcfdd9ebb" />

- After click `Ctrl + S`
<img width="951" height="597" alt="image" src="https://github.com/user-attachments/assets/b680f066-b22a-4e29-a991-ef17d81fb39e" />

<img width="946" height="592" alt="image" src="https://github.com/user-attachments/assets/778a1587-bdca-4296-aa42-e4d5672bbb95" />

<img width="942" height="598" alt="image" src="https://github.com/user-attachments/assets/3aed16b2-39a1-417a-b7d8-1ba75c4b9cce" />

- In this we also can `Rename` to Dockerfile, but in this i not yet i will change it latter.


## Open PowerShell:
Press `Win + X` â†’ choose Terminal (Admin) or PowerShell (Admin)
````
cd C:\labs\pe-lab
````
<img width="1477" height="527" alt="image" src="https://github.com/user-attachments/assets/7c45f5a1-6590-4352-9c5d-a90283085b46" />

- Build the Docker Image
````
docker build -t pe-lab .
dir C:\labs\pe-lab
````
<img width="1452" height="526" alt="image" src="https://github.com/user-attachments/assets/23916a0b-4944-415c-b001-553ca034d908" />

- In this it mean we have no docker file.


- Fix it
````
rename-item "C:\labs\pe-lab\FROM ubuntu20.04.txt" "Dockerfile"
dir C:\labs\pe-lab
````
<img width="1091" height="288" alt="image" src="https://github.com/user-attachments/assets/3017a16b-b5b5-4f39-9efd-6cae1f5b7ede" />


````
docker build --no-cache -t pe-lab .
````
<img width="1456" height="718" alt="image" src="https://github.com/user-attachments/assets/87937bbd-6538-4e6a-b911-fa0382310e69" />

- Now we get success.

````
docker run -d -p 2222:22 --name pe-container pe-lab
````
<img width="886" height="141" alt="image" src="https://github.com/user-attachments/assets/965026ac-3979-44fd-987d-3e7da67d23bf" />


- Now we got success.


## CONNECT VIA SSH

- Connect with this:
````
ssh lowpriv@localhost -p 2222
````
- OR Connect with this:
````
ssh lowpriv@192.168.100.97 -p 2222
````
- Password: `k4n0ng`
<img width="973" height="351" alt="image" src="https://github.com/user-attachments/assets/658743f7-2acc-4481-a061-d8d2b5caa994" />


----



## Create file in my **SSH**:

- First in this i need to `Connect to My SSH`:
````
ssh lowpriv@localhost -p 2222
````
<img width="1005" height="188" alt="image" src="https://github.com/user-attachments/assets/3c14d940-fc2a-43ed-8844-e590267c6dcd" />


### Create file:
````
touch /tmp/mynewfile.txt
ls -la /tmp/my_new_file.txt
````
<img width="813" height="136" alt="image" src="https://github.com/user-attachments/assets/2c23f50c-7cb5-4208-80c5-5153c881b1e6" />

- Check and input to file:
````
cd /tmp/
ls
````
<img width="607" height="157" alt="image" src="https://github.com/user-attachments/assets/53a11b8e-1462-4444-aadb-ccda39d870d6" />

````
echo "This is my new file." > my_new_file.txt
cat my_new_file.txt
````
<img width="886" height="74" alt="image" src="https://github.com/user-attachments/assets/713f74ff-dd12-4a99-91f8-d8e8b2c78d94" />




### Create a File with Content
````
echo "This is content from lowpriv user" > /home/lowpriv/my_note.txt
cat /home/lowpriv/my_note.txt
````
<img width="1125" height="148" alt="image" src="https://github.com/user-attachments/assets/5d9b65d0-998d-4c00-80ea-0798b62d42a4" />




### Create Directories Like Real World
````
mkdir -p /home/lowpriv/projects/web_app/config
echo "db_password=incorrect_password" > /home/lowpriv/projects/web_app/config/db.conf
ls -la /home/lowpriv/projects/
````
<img width="1383" height="211" alt="image" src="https://github.com/user-attachments/assets/03b73434-a85e-4ffa-b1cd-59a9c2a70678" />





### Misconfiguration
````
echo "I can write here as lowpriv user" > /opt/misconfig/my_file.txt
ls -la /opt/misconfig/
````
<img width="1135" height="217" alt="image" src="https://github.com/user-attachments/assets/530f3a4e-5e92-4db0-8529-bc82895efdfc" />



---


## Escalate and Create Files as Root

### Become root
````
sudo find / -exec bash -p \;
whoami
````
<img width="699" height="150" alt="image" src="https://github.com/user-attachments/assets/4a84d693-fbe6-44c7-b891-a7c267799b7d" />



### Create a file as root
````
echo "Created by root user" > /root/root_file.txt
ls -la /root/root_file.txt
````
<img width="1050" height="119" alt="image" src="https://github.com/user-attachments/assets/8e2a3ec3-2caa-45ac-aff5-b12f3ca6461d" />




### Create a file in a system directory
````
echo "System config" > /etc/my_system_config.conf
cat /etc/my_system_config.conf
````
<img width="809" height="118" alt="image" src="https://github.com/user-attachments/assets/18d8c6ae-a666-417d-bae8-6e152359e362" />


----


<h2 align="center"> Finished Build Vulnerable SSH Lab </h2>

---


<h1 align="center"> Credit By: Nin Kanong (k4n0ng) </h1>



