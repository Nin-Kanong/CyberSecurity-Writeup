# Nmap OS Detection

<img width="1200" height="629" alt="nmap-os-detection-og-image-1-1" src="https://github.com/user-attachments/assets/d2166c7e-5b6b-43c5-b241-e62e144e1597" />

### What is Nmap for OS Detection?
Nmap (Network Mapper) is a powerful open-source tool used for network discovery and security auditing. One of its key features is OS detection, the ability to identify the operating system running on a remote host based on its network behavior.


### LAB TOOLS
- Kali Linux
- Metaploitable2 (192.168.127.129)
- Windows (192.168.127.130)


## Usage:

### 1. Basic OS detection
````
nmap -O 192.168.127.129
````
<img width="737" height="636" alt="image" src="https://github.com/user-attachments/assets/1015e4a9-e6ae-47f8-8cec-cab3f73a0fe7" />

- Tis command enables OS detection using TCP/IP stack fingerprinting.
- It sends a series of TCP and UDP packets to the remote host and examines the responses to determine the operating system.


### 2. OS Detection with Verbose
````
nmap -O -v 192.168.127.129
````
<img width="579" height="620" alt="image" src="https://github.com/user-attachments/assets/26ab74f5-d99a-4d39-a754-868b7b1ab11a" />

<img width="728" height="620" alt="image" src="https://github.com/user-attachments/assets/8ea22e7a-0ba6-42d8-a1e6-2cd97757d102" />

- This command performs OS detection and shows detailed output. Nmap sends packets to the target (192.168.127.129) and analyzes responses to guess the operating system.
-  `-v` : enables verbose mode for more information.


### 3. Aggressive Scan (OS + Version + Scripts + Traceroute)
````
nmap -A 192.168.127.129
````
<img width="891" height="692" alt="image" src="https://github.com/user-attachments/assets/bb37389e-edd7-4e0b-8fcb-45d3450ca977" />

<img width="888" height="747" alt="image" src="https://github.com/user-attachments/assets/6a6ad9b9-218c-4183-87cf-6e4ad7da4c80" />

<img width="843" height="392" alt="image" src="https://github.com/user-attachments/assets/5a298ebe-7b5a-49ab-9b65-ef4605f55006" />

- This command will enables OS detection + service version + NSE scripts + traceroute.
This is noisy but gives the most details.



### 4. OS Detection + Service Version Detection
````
nmap -O -sV 192.168.127.129
````
<img width="900" height="681" alt="image" src="https://github.com/user-attachments/assets/07e338b0-dc03-45ab-877d-7c252eb95a53" />

- This command performs OS and service version detection on 192.168.127.129.
- The OS fingerprinting plus detecting versions of services.


### 5. OS Detection Without Host Discovery (Ping Disabled)
````
nmap -O -Pn 192.168.127.129
````
<img width="721" height="640" alt="image" src="https://github.com/user-attachments/assets/69a0bf2f-4aef-4aba-8acf-9f445f25973b" />

- When a firewall blocks ping (ICMP), Nmap assumes the host is alive.
- This command performs OS detection on the target while bypassing ping checks, useful when the host blocks ICMP.
- `-Pn` : Skips host discovery; assumes the target is online (treats it as "alive") even if it doesn’t respond to pings.  


### 6. OS Detection with Faster Timing
````
nmap -O -T4 192.168.127.129
````
<img width="738" height="640" alt="image" src="https://github.com/user-attachments/assets/d4b6521c-bf7e-406a-bfc0-10b26b23cb45" />

- `-T4` : Sets the timing template to "aggressive", speeding up the scan by reducing wait times between requests.
- This command performs OS detection on the target using a faster scan speed, ideal for low-latency networks where the host is expected to be responsive.


### 7. OS Detection with Guessing Enabled
````
nmap -O --osscan-guess 192.168.127.129
````
<img width="727" height="644" alt="image" src="https://github.com/user-attachments/assets/44b3d7c0-39b7-4f78-a392-d55934eadc76" />

- `--osscan-guess` : Tells Nmap to make a best-guess OS match when it can't find a close match in its fingerprint database. Increases accuracy when OS detection is uncertain.
- This command performs aggressive OS detection, using heuristics to guess the OS when no exact match is found useful for identifying unknown or obscure systems.


### 8. OS Detection with Limit Option
````
nmap -O --osscan-limit 192.168.127.129
````
<img width="729" height="315" alt="image" src="https://github.com/user-attachments/assets/ce2542c5-b9d2-4414-83a2-faf55a4e940e" />

- `--osscan-limit` : Tells Nmap to perform OS detection only on hosts that have at least one open and one closed port (skips hosts with all ports filtered or closed). This speeds up the scan by limiting OS fingerprinting to promising targets.
- This command runs OS detection only on hosts that show signs of being actively running services, making the scan more efficient.

### 9. Stealth SYN Scan + OS Detection
````
nmap -sS -O 192.168.130
````
<img width="727" height="317" alt="image" src="https://github.com/user-attachments/assets/02aa8a27-0811-4317-a2a9-e6565f6146d8" />

- `-sS` : Performs a TCP SYN scan, also known as a "half-open" scan. It sends SYN packets to target ports and analyzes responses without completing the TCP handshake, making it fast and stealthy.
- This command scans the target using stealthy SYN packets and attempts to identify the operating system. It's commonly used in penetration testing to gather information without being easily detected.


### 10. OS Detection on Specific Ports
````
nmap -O -p 22,80,443 192.168.127.129
````
<img width="719" height="318" alt="image" src="https://github.com/user-attachments/assets/dc672773-84fb-49d2-8997-455b54df9307" />

- `-p 22,80,443` : Specifies the ports to scan—only port 22 (SSH), 80 (HTTP), and 443 (HTTPS) will be checked.  


### 11. OS Detection on Entire Subnet
````
nmap -O 192.168.127.0/24
````
<img width="902" height="362" alt="image" src="https://github.com/user-attachments/assets/92010ebe-1713-4f5b-ae00-81e07f3f9bb5" />

<img width="408" height="539" alt="image" src="https://github.com/user-attachments/assets/cf71fe30-c96f-4529-a693-64899f70b978" />

<img width="726" height="515" alt="image" src="https://github.com/user-attachments/assets/47221c40-59bf-457a-ad02-0a3672e64f20" />

- `192.168.127.0/24` : Refers to the entire local network range (256 IP addresses from 192.168.127.1 to 192.168.127.254).
- This command scans all hosts in the 192.168.127.0/24 subnet and attempts to identify their operating systems. It’s used for network-wide reconnaissance to discover devices and their OS types. 


### 12. OS Detection + UDP Scan
````
nmap -O -sU 192.168.127.130
````

- `-sU` : Performs a UDP port scan to find open UDP services (e.g., DNS, DHCP, SNMP).
- This command attempts to detect the operating system and scan UDP ports on the target. However, OS detection (-O) requires open TCP ports and may not work reliably with only UDP scanning. It’s best combined with TCP scans for accurate results.


### 13. OS Detection on IPv6
<img width="704" height="369" alt="image" src="https://github.com/user-attachments/assets/1f59d9fc-556f-4fc3-8706-bab58f481fb9" />

- Target have IPv6:
````
fe80::20c:29ff:fe0a:46c1
````
````
nmap -6 -O fe80::20c:29ff:fe0a:46c1%2
````
<img width="727" height="342" alt="image" src="https://github.com/user-attachments/assets/f492e2b7-08c7-4c2c-84b5-95bf9399d710" />

- In this we need to add `%2` in the last of IPv6. if we don't input it if blocking:
<img width="675" height="105" alt="image" src="https://github.com/user-attachments/assets/a4dc8a18-88af-4138-be5d-2ba16ac42eb1" />
 
- `-6` : Enables scanning of IPv6 addresses.
- `fe80::20c:29ff:fe0a:46c1%2` : An IPv6 link-local address. The `%2` at the end specifies the interface index (e.g., Ethernet interface number 2), which is required to reach link-local addresses on most systems.
- This command performs OS detection on the specified IPv6 host. It is useful in environments using IPv6, especially for scanning local network devices with link-local addresses. 


### 14. OS Detection + Version + Banner Script
````
nmap -O -sV --script=banner 192.168.127.129
````
<img width="581" height="507" alt="image" src="https://github.com/user-attachments/assets/361fe5d8-9d8e-477a-ae24-353a8ba2a7da" />

<img width="897" height="578" alt="image" src="https://github.com/user-attachments/assets/1e1accd8-d781-41f0-bd5d-123740d59fb2" />

- `-sV` : Detects service versions running on open ports (e.g., Apache 2.4, OpenSSH 7.2).
- --script=banner: Runs the Nmap Scripting Engine (NSE) banner script to grab application banners from services (e.g., HTTP, FTP, SMTP), which often reveal software details.
- This command scans the target to identify its operating system, open service versions, and retrieve service banners—useful for reconnaissance and vulnerability assessment. 


### 15. OS Detection with Fuzzy Matching
````
nmap -O --fuzzy 192.168.127.129
````
<img width="893" height="654" alt="image" src="https://github.com/user-attachments/assets/2c3fb150-6c78-4eca-ad7b-18e64536f535" />

- `--fuzzy` : This is not a valid Nmap option. It may be a confusion with --osscan-guess, which tells Nmap to make a best-effort guess when OS detection is uncertain.
- This command will fail or be ignored due to the invalid --fuzzy flag. Use --osscan-guess instead for better OS guessing. 


### 16. Save OS Detection Results (Normal Format)
````
nmap -O -oN os_scan.txt 192.168.127.129
````
<img width="724" height="638" alt="image" src="https://github.com/user-attachments/assets/62ac6386-538d-4d99-aac0-ea916fbfc7bd" />

- Check file:
````
cat os_scan.txt
````
<img width="853" height="659" alt="image" src="https://github.com/user-attachments/assets/fe69b0b9-853c-487d-8d38-eeb3004e6382" />

- `-oN` : Saves the scan output in normal, human-readable format.
- `os_scan.txt` : The filename where the results will be saved.
- This command performs OS detection on the target and saves the results to a file named os_scan.txt. 


### 17. Save OS Detection Results (XML Format)
````
nmap -O -oX scan.xml 192.168.127.129
````
<img width="720" height="634" alt="image" src="https://github.com/user-attachments/assets/7028632e-93e9-4be1-a44e-14d407aa197e" />

- Check file:
````
cat os_scan.xml
````
<img width="903" height="638" alt="image" src="https://github.com/user-attachments/assets/7d44128c-9aea-46d6-9515-c03b12300d58" />

- `-oX` : Saves the scan output in XML format.
- `scan.xml` : The filename where the XML results will be saved.
- This command performs OS detection on the target and saves the results in structured XML format, useful for parsing by other tools or generating reports.


### 18. Save OS Detection Results (Grepable Format
````
nmap -O -oG os_scan.gnmap 192.168.127.129
````
<img width="733" height="635" alt="image" src="https://github.com/user-attachments/assets/08b23fe3-ea85-4499-a46f-b184f0ec288e" />

- Check file:
````
cat os_scan.gnmap
````
<img width="901" height="221" alt="image" src="https://github.com/user-attachments/assets/97cb2e26-583c-4f92-8b9a-29011fa926b0" />

- -oG: Saves the scan output in grepable format (simple, line-based format for easy parsing with tools like grep, awk, or scripts).
- This command performs OS detection on the target and saves the results in a machine-friendly, grepable format. Note: Grepable output is deprecated in newer Nmap versions in favor of XML (-oX).


### ==========>>> end OF Nmap OS detection Version

### Why Hacker use Nmap for OS detection
Hacker use Nmap OS detection cause:
- Identify the Operating System of the Target
- Match Exploits to the Correct OS
- Fingerprint OS Versions and Patch Levels
- Bypass Security & Firewalls


### Credits:
1. https://nmap.org/book/man-os-detection.html
2. https://www.geeksforgeeks.org/linux-unix/os-detection-in-nmap-in-kali-linux/


### PRACTICE IN LAB BY: NIN KANONG(k4n0ng)

#### Date: 3/Sept/2025
