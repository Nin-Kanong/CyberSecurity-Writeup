# rpcclient

<img width="318" height="159" alt="images" src="https://github.com/user-attachments/assets/de1d053e-8b3c-4483-9c6c-860cb5cd6dce" />

### What is rpcclient?
rpcclient is a command-line tool included in the Samba suite that allows you to communicate with a remote Windows or Samba server using the Remote Procedure Call (RPC) protocol over SMB (Server Message Block). 


### LAB TOOLS
- Kali Linux
- Metasploitable2


### Usage:
- Get help
````
rpcclient -h
````
<img width="867" height="266" alt="image" src="https://github.com/user-attachments/assets/08efaabc-7a97-4f38-9704-2829f1c309a9" />

- rpcclient  for OS detection
| **Option**                 | **Description**                                                        |
| -------------------------- | ---------------------------------------------------------------------- |
| `-c <COMMANDS>`            | Execute commands on the target (e.g., `srvinfo` to get OS/system info) |
| `-I <IP>`                  | Specify the target IP                                                  |
| `-p <PORT>`                | Specify SMB/RPC port (default 445)                                     |
| `-d <DEBUGLEVEL>`          | Enable debug output to reveal OS/system information                    |
| `-U <USERNAME[%PASSWORD]>` | Specify username (and optionally password) for login                   |
| `--no-pass`                | Connect without a password                                             |
| `-W <WORKGROUP>`           | Specify workgroup/domain for the target                                |



### 1. srvinfo
````
rpcclient -U "" -N 192.168.127.129 -c srvinfo
````
<img width="742" height="122" alt="image" src="https://github.com/user-attachments/assets/7717b58e-72b4-466b-9239-ae76fe390488" />

- `-U ""` : Specifies an empty username (anonymous or null session).
- `-N` : Prevents rpcclient from prompting for a password.
- `-c srvinfo` : Executes the srvinfo command to retrieve server information, such as OS version, server name, and domain.
- This command attempts to connect anonymously to the target's RPC service and fetch detailed server information—commonly used in enumeration during penetration testing. Success indicates a potential misconfiguration (e.g., unrestricted null session access), often found in older Windows systems or poorly secured Samba servers. 

### 2. getdompwinfo
````
rpcclient -U "" -N 192.168.127.129 -c querydispinfo
````
<img width="881" height="621" alt="image" src="https://github.com/user-attachments/assets/315aa820-09b1-4013-aea3-ffa001f00ebc" />

- `-c querydispinfo` : Executes the querydispinfo command, which queries the remote system for user account information, including usernames, full names, and user IDs (RIDs).
- This command attempts to enumerate user accounts on the target system without authentication. If successful, it reveals valuable information for reconnaissance—common in internal penetration tests. Success indicates a misconfigured system (e.g., unrestricted null session access), often found in older Windows systems or poorly secured Samba servers.


### 3. Debug for more info
````
rpcclient -U 'Administrator%password' 192.168.127.129 --debuglevel 5
````
<img width="622" height="682" alt="image" src="https://github.com/user-attachments/assets/a4176517-0d74-461c-8ae9-76e617322e76" />

<img width="875" height="597" alt="image" src="https://github.com/user-attachments/assets/722bb5c9-f448-4afd-8b67-1a465fc7606a" />

- `-U 'Administrator%password'` : Specifies the username (Administrator) and password (password) for authentication, avoiding interactive login.
- `--debuglevel 5` : Sets the debug verbosity to level 5 (high detail), showing detailed protocol and packet-level information for troubleshooting.
- This command connects to the target's RPC service using the provided credentials and enables detailed logging. It’s used in penetration testing to authenticate and explore system information, user accounts, shares, or policies when weak credentials are known. High debug level helps analyze communication for deeper inspection. 


### 4. lookupsids
````
rpcclient -U "" -N 192.168.127.129 -c "lookupsids S-1-5-32-550"
````
<img width="570" height="67" alt="image" src="https://github.com/user-attachments/assets/8e48abfe-afba-4168-a602-04396e49e5bd" />

- `-c "lookupsids S-1-5-32-550"` : Executes the command to resolve a Security Identifier (SID). S-1-5-32-550 is the SID for the "Remote Desktop Users" group. This command attempts to translate the SID into a human-readable username or group name.
- This command is used in enumeration during penetration testing to identify which user or group corresponds to a known SID. Success indicates that the target allows anonymous access to sensitive RPC functions, commonly found in older Windows systems or misconfigured Samba servers. 

### 5. Query each account with lookupnames
````
rpcclient -U "" -N 192.168.127.129 -c "lookupnames msfadmin"
````
<img width="545" height="74" alt="image" src="https://github.com/user-attachments/assets/cd3fd663-54ac-41cd-b4f7-19ef4e4a905f" />

- `-c "lookupnames msfadmin"` : Executes a command to resolve the username "msfadmin" into its corresponding Security Identifier (SID).
- This command is used during enumeration in penetration testing to obtain the SID of a specific user. Success indicates the target allows anonymous access to RPC services, which is a security misconfiguration often found in vulnerable systems like Metasploitable. 

### 6. Enumerate accounts anonymously
````
rpcclient -U "" -N 192.168.127.129 -c "enumdomusers"
````
<img width="473" height="606" alt="image" src="https://github.com/user-attachments/assets/2aa69bfd-2069-41e4-a35e-1009dad5015a" />

- `-c "enumdomusers"` : Executes a command to enumerate all domain or local user accounts on the target system.
- This command is used during enumeration in penetration testing to list user accounts when the target allows anonymous access to RPC services. Success indicates a misconfiguration (e.g., unrestricted null session), common in older Windows systems or poorly secured Samba servers. 


### 7. RID Cycling for User Enumeration
````
for i in $(seq 500 1100); do rpcclient -U "" -N 192.168.127.129 -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid"; done
````
<img width="904" height="639" alt="image" src="https://github.com/user-attachments/assets/da6ad69a-4a56-403e-b1c3-bd1358f80f6a" />

- `for i in $(seq 500 1100)` : Loops through numbers from 500 to 1100 (common RID range for user accounts in Windows).
- `do ... done` : Wraps the commands to execute in each loop iteration.
- `-c "queryuser 0x$(printf '%x\n' $i)"` : Executes queryuser with the RID (Relative Identifier) in hexadecimal format (e.g., 500 → 0x1f4). This queries user details like username, full name, and account status.
- `grep "User Name|user_rid"` : Filters output to show only lines containing "User Name" or "user_rid" (User RID in hex).
- This command attempts to enumerate user accounts on the target by querying RIDs from 500 to 1100 — the typical range for first user accounts (e.g., RID 500 = Administrator). Success indicates anonymous access to RPC is allowed, a common misconfiguration in vulnerable systems like Metasploitable. 


### ===========>>> End Of rpcclient

### Why Hacker use rpcclient:
Hackers use rpcclient for OS detection and enumeration because it allows them to gather critical information about a target Windows system, which can be exploited for further attacks. Below is a concise explanation for your GitHub note, focusing on why hackers leverage rpcclient commands, especially in the context of XSS or broader attacks.
- System Enumeration
- Exploiting Weak Configurations
- Privilege Escalation
- Crafting Targeted Exploits

### PRACTICE IN LAB BY: NIN KANONG(k4n0ng)

#### Date: 4/Sept/2025
